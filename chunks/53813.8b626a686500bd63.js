"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53813],{2261:(e,t,s)=>{s.d(t,{A:()=>p});var a=s(28802),i=s(12389),n=s(11577),o=s(54759),r=s(83034),l=s(80457),c=s(3779);let d=(0,n.rU)(({css:e,token:t,isDarkMode:s})=>e`
    flex: none;
    width: 100%;
    height: 6px;
    background: ${s?(0,c.B3)(t.colorFillTertiary,.04):t.colorFillTertiary};
  `),u=(0,r.memo)(()=>{let{styles:e}=d();return(0,a.Y)("div",{className:e})}),g=(0,n.rU)(({css:e,token:t})=>({container:e`
    position: relative;
    border-radius: 0;
    font-size: 15px;

    &:active {
      background: ${t.colorFillTertiary};
    }
  `})),p=(0,r.memo)(({label:e,icon:t,onClick:s,type:n})=>{let{cx:r,styles:c,theme:d}=g();return"divider"===n?(0,a.Y)(u,{}):(0,a.FD)(l.Flexbox,{align:"center",className:r(c.container),gap:12,horizontal:!0,justify:"space-between",onClick:s,padding:16,children:[(0,a.FD)(l.Flexbox,{align:"center",gap:12,horizontal:!0,children:[t&&(0,a.Y)(i.default,{color:d.colorPrimaryBorder,icon:t,size:{size:20}}),e]}),(0,a.Y)(i.default,{color:d.colorBorder,icon:o.A,size:{size:16}})]})})},11678:(e,t,s)=>{s.d(t,{p:()=>o});var a=s(35245),i=s(77605);class n{constructor(){this.createTopic=e=>i.du.topic.createTopic.mutate({...e,sessionId:this.toDbSessionId(e.sessionId)}),this.batchCreateTopics=e=>i.du.topic.batchCreateTopics.mutate(e),this.cloneTopic=(e,t)=>i.du.topic.cloneTopic.mutate({id:e,newTitle:t}),this.getTopics=e=>i.du.topic.getTopics.query({...e,containerId:this.toDbSessionId(e.containerId)}),this.getAllTopics=()=>i.du.topic.getAllTopics.query(),this.countTopics=async e=>i.du.topic.countTopics.query(e),this.rankTopics=async e=>i.du.topic.rankTopics.query(e),this.searchTopics=(e,t,s)=>i.du.topic.searchTopics.query({groupId:s,keywords:e,sessionId:this.toDbSessionId(t)}),this.updateTopic=(e,t)=>i.du.topic.updateTopic.mutate({id:e,value:t}),this.removeTopic=e=>i.du.topic.removeTopic.mutate({id:e}),this.removeTopics=e=>i.du.topic.batchDeleteBySessionId.mutate({id:this.toDbSessionId(e)}),this.batchRemoveTopics=e=>i.du.topic.batchDelete.mutate({ids:e}),this.removeAllTopic=()=>i.du.topic.removeAllTopics.mutate(),this.toDbSessionId=e=>e===a.Ed?null:e}}let o=new n},29816:(e,t,s)=>{s.d(t,{H:()=>l});var a=s(32818),i=s(83034),n=s(49935),o=s(12020),r=s(91568);let l=()=>{let[e,t]=(0,i.useState)(!1),{isSupportInstallPWA:s,isPWA:l}=(0,r.V)();return(0,i.useEffect)(()=>{if(!o.i)return a.O.addListener(t),()=>{a.O.removeListener(t)}},[]),{canInstall:!l&&!!s&&!!document.querySelector(`#${n.lU}`)&&e,install:()=>{let e=document.querySelector(`#${n.lU}`);e&&(e.externalPromptEvent=a.O.getEvent(),e?.showDialog(!0))}}}},30333:(e,t,s)=>{s.d(t,{sessionService:()=>n});var a=s(77605);class i{constructor(){this.hasSessions=async()=>0===await this.countSessions(),this.createSession=async(e,t)=>{let{config:s,group:i,meta:n,...o}=t;return a.du.session.createSession.mutate({config:{...s,...n},session:{...o,groupId:i},type:e})},this.cloneSession=(e,t)=>a.du.session.cloneSession.mutate({id:e,newTitle:t}),this.getGroupedSessions=()=>a.du.session.getGroupedSessions.query(),this.countSessions=async e=>a.du.session.countSessions.query(e),this.rankSessions=async e=>a.du.session.rankSessions.query(e),this.updateSession=(e,t)=>{let{group:s,pinned:i,meta:n,updatedAt:o}=t;return a.du.session.updateSession.mutate({id:e,value:{groupId:"default"===s?null:s,pinned:i,...n,updatedAt:o}})},this.getSessionConfig=async e=>a.du.agent.getAgentConfig.query({sessionId:e}),this.updateSessionConfig=(e,t,s)=>a.du.session.updateSessionConfig.mutate({id:e,value:t},{context:{showNotification:!1},signal:s}),this.updateSessionMeta=(e,t,s)=>a.du.session.updateSessionConfig.mutate({id:e,value:t},{signal:s}),this.updateSessionChatConfig=(e,t,s)=>a.du.session.updateSessionChatConfig.mutate({id:e,value:t},{signal:s}),this.searchSessions=e=>a.du.session.searchSessions.query({keywords:e}),this.removeSession=e=>a.du.session.removeSession.mutate({id:e}),this.removeAllSessions=()=>a.du.session.removeAllSessions.mutate(),this.createSessionGroup=(e,t)=>a.du.sessionGroup.createSessionGroup.mutate({name:e,sort:t}),this.removeSessionGroup=(e,t)=>a.du.sessionGroup.removeSessionGroup.mutate({id:e,removeChildren:t}),this.removeSessionGroups=()=>a.du.sessionGroup.removeAllSessionGroups.mutate(),this.updateSessionGroup=(e,t)=>a.du.sessionGroup.updateSessionGroup.mutate({id:e,value:t}),this.updateSessionGroupOrder=e=>a.du.sessionGroup.updateSessionGroupOrder.mutate({sortMap:e})}}let n=new i},35628:(e,t,s)=>{s.d(t,{A:()=>A});var a=s(28802),i=s(12389),n=s(37412),o=s(64873),r=s(11577),l=s(39639),c=s(85017),d=s(83034),u=s(59121),g=s(80457),p=s(46265),m=s(56790),h=s(30333),S=s(11678),y=s(62326),f=s(9402),b=s(99756);let v=(0,r.rU)(({css:e,token:t})=>({card:e`
    padding-block: 6px;
    padding-inline: 8px;
    border-radius: ${t.borderRadius}px;
    background: ${t.colorFillTertiary};

    &:hover {
      background: ${t.colorFillSecondary};
    }
  `,count:e`
    font-size: 16px;
    font-weight: bold;
    line-height: 1.2;
  `,title:e`
    font-size: 12px;
    line-height: 1.2;
    color: ${t.colorTextDescription};
  `,today:e`
    font-size: 12px;
  `})),A=(0,d.memo)(({style:e,...t})=>{let s=(0,y.wo)(e=>e.isMobile),{data:r,isLoading:A}=(0,p.lA)("count-sessions",()=>h.sessionService.countSessions()),{data:k,isLoading:I}=(0,p.lA)("count-topics",()=>S.p.countTopics()),{data:{messages:w,messagesToday:x}={},isLoading:F}=(0,p.lA)("count-messages",async()=>({messages:await m.T.countMessages(),messagesToday:await m.T.countMessages({startDate:(0,b.Ec)().format("YYYY-MM-DD")})})),{styles:T,theme:C}=v(),{t:U}=(0,u.Bd)("common"),M=(0,d.useMemo)(()=>(0,a.Y)(i.default,{icon:c.A,spin:!0}),[]),N=[{count:A||(0,l.A)(r)?M:r,key:"sessions",title:U("dataStatistics.sessions")},{count:I||(0,l.A)(k)?M:k,key:"topics",title:U("dataStatistics.topics")},{count:F||(0,l.A)(w)?M:w,countToady:x,key:"messages",title:U("dataStatistics.messages")}];return(0,a.Y)(g.Flexbox,{align:"center",gap:4,horizontal:!0,paddingInline:8,style:{marginBottom:8,...e},width:"100%",...t,children:N.map(e=>{if("messages"===e.key){let t=!!(e.countToady&&e.countToady>0);return(0,a.FD)(g.Flexbox,{align:"center",className:T.card,flex:t&&!s?2:1,gap:4,horizontal:!0,justify:"space-between",children:[(0,a.FD)(g.Flexbox,{gap:2,children:[(0,a.Y)("div",{className:T.count,children:(0,f.U2)(e.count)}),(0,a.Y)("div",{className:T.title,children:e.title})]}),t&&(0,a.Y)(n.A,{title:U("dataStatistics.today"),children:(0,a.Y)(o.A,{count:`+${e.countToady}`,style:{background:C.colorSuccess,color:C.colorSuccessBg,cursor:"pointer"}})})]},e.key)}return(0,a.FD)(g.Flexbox,{className:T.card,flex:1,gap:2,children:[(0,a.Y)(g.Flexbox,{horizontal:!0,children:(0,a.Y)("div",{className:T.count,children:(0,f.U2)(e.count)})}),(0,a.Y)("div",{className:T.title,children:e.title})]},e.key)})})})},38759:(e,t,s)=>{s.d(t,{c:()=>Y,k:()=>P});var a=s(14308),i=s(50786),n=s(23993),o=s(41734),r=s(89872);let l={preference:r.I},c={...{defaultSettings:s(74551).a$,settings:{}},...l,...{},...{isOnboard:!1,isShowPWAGuide:!1,isUserCanEnableTrace:!1,isUserHasConversation:!1,isUserStateInit:!1}};var d=s(96773),u=s(70674),g=s(64911),p=s(85366),m=s(46265),h=s(55582),S=s(67095),y=s(61497),f=s(71457);let b=(0,y.K)("common"),v="initUserState",A=(0,y.K)("preference");var k=s(31021),I=s.n(k),w=s(19530),x=s(45628);class F{constructor(){this.createShareSettingsUrl=e=>`/?${x.N}=${encodeURI(JSON.stringify(e))}`,this.decodeShareSettings=e=>{try{return{data:JSON.parse(e)}}catch(e){return{message:JSON.stringify(e)}}}}}let T=new F;var C=s(34743),U=s(1866),M=s(28074);let N=(0,o.t)("user"),P=(0,n.h)()((0,a.eh)(N((...e)=>({...c,...((e,t)=>({addToolToAllowList:async e=>{let s=t().settings.tool?.humanIntervention?.allowList||[];s.includes(e)||await t().setSettings({tool:{humanIntervention:{allowList:[...s,e]}}})},importAppSettings:async e=>{let{setSettings:s}=t();await s(e)},importUrlShareSettings:async e=>{if(e){let s=T.decodeShareSettings(e);!s?.message&&s?.data&&await t().setSettings(s.data)}},internal_createSignal:()=>{let s=t().updateSettingsSignal;s&&!s.signal.aborted&&s.abort(w.ve);let a=new AbortController;return e({updateSettingsSignal:a},!1,"signalForUpdateSettings"),a},resetSettings:async()=>{await h.W.resetUserSettings(),await t().refreshUserState()},setSettings:async s=>{let a,{settings:i,defaultSettings:n}=t(),o=(0,S.h)(i,s);if(I()(i,o))return;let r=(a=(e,t)=>(0,C.A)(e,(e,s,i)=>{(0,U.A)(s)&&(0,U.A)(t[i])?I()(s,t[i])||(e[i]=s):I()(s,t[i])||(e[i]=(0,M.A)(s)&&(0,M.A)(t[i])?a(s,t[i]):s)}))(o,n);e({settings:r},!1,"optimistic_updateSettings");let l=t().internal_createSignal();await h.W.updateUserSettings(r,l.signal),await t().refreshUserState()},updateDefaultAgent:async e=>{await t().setSettings({defaultAgent:e})},updateGeneralConfig:async e=>{await t().setSettings({general:e})},updateHumanIntervention:async e=>{let s=t().settings.tool?.humanIntervention||{};await t().setSettings({tool:{humanIntervention:{...s,...e}}})},updateKeyVaults:async e=>{await t().setSettings({keyVaults:e})},updateSystemAgent:async(e,s)=>{await t().setSettings({systemAgent:{[e]:{...s}}})}}))(...e),...((e,t)=>({updateGuideState:async e=>{let{updatePreference:s}=t(),a=(0,S.h)(t().preference.guide,e);await s({guide:a})},updateLab:async e=>{let{updatePreference:s}=t(),a=(0,S.h)(t().preference.lab,e);await s({lab:a},A("updateLab"))},updatePreference:async(s,a)=>{let i=(0,S.h)(t().preference,s);e({preference:i},!1,a||A("updatePreference")),await h.W.updatePreference(i)}}))(...e),...((e,t)=>({enableAuth:()=>d.S4,logout:async()=>{if(d.Nd)return void t().clerkSignOut?.({redirectUrl:location.toString()});if(d.J_){let{signOut:e}=await s.e(4975).then(s.bind(s,4975));e()}},openLogin:async()=>{if(d.Nd){let e=location.toString();t().clerkSignIn?.({fallbackRedirectUrl:e,signUpForceRedirectUrl:e,signUpUrl:"/signup"});return}if(d.J_){let{signIn:e}=await s.e(4975).then(s.bind(s,4975)),a=t()?.oAuthSSOProviders;if(a&&1===a.length)return void e(a[0]);e()}}}))(...e),...((e,t)=>({refreshUserState:async()=>{await (0,g.j)(v)},updateAvatar:async e=>{await h.W.updateAvatar(e),await t().refreshUserState()},updateKeyVaultConfig:async(e,s)=>{await t().setSettings({keyVaults:{[e]:s}})},useCheckTrace:e=>(0,p.Ay)(e?"checkTrace":null,()=>"boolean"==typeof f.U.userAllowTrace(t())?Promise.resolve(!1):Promise.resolve(t().isUserCanEnableTrace),{revalidateOnFocus:!1}),useInitUserState:(s,a,i)=>(0,m.Ju)(s?v:null,()=>h.W.getUserState(),{onError:e=>{i?.onError?.(e)},onSuccess:s=>{if(i?.onSuccess?.(s),s){let i={defaultAgent:a.defaultAgent,image:a.image,systemAgent:a.systemAgent},n=(0,S.h)(t().defaultSettings,i),o=0===Object.keys(s.preference||{}).length?r.I:s.preference,l=s.avatar||s.userId?(0,S.h)(t().user,{avatar:s.avatar,email:s.email,firstName:s.firstName,fullName:s.fullName,id:s.userId,latestName:s.lastName,username:s.username}):t().user;e({defaultSettings:n,isOnboard:s.isOnboard,isShowPWAGuide:s.canEnablePWAGuide,isUserCanEnableTrace:s.canEnableTrace,isUserHasConversation:s.hasConversation,isUserStateInit:!0,preference:o,settings:s.settings||{},subscriptionPlan:s.subscriptionPlan,user:l},!1,b("initUserState"));let c=(0,u.wZ)();c?.identify(s.userId||"",{email:s.email,firstName:s.firstName,lastName:s.lastName,username:s.username})}}})}))(...e)}))),i.x),Y=()=>P.getState()},43262:(e,t,s)=>{s.d(t,{C:()=>a});let a={isSyncActive:e=>e.dataSyncConfig.active,remoteServerUrl:e=>e.dataSyncConfig.remoteServerUrl||"",storageMode:e=>e.dataSyncConfig.storageMode}},52702:(e,t,s)=>{s.d(t,{A:()=>m});var a=s(28802),i=s(8756),n=s(11577),o=s(51997),r=s.n(o),l=s(83034),c=s(80457),d=s(98724),u=s(45628),g=s(64861);let p=(0,n.rU)(({token:e,css:t})=>({logoLink:t`
    line-height: 1;
    color: inherit;

    &:hover {
      color: ${e.colorLink};
    }
  `})),m=(0,l.memo)(({style:e,...t})=>{let{styles:s,theme:n}=p();return(0,a.FD)(c.Flexbox,{align:"center",dir:"ltr",flex:"none",gap:4,horizontal:!0,style:{color:n.colorTextDescription,fontSize:12,...e},...t,children:[(0,a.Y)("span",{children:"Powered by"}),g.Eb?(0,a.Y)("span",{children:d.dS}):(0,a.Y)(r(),{className:s.logoLink,href:`https://lobehub.com?utm_source=${u.VU}&utm_content=brand_watermark`,target:"_blank",children:(0,a.Y)(i.default,{size:20,type:"text"})})]})})},53813:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var a=s(28802),i=s(83034),n=s(20480),o=s(52702),r=s(2261),l=s(74551),c=s(56434),d=s(25863),u=s(29961),g=s(87605),p=s(14484),m=s(12648),h=s(20956),S=s(59121),y=s(27697),f=s(29816),b=s(62326),v=s(12467),A=s(38759),k=s(61520);let I=(0,i.memo)(()=>{let e=(()=>{let e=(0,y.Zp)(),{canInstall:t,install:s}=(0,f.H)(),{t:a}=(0,S.Bd)(["common","setting","auth"]),{showCloudPromotion:i,hideDocs:n}=(0,b.wo)(v.E),[o]=(0,A.k)(e=>[k.P.isLoginWithAuth(e)]),r=[{icon:c.A,key:"profile",label:a("userPanel.profile"),onClick:()=>e("/me/profile")}],I=[{icon:d.A,key:"setting",label:a("userPanel.setting"),onClick:()=>e("/me/settings")},{type:"divider"}],w=[{icon:u.A,key:"pwa",label:a("installPWA"),onClick:()=>s()},{type:"divider"}],x=[i&&{icon:g.A,key:"cloud",label:a("userPanel.cloud",{name:l.IS}),onClick:()=>window.open(`${l.Uo}?utm_source=${l.VU}`,"__blank")},{icon:p.A,key:"docs",label:a("document"),onClick:()=>window.open(l.fV,"__blank")},{icon:m.A,key:"feedback",label:a("feedback"),onClick:()=>window.open(l.Cx,"__blank")},{icon:h.A,key:"changelog",label:a("changelog"),onClick:()=>e("/changelog")}].filter(Boolean);return[{type:"divider"},...o?r:[],...o?I:[],...t?w:[],...!n?x:[]].filter(Boolean)})();return e?.map(({key:e,...t},s)=>(0,a.Y)(r.A,{...t},e||s))});var w=s(80457),x=s(96773),F=s(35628),T=s(56646),C=s(72242);let U=(0,i.memo)(()=>{let e=(0,y.Zp)(),t=(0,A.k)(k.P.isLoginWithAuth),[s]=(0,A.k)(e=>[e.openLogin]);return(0,a.Y)(w.Flexbox,{gap:12,paddingBlock:8,children:!x.S4||x.S4&&t?(0,a.FD)(a.FK,{children:[(0,a.Y)(y.N_,{style:{color:"inherit"},to:"/profile",children:(0,a.Y)(T.A,{})}),(0,a.Y)(y.N_,{style:{color:"inherit"},to:"/profile/stats",children:(0,a.Y)(F.A,{paddingInline:12})})]}):(0,a.Y)(C.A,{onClick:()=>{x.J_?s():e("/login")}})})}),M=(0,i.memo)(()=>(0,a.FD)(a.FK,{children:[(0,a.Y)(U,{}),(0,a.Y)(I,{}),(0,a.Y)(n.default,{padding:16,children:(0,a.Y)(o.A,{})})]}));M.displayName="MeHomePage";let N=M},55582:(e,t,s)=>{s.d(t,{W:()=>n});var a=s(77605);class i{constructor(){this.getUserRegistrationDuration=async()=>a.du.user.getUserRegistrationDuration.query(),this.getUserState=async()=>a.du.user.getUserState.query(),this.getUserSSOProviders=async()=>a.du.user.getUserSSOProviders.query(),this.unlinkSSOProvider=async(e,t)=>a.du.user.unlinkSSOProvider.mutate({provider:e,providerAccountId:t}),this.makeUserOnboarded=async()=>a.du.user.makeUserOnboarded.mutate(),this.updateAvatar=async e=>a.du.user.updateAvatar.mutate(e),this.updatePreference=async e=>a.du.user.updatePreference.mutate(e),this.updateGuide=async e=>a.du.user.updateGuide.mutate(e),this.updateUserSettings=async(e,t)=>a.du.user.updateSettings.mutate(e,{signal:t}),this.resetUserSettings=async()=>a.du.user.resetSettings.mutate()}}let n=new i},56646:(e,t,s)=>{s.d(t,{A:()=>N});var a=s(28802),i=s(11577),n=s(83034),o=s(80457),r=s(3136),l=s(51997),c=s.n(l),d=s(59121),u=s(4001),g=s(45628),p=s(64861),m=s(12389),h=s(24080),S=s(82753),y=s(23942),f=s(39029),b=s(9392),v=s(10376),A=s(20480),k=s(58528);let I={[k.l.Free]:{icon:S.A,theme:{background:void 0,color:void 0}},[k.l.Hobby]:{icon:y.A,theme:{background:"linear-gradient(45deg, #21B2EE, #2271ED)",color:"#E5F8FF"}},[k.l.Starter]:{icon:f.A,theme:{background:"linear-gradient(45deg, #C57948, #803718)",color:"#FFC385"}},[k.l.Premium]:{icon:b.A,theme:{background:"linear-gradient(45deg, #A5B4C2, #606E7B)",color:"#FCFDFF"}},[k.l.Ultimate]:{icon:v.A,theme:{background:"linear-gradient(45deg, #F7A82F, #BB7227)",color:"#FCFA6E"}}},w=(0,i.rU)(({css:e,token:t})=>({icon:e`
    flex: none;
    border-radius: ${t.borderRadiusLG}px;
    box-shadow: 0 0 0 1px ${t.colorFillSecondary};
  `})),x=(0,n.memo)(({type:e="icon",plan:t,size:s=36,mono:i,style:n,className:r,onClick:l})=>{let{icon:c,theme:u}=I[t],{cx:g,styles:p,theme:S}=w(),{t:y}=(0,d.Bd)("subscription"),f=t===k.l.Free;if("tag"===e)return(0,a.Y)(h.A,{bordered:!1,className:r,onClick:l,style:{...u||{background:S.colorFillSecondary,color:S.colorText},border:"none",borderRadius:12,cursor:"pointer",flex:"none",margin:0,...n},children:y(`plans.plan.${t}.title`)});let b=(0,a.Y)(A.default,{className:g(p.icon,r),height:s,onClick:l,style:i?n:{...u,border:f?void 0:`2px solid ${u.color}`,...n},width:s,children:(0,a.Y)(m.default,{color:i?void 0:u.color,icon:c,size:s/2})});return"combine"===e?(0,a.FD)(o.Flexbox,{align:"center",gap:8,horizontal:!0,children:[b,(0,a.Y)("span",{children:y(`plans.plan.${t}.title`)})]}):b}),F=(0,n.memo)(({type:e="preview"})=>{let{t}=(0,d.Bd)("common"),s=(0,i.DP)();if("preview"===e)return(0,a.Y)(r.A,{bordered:!1,style:{background:s.colorFill,borderRadius:12,cursor:"pointer"},children:t("userPanel.community")});let n=e===k.l.Free;return(0,a.Y)(c(),{href:(0,u.A)(p.xl?g.Uo:"/",n?"/subscription/plans":"/subscription/usage"),style:{cursor:"pointer"},target:p.xl?"_blank":void 0,children:(0,a.Y)(x,{plan:e,size:22,type:"tag"})})});var T=s(38759),C=s(61520),U=s(83395);let M=(0,i.rU)(({css:e,token:t})=>({nickname:e`
    font-size: 16px;
    font-weight: bold;
    line-height: 1;
  `,username:e`
    line-height: 1;
    color: ${t.colorTextDescription};
  `})),N=(0,n.memo)(({avatarProps:e,onClick:t,...s})=>{let{styles:i,theme:n}=M(),r=(0,T.k)(C.P.isLogin),[l,c,d]=(0,T.k)(e=>[C.f.nickName(e),C.f.username(e),e.subscriptionPlan]);return(0,a.FD)(o.Flexbox,{align:"center",gap:12,horizontal:!0,justify:"space-between",paddingBlock:12,paddingInline:12,...s,children:[(0,a.FD)(o.Flexbox,{align:"center",gap:12,horizontal:!0,onClick:t,children:[(0,a.Y)(U.A,{background:n.colorFill,size:48,...e}),(0,a.FD)(o.Flexbox,{flex:1,gap:6,children:[(0,a.Y)("div",{className:i.nickname,children:l}),(0,a.Y)("div",{className:i.username,children:c})]})]}),r&&(0,a.Y)(F,{type:d})]})})},56790:(e,t,s)=>{s.d(t,{T:()=>l});var a=s(35245),i=s(77605);class n{async execute(e,t){let s=this.controllers.get(e);s&&s.abort("New request triggered");let a=new AbortController;this.controllers.set(e,a);try{return await t(a.signal)}finally{this.controllers.get(e)===a&&this.controllers.delete(e)}}cancel(e){let t=this.controllers.get(e);t&&(t.abort("Manually cancelled"),this.controllers.delete(e))}cancelAll(){for(let e of this.controllers.values())e.abort("All requests cancelled");this.controllers.clear()}constructor(){this.controllers=new Map}}let o=new n;class r{constructor(){this.createMessage=async({sessionId:e,...t})=>i.du.message.createMessage.mutate({...t,sessionId:e?this.toDbSessionId(e):void 0}),this.getMessages=async(e,t,s)=>await i.du.message.getMessages.query({groupId:s,sessionId:this.toDbSessionId(e),topicId:t}),this.getGroupMessages=async(e,t)=>await i.du.message.getMessages.query({groupId:e,topicId:t}),this.countMessages=async e=>i.du.message.count.query(e),this.countWords=async e=>i.du.message.countWords.query(e),this.rankModels=async()=>i.du.message.rankModels.query(),this.getHeatmaps=async()=>i.du.message.getHeatmaps.query(),this.updateMessageError=async(e,t,s)=>{let a=t.type?t:{body:t,message:t.message,type:"ApplicationRuntimeError"};return i.du.message.update.mutate({id:e,sessionId:s?.sessionId,topicId:s?.topicId,value:{error:a}})},this.updateMessagePluginArguments=async(e,t)=>{let s="string"==typeof t?t:JSON.stringify(t);return i.du.message.updateMessagePlugin.mutate({id:e,value:{arguments:s}})},this.updateMessage=async(e,t,s)=>i.du.message.update.mutate({id:e,sessionId:s?.sessionId,topicId:s?.topicId,value:t}),this.updateMessageTranslate=async(e,t)=>i.du.message.updateTranslate.mutate({id:e,value:t}),this.updateMessageTTS=async(e,t)=>i.du.message.updateTTS.mutate({id:e,value:t}),this.updateMessageMetadata=async(e,t,s)=>o.execute(`message-metadata-${e}`,a=>i.du.message.updateMetadata.mutate({id:e,sessionId:s?.sessionId,topicId:s?.topicId,value:t},{signal:a})),this.updateMessagePluginState=async(e,t,s)=>i.du.message.updatePluginState.mutate({id:e,sessionId:s?.sessionId,topicId:s?.topicId,value:t}),this.updateMessagePluginError=async(e,t,s)=>i.du.message.updatePluginError.mutate({id:e,sessionId:s?.sessionId,topicId:s?.topicId,value:t}),this.updateMessagePlugin=async(e,t,s)=>i.du.message.updateMessagePlugin.mutate({id:e,sessionId:s?.sessionId,topicId:s?.topicId,value:t}),this.updateMessageRAG=async(e,t,s)=>i.du.message.updateMessageRAG.mutate({id:e,sessionId:s?.sessionId,topicId:s?.topicId,value:t}),this.removeMessage=async(e,t)=>i.du.message.removeMessage.mutate({id:e,sessionId:t?.sessionId,topicId:t?.topicId}),this.removeMessages=async(e,t)=>i.du.message.removeMessages.mutate({ids:e,sessionId:t?.sessionId,topicId:t?.topicId}),this.removeMessagesByAssistant=async(e,t)=>i.du.message.removeMessagesByAssistant.mutate({sessionId:this.toDbSessionId(e),topicId:t}),this.removeMessagesByGroup=async(e,t)=>i.du.message.removeMessagesByGroup.mutate({groupId:e,topicId:t}),this.removeAllMessages=async()=>i.du.message.removeAllMessages.mutate(),this.toDbSessionId=e=>e===a.Ed?null:e}}let l=new r},61520:(e,t,s)=>{s.d(t,{P:()=>c,f:()=>l});var a=s(74551),i=s(96987),n=s(96773);let o=a.Se,r=e=>n.S4?e.isSignedIn?e.user?.username:"anonymous":a.xl?e.user?.username:o,l={displayUserName:e=>r(e)||e.user?.email||"",email:e=>e.user?.email||"",fullName:e=>e.user?.fullName||"",nickName:e=>{let t=e.user?.fullName||e.user?.username;return n.S4?e.isSignedIn?t:(0,i.t)("userPanel.anonymousNickName",{ns:"common"}):a.xl?t:(0,i.t)("userPanel.defaultNickname",{ns:"common"})},userAvatar:e=>e.user?.avatar||"",userId:e=>e.user?.id,userProfile:e=>e.user,username:r},c={isLoaded:e=>e.isLoaded,isLogin:e=>!n.S4||e.isSignedIn,isLoginWithAuth:e=>e.isSignedIn,isLoginWithClerk:e=>e.isSignedIn&&n.Nd||!1,isLoginWithNextAuth:e=>e.isSignedIn&&!!n.J_||!1}},71457:(e,t,s)=>{s.d(t,{U:()=>i});var a=s(74551);let i={hideSettingsMoveGuide:e=>e.preference.guide?.moveSettingsToAvatar,hideSyncAlert:e=>e.preference.hideSyncAlert,isPreferenceInit:e=>e.isUserStateInit,shouldTriggerFileInKnowledgeBaseTip:e=>"boolean"!=typeof e.preference.guide?.moveSettingsToAvatar,showUploadFileInKnowledgeBaseTip:e=>e.preference.guide?.uploadFileInKnowledgeBase,topicDisplayMode:e=>e.preference.topicDisplayMode||a.I4.topicDisplayMode,useCmdEnterToSend:e=>e.preference.useCmdEnterToSend||!1,userAllowTrace:e=>e.preference.telemetry}},72242:(e,t,s)=>{s.d(t,{A:()=>d});var a=s(28802),i=s(73166),n=s(15447),o=s(83034),r=s(59121),l=s(80457),c=s(56646);let d=(0,o.memo)(({onClick:e})=>{let{t}=(0,r.Bd)("auth"),{analytics:s}=(0,i.st)();return(0,a.FD)(a.FK,{children:[(0,a.Y)(c.A,{}),(0,a.Y)(l.Flexbox,{paddingBlock:12,paddingInline:16,width:"100%",children:(0,a.Y)(n.A,{block:!0,onClick:()=>{s?.track({name:"login_or_signup_clicked",properties:{spm:"homepage.login_or_signup.click"}}),e()},type:"primary",children:t("loginOrSignup")})})]})})},83395:(e,t,s)=>{s.d(t,{A:()=>S});var a=s(28802),i=s(67072),n=s(11577),o=s(83034),r=s(98724),l=s(99278),c=s(64861),d=s(64694),u=s(43262),g=s(38759),p=s(61520);let m=(0,n.rU)(({css:e,token:t})=>({clickable:e`
    position: relative;
    transition: all 200ms ease-out 0s;

    &::before {
      content: '';

      position: absolute;
      transform: skewX(-45deg) translateX(-400%);

      overflow: hidden;

      box-sizing: border-box;
      width: 25%;
      height: 100%;

      background: rgba(255, 255, 255, 50%);

      transition: all 200ms ease-out 0s;
    }

    &:hover {
      box-shadow: 0 0 0 2px ${t.colorPrimary};

      &::before {
        transform: skewX(-45deg) translateX(400%);
      }
    }
  `})),h=(0,o.forwardRef)(({size:e=40,background:t,clickable:s,className:n,style:h,...S},y)=>{let{styles:f,cx:b}=m(),[v,A]=(0,g.k)(e=>[p.f.userAvatar(e),p.f.username(e)]),k=(0,g.k)(p.P.isLogin),I=(0,d.p)(u.C.remoteServerUrl),w=(0,o.useMemo)(()=>k&&v?c.xl&&v.startsWith("/")&&I?I+v:v:l.CB,[k,v,I]);return(0,a.Y)(i.A,{alt:k&&A?A:r.Se,avatar:w,background:k&&v?t:"transparent",className:b(s&&f.clickable,n),ref:y,size:e,style:{flex:"none",...h},unoptimized:!0,...S})});h.displayName="UserAvatar";let S=h},91568:(e,t,s)=>{s.d(t,{V:()=>n});var a=s(83034),i=s(47858);let n=()=>{let e=(0,a.useRef)((0,i.uo)()),t=(0,a.useRef)((0,i.X5)()),s={isApple:e.current&&["mac os","ios"].includes(e.current?.toLowerCase()),isArc:(0,i.L6)(),isChrome:t.current?.toLowerCase()==="chrome",isChromium:t.current&&["chrome","edge","opera","brave"].includes(t.current?.toLowerCase()),isEdge:t.current?.toLowerCase()==="edge",isFirefox:t.current?.toLowerCase()==="firefox",isIOS:e.current?.toLowerCase()==="ios",isMacOS:e.current?.toLowerCase()==="mac os",isPWA:(0,i.Mu)(),isSafari:t.current?.toLowerCase()==="safari",isSonomaOrLaterSafari:(0,i.Fr)()};return(0,a.useMemo)(()=>({...s,isSupportInstallPWA:!s.isArc&&!s.isFirefox&&(s.isChromium&&!s.isIOS||s.isMacOS&&s.isSonomaOrLaterSafari)}),[])}},99756:(e,t,s)=>{s.d(t,{Ec:()=>n,GJ:()=>r,ZG:()=>o});var a=s(2644),i=s.n(a);let n=()=>i()().startOf("day"),o=()=>i()().subtract(1,"month").startOf("month").endOf("month"),r=(e,t=14)=>i()().diff(i()(e),"day")<t}}]);