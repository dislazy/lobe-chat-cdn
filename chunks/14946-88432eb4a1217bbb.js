(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14946],{22032:(e,t,a)=>{"use strict";a.d(t,{W:()=>n});var i=a(77605);class s{async createDocument(e){return i.du.document.createDocument.mutate(e)}async queryDocuments(){return i.du.document.queryDocuments.query()}async getDocumentById(e){return i.du.document.getDocumentById.query({id:e})}async deleteDocument(e){await i.du.document.deleteDocument.mutate({id:e})}async updateDocument(e){await i.du.document.updateDocument.mutate(e)}}let n=new s},34129:()=>{},38608:(e,t,a)=>{"use strict";a.d(t,{o:()=>n});var i=a(77605);class s{constructor(){this.parseFileContent=async(e,t)=>i.du.document.parseFileContent.mutate({id:e,skipExist:t}),this.createParseFileTask=async(e,t)=>i.du.chunk.createParseFileTask.mutate({id:e,skipExist:t}),this.retryParseFile=async e=>i.du.chunk.retryParseFileTask.mutate({id:e}),this.createEmbeddingChunksTask=async e=>i.du.chunk.createEmbeddingChunksTask.mutate({id:e}),this.semanticSearch=async(e,t)=>i.du.chunk.semanticSearch.mutate({fileIds:t,query:e}),this.semanticSearchForChat=async e=>i.du.chunk.semanticSearchForChat.mutate(e),this.deleteMessageRagQuery=async e=>i.du.message.removeMessageQuery.mutate({id:e})}}let n=new s},46355:(e,t,a)=>{"use strict";a.d(t,{E:()=>s,Y:()=>n});var i=a(77605);class s{constructor(){this.createFile=async(e,t)=>i.du.file.createFile.mutate({...e,knowledgeBaseId:t}),this.getFile=async e=>{let t=await i.du.file.findById.query({id:e});if(!t)throw Error("file not found");return{createdAt:t.createdAt,id:t.id,name:t.name,size:t.size,source:t.source,type:t.fileType,updatedAt:t.updatedAt,url:t.url}},this.removeFile=async e=>{await i.du.file.removeFile.mutate({id:e})},this.removeFiles=async e=>{await i.du.file.removeFiles.mutate({ids:e})},this.removeAllFiles=async()=>{await i.du.file.removeAllFiles.mutate()},this.getKnowledgeItems=async e=>i.du.file.getKnowledgeItems.query(e),this.getKnowledgeItem=async e=>i.du.file.getFileItemById.query({id:e}),this.checkFileHash=async e=>i.du.file.checkFileHash.mutate({hash:e}),this.removeFileAsyncTask=async(e,t)=>i.du.file.removeFileAsyncTask.mutate({id:e,type:t})}}let n=new s},56003:(e,t,a)=>{"use strict";a.d(t,{$:()=>W,x:()=>R});var i=a(50786),s=a(23993),n=a(41734);let r={chatUploadFileList:[],uploadingIds:[],...{documents:[],isDocumentListLoading:!1,localDocumentMap:new Map},creatingChunkingTaskIds:[],creatingEmbeddingTaskIds:[],dockUploadFileList:[],fileList:[],chunkDetailId:null,highlightChunkIds:[],similaritySearchChunks:[]};var l=a(96987),o=a(29914);let d=[".DS_Store","Thumbs.db","desktop.ini",".localized","ehthumbs.db","ehthumbs_vista.db"];var c=a(46355),u=a(38608),p=a(87050),m=a(85601);let h=(e,t)=>{switch(t.type){case"addFile":return(0,m.jM)(e,e=>{let{atStart:a,file:i}=t;a?e.unshift(i):e.push(i)});case"addFiles":return(0,m.jM)(e,e=>{let{atStart:a,files:i}=t;for(let t of i)a?e.unshift(t):e.push(t)});case"updateFile":return(0,m.jM)(e,e=>{let a=e.find(e=>e.id===t.id);a&&Object.assign(a,t.value)});case"updateFileStatus":return(0,m.jM)(e,e=>{let a=e.find(e=>e.id===t.id);a&&(a.status=t.status)});case"updateFileUploadState":return(0,m.jM)(e,e=>{let a=e.find(e=>e.id===t.id);a&&(a.uploadState=t.uploadState)});case"removeFile":return(0,m.jM)(e,e=>{let a=e.findIndex(e=>e.id===t.id);-1!==a&&e.splice(a,1)});case"removeFiles":return(0,m.jM)(e,e=>{for(let a of t.ids){let t=e.findIndex(e=>e.id===a);-1!==t&&e.splice(t,1)}});default:throw Error("Unhandled action type")}};var g=a(90089),y=a(40616),f=a(61497),w=a(30791).hp;let S=(0,f.K)("chat");var D=a(22032),F=a(69515);let E=(0,f.K)("document"),T=new Set(["editor","file","api"]),_=new Set(["custom/document","application/pdf"]),v="custom/document",I=e=>T.has(e.sourceType)&&_.has(e.fileType);var L=a(53493),C=a(64911),k=a(46265),A=a(28958);let U=e=>({bmp:"image/bmp",c:"text/x-c",cpp:"text/x-c++",cs:"text/x-csharp",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",gif:"image/gif",go:"text/x-go",html:"text/html",java:"text/x-java",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsx:"text/javascript",md:"text/markdown",pdf:"application/pdf",php:"application/x-httpd-php",png:"image/png",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",py:"text/x-python",rb:"text/x-ruby",rs:"text/x-rust",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",ts:"text/typescript",tsx:"text/typescript",txt:"text/plain",webp:"image/webp",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml"})[e.split(".").pop()?.toLowerCase()||""]||"application/octet-stream",P=async e=>new Promise((t,a)=>{e.arrayBuffer().then(e=>{let i=new Uint8Array(e);(0,A.$1)(i,(e,i)=>{if(e)return void a(e);let s=[];for(let[e,t]of Object.entries(i)){if(e.endsWith("/")||e.includes("__MACOSX")||e.startsWith("."))continue;let a=e.split("/").pop()||e,i=new File([new Blob([new Uint8Array(t)],{type:U(a)})],a,{type:U(a)});s.push(i)}t(s)})}).catch(()=>{a(Error("Failed to read ZIP file"))})});var b=a(81962);let x=new c.E,M="useFetchKnowledgeItems";var N=a(65103),O=a(98724);let B=async e=>{if("string"==typeof e){if(!e.startsWith("data:image/"))return}else if(!e.type.startsWith("image/"))return;return new Promise(t=>{let a=new Image,i=null;a.addEventListener("load",()=>{t({height:a.naturalHeight,width:a.naturalWidth}),i&&URL.revokeObjectURL(i)}),a.addEventListener("error",()=>{i&&URL.revokeObjectURL(i),t(void 0)}),"string"==typeof e?a.src=e:a.src=i=URL.createObjectURL(e)})},j=(0,n.t)("file"),R=(0,s.h)()(j((...e)=>({...r,...((e,t)=>({clearChatUploadFileList:()=>{e({chatUploadFileList:[]},!1,S("clearChatUploadFileList"))},dispatchChatUploadFileList:a=>{let i=h(t().chatUploadFileList,a);i!==t().chatUploadFileList&&e({chatUploadFileList:i},!1,`dispatchChatFileList/${a.type}`)},removeChatUploadFile:async e=>{let{dispatchChatUploadFileList:a}=t();a({id:e,type:"removeFile"}),await c.Y.removeFile(e)},startAsyncTask:async(e,t,a)=>{await t(e);let i=!1;for(;!i;){let t;await (0,y.y)(2e3);try{t=await c.Y.getKnowledgeItem(e)}catch(e){console.error("getFileItem Error:",e);continue}if(!t)return;a(t),t.finishEmbedding?i=!0:("error"===t.chunkingStatus||"error"===t.embeddingStatus)&&(i=!0)}},uploadChatFiles:async e=>{let{dispatchChatUploadFileList:a}=t(),i=e.filter(e=>!d.includes(e.name));a({files:await Promise.all(i.map(async e=>{let t,a;if(e.type.startsWith("image")||e.type.startsWith("video")){let i=await e.arrayBuffer();t=URL.createObjectURL(new Blob([i],{type:e.type}));let s=w.from(i).toString("base64");a=`data:${e.type};base64,${s}`}return{base64Url:a,file:e,id:e.name,previewUrl:t,status:"pending"}})),type:"addFiles"});let s=i.map(async e=>{let i;try{i=await t().uploadWithProgress({file:e,onStatusUpdate:a})}catch(t){t?.message!=="UNAUTHORIZED"&&o.Ew.error({description:t===p.e?(0,l.t)("upload.networkError",{ns:"error"}):"string"==typeof t?t:(0,l.t)("upload.unknownError",{ns:"error",reason:t.message}),message:(0,l.t)("upload.uploadFailed",{ns:"error"})}),a({id:e.name,type:"removeFile"})}!i||(0,g.P)(e.type)||console.log(await u.o.parseFileContent(i.id))});await Promise.all(s)}}))(...e),...((e,t)=>({createDocument:async({title:e,content:t,knowledgeBaseId:a})=>{let i=Date.now();return await D.W.createDocument({content:t,editorData:"{}",fileType:v,knowledgeBaseId:a,metadata:{createdAt:i},title:e})},createOptimisticDocument:(a="Untitled")=>{let{localDocumentMap:i}=t(),s=`temp-document-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,n=new Date,r={content:null,createdAt:n,editorData:null,fileType:v,filename:a,id:s,metadata:{},source:"document",sourceType:F.h.EDITOR,title:a,totalCharCount:0,totalLineCount:0,updatedAt:n},l=new Map(i);return l.set(s,r),e({localDocumentMap:l},!1,E("createOptimisticDocument")),s},duplicateDocument:async a=>{let i=await D.W.getDocumentById(a);if(!i)throw Error(`Document with ID ${a} not found`);let s=await D.W.createDocument({content:i.content||"",editorData:i.editorData?"string"==typeof i.editorData?i.editorData:JSON.stringify(i.editorData):"{}",fileType:i.fileType,metadata:{...i.metadata,createdAt:Date.now(),duplicatedFrom:a},title:`${i.title} (Copy)`}),{localDocumentMap:n}=t(),r=new Map(n),l={content:s.content||null,createdAt:s.createdAt?new Date(s.createdAt):new Date,editorData:"string"==typeof s.editorData?JSON.parse(s.editorData):s.editorData||null,fileType:s.fileType,filename:s.title||s.filename||"",id:s.id,metadata:s.metadata||{},source:"document",sourceType:F.h.EDITOR,title:s.title||"",totalCharCount:s.content?.length||0,totalLineCount:0,updatedAt:s.updatedAt?new Date(s.updatedAt):new Date};return r.set(s.id,l),e({localDocumentMap:r},!1,E("duplicateDocument")),s},fetchDocuments:async()=>{e({isDocumentListLoading:!0},!1,E("fetchDocuments/start"));try{let a=(await D.W.queryDocuments()).filter(I).map(e=>({...e,filename:e.filename??e.title??"Untitled"}));e({documents:a,isDocumentListLoading:!1},!1,E("fetchDocuments/success"));let{localDocumentMap:i}=t(),s=new Map(i);for(let[e]of i.entries())e.startsWith("temp-document-")&&s.delete(e);e({localDocumentMap:s},!1,E("fetchDocuments/syncLocalMap"))}catch(t){throw console.error("Failed to fetch documents:",t),e({isDocumentListLoading:!1},!1,E("fetchDocuments/error")),t}},getOptimisticDocuments:()=>{let{localDocumentMap:e,documents:a}=t(),i=new Set,s=a.map(t=>{i.add(t.id);let a=e.get(t.id);return a&&new Date(a.updatedAt)>=new Date(t.updatedAt)?a:t});for(let[t,a]of e.entries())i.has(t)||s.unshift(a);return s},removeDocument:async a=>{let{localDocumentMap:i,documents:s}=t(),n=new Map(i);n.delete(a),e({documents:s.filter(e=>e.id!==a),localDocumentMap:n},!1,E("removeDocument/optimistic"));try{await D.W.deleteDocument(a)}catch(t){throw console.error("Failed to delete document:",t),e({documents:s,localDocumentMap:new Map(i)},!1,E("removeDocument/restore")),t}},removeTempDocument:a=>{let{localDocumentMap:i}=t(),s=new Map(i);s.delete(a),e({localDocumentMap:s},!1,E("removeTempDocument"))},replaceTempDocumentWithReal:(a,i)=>{let{localDocumentMap:s}=t(),n=new Map(s);n.delete(a),n.set(i.id,i),e({localDocumentMap:n},!1,E("replaceTempDocumentWithReal"))},updateDocumentOptimistically:async(a,i)=>{let{localDocumentMap:s,documents:n}=t(),r=s.get(a);if(r||(r=n.find(e=>e.id===a)),!r)return void console.warn("[updateDocumentOptimistically] Document not found:",a);let l=void 0!==i.metadata?{...r.metadata,...i.metadata}:r.metadata,o=l?Object.fromEntries(Object.entries(l).filter(([,e])=>void 0!==e)):{},d={...r,...i,metadata:o,title:i.title||r.title,updatedAt:new Date},c=new Map(s);c.set(a,d),e({localDocumentMap:c},!1,E("updateDocumentOptimistically"));try{await D.W.updateDocument({content:d.content||"",editorData:"string"==typeof d.editorData?d.editorData:JSON.stringify(d.editorData||{}),id:a,metadata:d.metadata||{},title:d.title||d.filename})}catch(i){console.error("[updateDocumentOptimistically] Failed to sync to DB:",i);let t=new Map(s);r?t.set(a,r):t.delete(a),e({localDocumentMap:t},!1,E("revertOptimisticUpdate"))}}}))(...e),...((e,t)=>({dispatchDockFileList:a=>{let i=h(t().dockUploadFileList,a);i!==t().dockUploadFileList&&e({dockUploadFileList:i},!1,`dispatchDockFileList/${a.type}`)},embeddingChunks:async e=>{t().toggleEmbeddingIds(e);let a=e.map(async e=>{try{await u.o.createEmbeddingChunksTask(e)}catch(e){console.error(e)}});await Promise.all(a),await t().refreshFileList(),t().toggleEmbeddingIds(e,!1)},parseFilesToChunks:async(e,a)=>{t().toggleParsingIds(e);let i=e.map(async e=>{try{await u.o.createParseFileTask(e,a?.skipExist)}catch(e){console.error(e)}});await Promise.all(i),await t().refreshFileList(),t().toggleParsingIds(e,!1)},pushDockFileList:async(e,a)=>{let{dispatchDockFileList:i}=t(),s=[];for(let t of e)if("application/zip"===t.type||t.name.endsWith(".zip"))try{let e=await P(t);s.push(...e)}catch(e){console.error("Failed to extract ZIP file:",e),s.push(t)}else s.push(t);let n=s.filter(e=>!d.includes(e.name));i({atStart:!0,files:n.map(e=>({file:e,id:e.name,status:"pending"})),type:"addFiles"});let r=(await (0,L.Ay)(n,async e=>{let s=await t().uploadWithProgress({file:e,knowledgeBaseId:a,onStatusUpdate:i});return await t().refreshFileList(),{file:e,fileId:s?.id,fileType:e.type}},{concurrency:10})).filter(({fileType:e,fileId:t})=>t&&!(0,g.P)(e)).map(({fileId:e})=>e);r.length>0&&await t().parseFilesToChunks(r,{skipExist:!1})},reEmbeddingChunks:async e=>{b.S.isCreatingChunkEmbeddingTask(e)(t())||(t().toggleEmbeddingIds([e]),await x.removeFileAsyncTask(e,"embedding"),await t().refreshFileList(),await u.o.createEmbeddingChunksTask(e),await t().refreshFileList(),t().toggleEmbeddingIds([e],!1))},reParseFile:async e=>{t().toggleParsingIds([e]),await u.o.retryParseFile(e),await t().refreshFileList(),t().toggleParsingIds([e],!1)},refreshFileList:async()=>{await (0,C.j)([M,t().queryListParams])},removeAllFiles:async()=>{await c.Y.removeAllFiles()},removeFileItem:async e=>{await c.Y.removeFile(e),await t().refreshFileList()},removeFiles:async e=>{await c.Y.removeFiles(e),await t().refreshFileList()},toggleEmbeddingIds:(t,a)=>{e(e=>{let i=new Set(e.creatingEmbeddingTaskIds);return t.forEach(e=>{void 0===a?i.has(e)?i.delete(e):i.add(e):a?i.add(e):i.delete(e)}),{creatingEmbeddingTaskIds:Array.from(i.values())}})},toggleParsingIds:(t,a)=>{e(e=>{let i=new Set(e.creatingChunkingTaskIds);return t.forEach(e=>{void 0===a?i.has(e)?i.delete(e):i.add(e):a?i.add(e):i.delete(e)}),{creatingChunkingTaskIds:Array.from(i.values())}})},useFetchKnowledgeItem:e=>(0,k.lA)(e?["useFetchKnowledgeItem",e]:null,()=>x.getKnowledgeItem(e)),useFetchKnowledgeItems:t=>(0,k.lA)([M,t],()=>x.getKnowledgeItems(t),{onSuccess:a=>{e({fileList:a,queryListParams:t})}})}))(...e),...((e,t)=>({removeTTSFile:async e=>{await c.Y.removeFile(e)},uploadTTSByArrayBuffers:async(e,a)=>{let i="audio/mp3",s=new File([new Blob(a,{type:i})],`${e}.mp3`,{lastModified:Date.now(),type:i}),n=await t().uploadWithProgress({file:s,skipCheckFileType:!0});return n?.id},useFetchTTSFile:e=>(0,k.lA)(e?["fetchTTSFile",e]:null,()=>c.Y.getFile(e))}))(...e),...(e=>({closeChunkDrawer:()=>{e({chunkDetailId:null,isSimilaritySearch:!1,similaritySearchChunks:[]})},highlightChunks:t=>{e({highlightChunkIds:t})},openChunkDrawer:t=>{e({chunkDetailId:t})},semanticSearch:async(t,a)=>{e({isSimilaritySearching:!0}),e({isSimilaritySearching:!1,similaritySearchChunks:await u.o.semanticSearch(t,[a])})}}))(...e),...(()=>({uploadBase64FileWithProgress:async e=>{let t=await B(e),{metadata:a,fileType:i,size:s,hash:n}=await p.z.uploadBase64ToS3(e);return{...await c.Y.createFile({fileType:i,hash:n,metadata:a,name:a.filename,size:s,url:a.path}),dimensions:t,filename:a.filename}},uploadWithProgress:async({file:e,onStatusUpdate:t,knowledgeBaseId:i,skipCheckFileType:s})=>{let n,r=await e.arrayBuffer(),d=await B(e),u=(0,N.sha256)(r),m=await c.Y.checkFileHash(u);if(m.isExist)n=m.metadata,t?.({id:e.name,type:"updateFile",value:{status:"processing",uploadState:{progress:100,restTime:0,speed:0}}});else{let{data:a,success:i}=await p.z.uploadFileToS3(e,{onNotSupported:()=>{t?.({id:e.name,type:"removeFile"}),o.iU.info({content:(0,l.t)("upload.fileOnlySupportInServerMode",{cloud:O.IS,ext:e.name.split(".").pop(),ns:"error"}),duration:5})},onProgress:(a,i)=>{t?.({id:e.name,type:"updateFile",value:{status:"success"===a?"processing":a,uploadState:i}})},skipCheckFileType:s});if(!i)return;n=a}let h=e.type;if(!e.type){let{fileTypeFromBuffer:e}=await a.e(78960).then(a.bind(a,78960)),t=await e(r);h=t?.mime||"text/plain"}let g=await c.Y.createFile({fileType:h,hash:u,metadata:n,name:e.name,size:e.size,url:n.path||m.url},i);return t?.({id:e.name,type:"updateFile",value:{fileUrl:g.url,id:g.id,status:"success",uploadState:{progress:100,restTime:0,speed:0}}}),{...g,dimensions:d,filename:e.name}}}))(...e)})),i.x),W=()=>R.getState()},81962:(e,t,a)=>{"use strict";a.d(t,{S:()=>s});let i=new Set(["uploading","pending","processing"]),s={dockFileList:e=>e.dockUploadFileList,dockRawFileList:e=>e.dockUploadFileList.map(e=>e.file),getFileById:e=>t=>{if(e)return t.fileList.find(t=>t.id===e)},isCreatingChunkEmbeddingTask:e=>t=>t.creatingEmbeddingTaskIds.includes(e),isCreatingFileParseTask:e=>t=>t.creatingChunkingTaskIds.includes(e),isUploadingFiles:e=>e.dockUploadFileList.some(e=>i.has(e.status)),overviewUploadingProgress:e=>{let t=e.dockUploadFileList.filter(e=>"uploading"===e.status||"pending"===e.status);if(0===t.length)return 100;let a=100*t.length;return t.reduce((e,t)=>e+(t.uploadState?.progress||0),0)/a*100},overviewUploadingStatus:e=>0===e.dockUploadFileList.length?"pending":e.dockUploadFileList.some(e=>i.has(e.status))?"uploading":"success"}},82432:()=>{},87050:(e,t,a)=>{"use strict";let i;a.d(t,{e:()=>y,z:()=>S});var s=a(74551),n=a(16748),r=a(60317),l=a(2644),o=a.n(l),d=a(65103),c=a(53452),u=a(20434),p=a(55036);let m=(p.env.NEXT_PUBLIC_S3_DOMAIN&&console.warn("⚠️ `NEXT_PUBLIC_S3_DOMAIN` will be de deprecated in the next major version, please replace it with `S3_PUBLIC_DOMAIN` in your env"),i=p.env.S3_PUBLIC_DOMAIN||p.env.NEXT_PUBLIC_S3_DOMAIN,(0,c.w)({client:{NEXT_PUBLIC_S3_DOMAIN:u.Yj().optional(),NEXT_PUBLIC_S3_FILE_PATH:u.Yj().optional()},runtimeEnv:{CHUNKS_AUTO_EMBEDDING:"0"!==p.env.CHUNKS_AUTO_EMBEDDING,CHUNKS_AUTO_GEN_METADATA:"0"!==p.env.CHUNKS_AUTO_GEN_METADATA,NEXT_PUBLIC_S3_DOMAIN:p.env.NEXT_PUBLIC_S3_DOMAIN,NEXT_PUBLIC_S3_FILE_PATH:p.env.NEXT_PUBLIC_S3_FILE_PATH||"files",S3_ACCESS_KEY_ID:p.env.S3_ACCESS_KEY_ID,S3_BUCKET:p.env.S3_BUCKET,S3_ENABLE_PATH_STYLE:"1"===p.env.S3_ENABLE_PATH_STYLE,S3_ENDPOINT:p.env.S3_ENDPOINT,S3_PREVIEW_URL_EXPIRE_IN:parseInt(p.env.S3_PREVIEW_URL_EXPIRE_IN||"7200"),S3_PUBLIC_DOMAIN:i,S3_REGION:p.env.S3_REGION,S3_SECRET_ACCESS_KEY:p.env.S3_SECRET_ACCESS_KEY,S3_SET_ACL:"0"!==p.env.S3_SET_ACL},server:{CHUNKS_AUTO_EMBEDDING:u.zM(),CHUNKS_AUTO_GEN_METADATA:u.zM(),S3_ACCESS_KEY_ID:u.Yj().optional(),S3_BUCKET:u.Yj().optional(),S3_ENABLE_PATH_STYLE:u.zM(),S3_ENDPOINT:u.Yj().url().optional(),S3_PREVIEW_URL_EXPIRE_IN:u.ai(),S3_PUBLIC_DOMAIN:u.Yj().url().optional(),S3_REGION:u.Yj().optional(),S3_SECRET_ACCESS_KEY:u.Yj().optional(),S3_SET_ACL:u.zM()}}));var h=a(77605),g=a(32308);let y="NetWorkError",f=(e,t={})=>{let a=e.split(".").at(-1),i=`${(0,r.uR)()}.${a}`,s=(Date.now()/1e3/60/60).toFixed(0),n=`${t.directory||m.NEXT_PUBLIC_S3_FILE_PATH}/${s}`,l=t.pathname??`${n}/${i}`;return{date:s,dirname:n,filename:i,pathname:l}};class w{constructor(){this.uploadFileToS3=async(e,{onProgress:t,directory:i,pathname:n})=>{let{getElectronStoreState:r}=await Promise.all([a.e(64694),a.e(70838)]).then(a.bind(a,70838)),{electronSyncSelectors:l}=await a.e(87055).then(a.bind(a,87055)),o=r(),d=l.isSyncActive(o);return s.xl&&!d?{data:await this.uploadToDesktopS3(e,{directory:i,pathname:n}),success:!0}:{data:await this.uploadToServerS3(e,{directory:i,onProgress:t,pathname:n}),success:!0}},this.uploadBase64ToS3=async(e,t={})=>{let{base64:a,mimeType:i,type:s}=(0,n.W$)(e);if(!a||!i||"base64"!==s)throw Error("Invalid base64 data for image");let r=atob(a),l=[];for(let e=0;e<r.length;e+=1024){let t=r.slice(e,e+1024),a=Array.from({length:t.length});for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);let i=new Uint8Array(a);l.push(i)}let c=new Blob(l,{type:i}),u=i.split("/")[1]||"png",p=new File([c],`${t.filename||`image_${o()().format("YYYY-MM-DD-hh-mm-ss")}`}.${u}`,{type:i}),{data:m}=await this.uploadFileToS3(p,t);return{fileType:i,hash:(0,d.sha256)(await p.arrayBuffer()),metadata:m,size:p.size}},this.uploadDataToS3=async(e,t={})=>{let a=new File([new Blob([JSON.stringify(e)],{type:"application/json"})],t.filename||"data.json",{type:"application/json"});return await this.uploadFileToS3(a,t)},this.uploadToServerS3=async(e,{onProgress:t,directory:a,pathname:i})=>{let s=new XMLHttpRequest,{preSignUrl:n,...r}=await this.getSignedUploadUrl(e,{directory:a,pathname:i}),l=Date.now();s.upload.addEventListener("progress",e=>{if(e.lengthComputable){let a=Number((e.loaded/e.total*100).toFixed(1)),i=e.loaded/((Date.now()-l)/1e3);t?.("uploading",{progress:100===a?99.9:a,restTime:(e.total-e.loaded)/i,speed:i})}}),s.open("PUT",n),s.setRequestHeader("Content-Type",e.type);let o=await e.arrayBuffer();return await new Promise((a,i)=>{s.addEventListener("load",()=>{s.status>=200&&s.status<300?(t?.("success",{progress:100,restTime:0,speed:e.size/((Date.now()-l)/1e3)}),a(s.response)):i(s.statusText)}),s.addEventListener("error",()=>{0===s.status?i(y):i(s.statusText)}),s.send(o)}),r},this.uploadToDesktopS3=async(e,t={})=>{let i=await e.arrayBuffer(),s=(0,d.sha256)(i),{pathname:n}=f(e.name,t),{desktopFileAPI:r}=await a.e(27375).then(a.bind(a,27375)),{metadata:l}=await r.uploadFile(e,s,n);return l},this.getImageFileByUrlWithCORS=async(e,t,a="image/png")=>{let i=await fetch(g.Sn.proxy,{body:e,method:"POST"});return new File([await i.arrayBuffer()],t,{lastModified:Date.now(),type:a})},this.getSignedUploadUrl=async(e,t={})=>{let{date:a,dirname:i,filename:s,pathname:n}=f(e.name,t),r=await h.du.upload.createS3PreSignedUrl.mutate({pathname:n});return{date:a,dirname:i,filename:s,path:n,preSignUrl:r}}}}let S=new w},90089:(e,t,a)=>{"use strict";a.d(t,{P:()=>i});let i=e=>!!(e.startsWith("image")||e.startsWith("video")||e.startsWith("audio"))}}]);