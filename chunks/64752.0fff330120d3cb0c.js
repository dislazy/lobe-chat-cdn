"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42371,64752],{1261:(e,t,i)=>{i.d(t,{A:()=>r});let r=function(){}},5750:(e,t,i)=>{i.d(t,{F:()=>o});var r=i(77605);class a{constructor(){this.createAiProvider=async e=>r.du.aiProvider.createAiProvider.mutate(e),this.getAiProviderList=async()=>r.du.aiProvider.getAiProviderList.query(),this.getAiProviderById=async e=>r.du.aiProvider.getAiProviderById.query({id:e}),this.toggleProviderEnabled=async(e,t)=>r.du.aiProvider.toggleProviderEnabled.mutate({enabled:t,id:e}),this.updateAiProvider=async(e,t)=>r.du.aiProvider.updateAiProvider.mutate({id:e,value:t}),this.updateAiProviderConfig=async(e,t)=>r.du.aiProvider.updateAiProviderConfig.mutate({id:e,value:t}),this.updateAiProviderOrder=async e=>r.du.aiProvider.updateAiProviderOrder.mutate({sortMap:e}),this.deleteAiProvider=async e=>r.du.aiProvider.removeAiProvider.mutate({id:e}),this.getAiProviderRuntimeState=async e=>r.du.aiProvider.getAiProviderRuntimeState.query({isLogin:e})}}let o=new a},24225:(e,t,i)=>{i.d(t,{A:()=>c});var r=i(79220),a=i(38342),o=i(50558),n=i(74744),s=i(61362),d=i(1261),l=i(992),u=s.A&&1/(0,l.A)(new s.A([,-0]))[1]==1/0?function(e){return new s.A(e)}:d.A;let c=function(e,t,i){var s=-1,d=a.A,c=e.length,g=!0,v=[],m=v;if(i)g=!1,d=o.A;else if(c>=200){var p=t?null:u(e);if(p)return(0,l.A)(p);g=!1,d=n.A,m=new r.A}else m=t?[]:v;e:for(;++s<c;){var A=e[s],f=t?t(A):A;if(A=i||0!==A?A:0,g&&f==f){for(var h=m.length;h--;)if(m[h]===f)continue e;t&&m.push(f),v.push(A)}else d(m,f,i)||(m!==v&&m.push(f),v.push(A))}return v}},27809:(e,t,i)=>{i.d(t,{P:()=>r});let r=async(e,t,i=!0)=>{try{let i=await fetch(e,{cache:"no-store",credentials:"omit",mode:"cors"});if(!i.ok)throw Error(`Failed to fetch image: ${i.status} ${i.statusText}`);let r=await i.blob(),a=window.URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=t,o.style.display="none",document.body.append(o),o.click(),o.remove(),window.URL.revokeObjectURL(a)}catch(t){if(console.log("Download failed:",t),i)window.open(e);else throw t}}},32901:(e,t,i)=>{i.d(t,{Om:()=>m,SU:()=>a,qp:()=>s,PE:()=>d.P,HP:()=>l,Vz:()=>u,rX:()=>A,pU:()=>h});class r{getKeyStore(e){let t=this._cache.get(e);if(!t){let i=e.split(",").map(e=>e.trim()).filter(e=>!!e);t={index:0,keyLen:i.length,keys:i},this._cache.set(e,t)}return t}pick(e=""){if(!e)return;let t=this.getKeyStore(e),i=0;return"turn"===this._mode&&(i=t.index++%t.keyLen),"random"===this._mode&&(i=Math.floor(Math.random()*t.keyLen)),t.keys[i]}constructor(){this._cache=new Map,this._mode="random"}}let a=new r,o=e=>{let t=new Image;t.addEventListener("load",function(){let e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0);try{e.toBlob(function(e){let t=new ClipboardItem({"image/png":e});navigator.clipboard.write([t]).then(function(){console.log("Image copied to clipboard successfully using canvas and modern API")})})}catch{let t=e.toDataURL("image/png"),i=document.createElement("textarea");i.value=t,document.body.append(i),i.select(),document.execCommand("copy"),i.remove()}}),t.src=e},n=async e=>{try{let t=await fetch(e),i=await t.blob(),r=new ClipboardItem({"image/png":i});await navigator.clipboard.write([r])}catch(t){console.error("Failed to copy image using modern API:",t),o(e)}},s=async e=>{navigator.clipboard&&"write"in navigator.clipboard?await n(e):o(e)};var d=i(27809);let l=(e,t)=>{let i=new Blob([e],{type:"plain/text"}),r=URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=t||"file.txt",document.body.append(a),a.click(),URL.revokeObjectURL(r),a.remove()},u=(e,t)=>{let i=new Blob([JSON.stringify(e)],{type:"application/json"}),r=URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=t,document.body.append(a),a.click(),URL.revokeObjectURL(r),a.remove()};var c=i(38759),g=i(61520),v=i(46322);let m={date:()=>new Date().toLocaleDateString(),datetime:()=>new Date().toLocaleString(),day:()=>new Date().getDate().toString().padStart(2,"0"),hour:()=>new Date().getHours().toString().padStart(2,"0"),iso:()=>new Date().toISOString(),locale:()=>Intl.DateTimeFormat().resolvedOptions().locale,minute:()=>new Date().getMinutes().toString().padStart(2,"0"),month:()=>(new Date().getMonth()+1).toString().padStart(2,"0"),second:()=>new Date().getSeconds().toString().padStart(2,"0"),time:()=>new Date().toLocaleTimeString(),timestamp:()=>Date.now().toString(),timezone:()=>Intl.DateTimeFormat().resolvedOptions().timeZone,weekday:()=>new Date().toLocaleDateString("en-US",{weekday:"long"}),year:()=>new Date().getFullYear().toString(),email:()=>g.f.email(c.k.getState())??"",nickname:()=>g.f.nickName(c.k.getState())??"",username:()=>g.f.displayUserName(c.k.getState())??g.f.fullName(c.k.getState())??"",random:()=>Math.floor(1e6*Math.random()+1).toString(),random_bool:()=>Math.random()>.5?"true":"false",random_float:()=>(100*Math.random()).toFixed(2),random_hex:()=>Math.floor(0xffffff*Math.random()).toString(16).padStart(6,"0"),random_int:()=>Math.floor(100*Math.random()+1).toString(),random_string:()=>Math.random().toString(36).slice(2,15),random_digit:()=>Math.floor(10*Math.random()).toString(),uuid:()=>(0,v.uR)(),uuid_short:()=>(0,v.uR)().split("-")[0],language:()=>"undefined"!=typeof navigator?navigator.language:"",platform:()=>"undefined"!=typeof navigator?navigator.platform:"",user_agent:()=>"undefined"!=typeof navigator?navigator.userAgent:""};var p=i(83663);let A=e=>p.A.sanitize(e,{FORBID_ATTR:["onblur","onchange","onclick","onerror","onfocus","onkeydown","onkeypress","onkeyup","onload","onmousedown","onmouseout","onmouseover","onmouseup","onreset","onselect","onsubmit","onunload"],FORBID_TAGS:["embed","link","object","script","style"],KEEP_CONTENT:!1,USE_PROFILES:{svg:!0,svgFilters:!0}});var f=i(9402);let h=e=>{if(!e.type.startsWith("video/"))return{isValid:!0};let t=e.size<=0x1400000;return{actualSize:(0,f.Xq)(e.size),isValid:t}}},38342:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(60506);let a=function(e,t){return!!(null==e?0:e.length)&&(0,r.A)(e,t,0)>-1}},38759:(e,t,i)=>{i.d(t,{c:()=>k,k:()=>_});var r=i(14308),a=i(50786),o=i(23993),n=i(41734),s=i(89872);let d={preference:s.I},l={...{defaultSettings:i(74551).a$,settings:{}},...d,...{},...{isOnboard:!1,isShowPWAGuide:!1,isUserCanEnableTrace:!1,isUserHasConversation:!1,isUserStateInit:!1}};var u=i(96773),c=i(70674),g=i(64911),v=i(85366),m=i(46265),p=i(55582),A=i(67095),f=i(61497),h=i(71457);let P=(0,f.K)("common"),y="initUserState",S=(0,f.K)("preference");var w=i(31021),M=i.n(w),L=i(19530),b=i(45628);class I{constructor(){this.createShareSettingsUrl=e=>`/?${b.N}=${encodeURI(JSON.stringify(e))}`,this.decodeShareSettings=e=>{try{return{data:JSON.parse(e)}}catch(e){return{message:JSON.stringify(e)}}}}}let U=new I;var R=i(34743),C=i(1866),E=i(28074);let T=(0,n.t)("user"),_=(0,o.h)()((0,r.eh)(T((...e)=>({...l,...((e,t)=>({addToolToAllowList:async e=>{let i=t().settings.tool?.humanIntervention?.allowList||[];i.includes(e)||await t().setSettings({tool:{humanIntervention:{allowList:[...i,e]}}})},importAppSettings:async e=>{let{setSettings:i}=t();await i(e)},importUrlShareSettings:async e=>{if(e){let i=U.decodeShareSettings(e);!i?.message&&i?.data&&await t().setSettings(i.data)}},internal_createSignal:()=>{let i=t().updateSettingsSignal;i&&!i.signal.aborted&&i.abort(L.ve);let r=new AbortController;return e({updateSettingsSignal:r},!1,"signalForUpdateSettings"),r},resetSettings:async()=>{await p.W.resetUserSettings(),await t().refreshUserState()},setSettings:async i=>{let r,{settings:a,defaultSettings:o}=t(),n=(0,A.h)(a,i);if(M()(a,n))return;let s=(r=(e,t)=>(0,R.A)(e,(e,i,a)=>{(0,C.A)(i)&&(0,C.A)(t[a])?M()(i,t[a])||(e[a]=i):M()(i,t[a])||(e[a]=(0,E.A)(i)&&(0,E.A)(t[a])?r(i,t[a]):i)}))(n,o);e({settings:s},!1,"optimistic_updateSettings");let d=t().internal_createSignal();await p.W.updateUserSettings(s,d.signal),await t().refreshUserState()},updateDefaultAgent:async e=>{await t().setSettings({defaultAgent:e})},updateGeneralConfig:async e=>{await t().setSettings({general:e})},updateHumanIntervention:async e=>{let i=t().settings.tool?.humanIntervention||{};await t().setSettings({tool:{humanIntervention:{...i,...e}}})},updateKeyVaults:async e=>{await t().setSettings({keyVaults:e})},updateSystemAgent:async(e,i)=>{await t().setSettings({systemAgent:{[e]:{...i}}})}}))(...e),...((e,t)=>({updateGuideState:async e=>{let{updatePreference:i}=t(),r=(0,A.h)(t().preference.guide,e);await i({guide:r})},updateLab:async e=>{let{updatePreference:i}=t(),r=(0,A.h)(t().preference.lab,e);await i({lab:r},S("updateLab"))},updatePreference:async(i,r)=>{let a=(0,A.h)(t().preference,i);e({preference:a},!1,r||S("updatePreference")),await p.W.updatePreference(a)}}))(...e),...((e,t)=>({enableAuth:()=>u.S4,logout:async()=>{if(u.Nd)return void t().clerkSignOut?.({redirectUrl:location.toString()});if(u.J_){let{signOut:e}=await i.e(4975).then(i.bind(i,4975));e()}},openLogin:async()=>{if(u.Nd){let e=location.toString();t().clerkSignIn?.({fallbackRedirectUrl:e,signUpForceRedirectUrl:e,signUpUrl:"/signup"});return}if(u.J_){let{signIn:e}=await i.e(4975).then(i.bind(i,4975)),r=t()?.oAuthSSOProviders;if(r&&1===r.length)return void e(r[0]);e()}}}))(...e),...((e,t)=>({refreshUserState:async()=>{await (0,g.j)(y)},updateAvatar:async e=>{await p.W.updateAvatar(e),await t().refreshUserState()},updateKeyVaultConfig:async(e,i)=>{await t().setSettings({keyVaults:{[e]:i}})},useCheckTrace:e=>(0,v.Ay)(e?"checkTrace":null,()=>"boolean"==typeof h.U.userAllowTrace(t())?Promise.resolve(!1):Promise.resolve(t().isUserCanEnableTrace),{revalidateOnFocus:!1}),useInitUserState:(i,r,a)=>(0,m.Ju)(i?y:null,()=>p.W.getUserState(),{onError:e=>{a?.onError?.(e)},onSuccess:i=>{if(a?.onSuccess?.(i),i){let a={defaultAgent:r.defaultAgent,image:r.image,systemAgent:r.systemAgent},o=(0,A.h)(t().defaultSettings,a),n=0===Object.keys(i.preference||{}).length?s.I:i.preference,d=i.avatar||i.userId?(0,A.h)(t().user,{avatar:i.avatar,email:i.email,firstName:i.firstName,fullName:i.fullName,id:i.userId,latestName:i.lastName,username:i.username}):t().user;e({defaultSettings:o,isOnboard:i.isOnboard,isShowPWAGuide:i.canEnablePWAGuide,isUserCanEnableTrace:i.canEnableTrace,isUserHasConversation:i.hasConversation,isUserStateInit:!0,preference:n,settings:i.settings||{},subscriptionPlan:i.subscriptionPlan,user:d},!1,P("initUserState"));let l=(0,c.wZ)();l?.identify(i.userId||"",{email:i.email,firstName:i.firstName,lastName:i.lastName,username:i.username})}}})}))(...e)}))),a.x),k=()=>_.getState()},42897:(e,t,i)=>{i.d(t,{fe:()=>o,w0:()=>s});var r=i(74551),a=i(67095);let o=e=>(0,a.h)(e.defaultSettings,e.settings),n=e=>(0,a.h)(r.kz,o(e).defaultAgent),s={currentImageSettings:e=>o(e).image,currentSettings:o,currentSystemAgent:e=>(0,a.h)(r.fw,o(e).systemAgent),currentTTS:e=>(0,a.h)(r.Ff,o(e).tts),defaultAgent:n,defaultAgentConfig:e=>(0,a.h)(r.HA,n(e).config),defaultAgentMeta:e=>(0,a.h)(r.M3,n(e).meta),exportSettings:o,getHotkeyById:e=>t=>(0,a.h)(r.Ke,o(t).hotkey)[e],providerConfig:e=>t=>(o(t).languageModel||{})[e]}},45282:(e,t,i)=>{i.d(t,{t:()=>o});var r=i(42897);let a=e=>(0,r.fe)(e).keyVaults||{},o={getVaultByProvider:e=>t=>a(t)[e]||{},keyVaultsSettings:a,password:e=>a(e).password||""}},47260:(e,t,i)=>{i.d(t,{w:()=>l});var r=i(67400);let a=e=>e.aiProviderList.filter(e=>e.enabled).sort((e,t)=>e.sort-t.sort),o=e=>e.aiProviderDetail,n=new Set(["ollama","lmstudio"]),s=e=>o(e)?.keyVaults,d=e=>t=>{if(e)return t.aiProviderRuntimeConfig?.[e]},l={activeProviderConfig:o,disabledAiProviderList:e=>e.aiProviderList.filter(e=>!e.enabled),enabledAiProviderList:a,enabledImageModelList:e=>e.enabledImageModelList||[],isActiveProviderApiKeyNotEmpty:e=>{let t=s(e);return!!t?.apiKey||!!t?.accessKeyId||!!t?.secretAccessKey},isActiveProviderEndpointNotEmpty:e=>{let t=s(e);return!!t?.baseURL||!!t?.endpoint},isAiProviderConfigLoading:e=>t=>t.activeAiProvider!==e,isInitAiProviderRuntimeState:e=>!!e.isInitAiProviderRuntimeState,isProviderConfigUpdating:e=>t=>t.aiProviderConfigUpdatingIds.includes(e),isProviderEnableResponseApi:e=>t=>{let i=d(e)(t),r=i?.config?.enableResponseApi;return"boolean"==typeof r?r:"openai"===e},isProviderEnabled:e=>t=>a(t).some(t=>t.id===e),isProviderFetchOnClient:e=>t=>{let i=d(e)(t);if((0,r.isProviderDisableBrowserRequest)(e))return!1;if(n.has(e)&&void 0!==i?.fetchOnClient)return i?.fetchOnClient;let a=!!i?.keyVaults.baseURL,o=!!i?.keyVaults.apiKey;return(!!a||!!o)&&(!!a&&!o||void 0!==i?.fetchOnClient&&i?.fetchOnClient)},isProviderHasBuiltinSearch:e=>t=>{let i=d(e)(t);return!!i?.settings.searchMode},isProviderHasBuiltinSearchConfig:e=>t=>{let i=d(e)(t);return!!i?.settings.searchMode&&i?.settings.searchMode!=="internal"},isProviderLoading:e=>t=>t.aiProviderLoadingIds.includes(e),providerConfigById:d,providerKeyVaults:e=>t=>{if(e)return t.aiProviderRuntimeConfig?.[e]?.keyVaults}}},50558:(e,t,i)=>{i.d(t,{A:()=>r});let r=function(e,t,i){for(var r=-1,a=null==e?0:e.length;++r<a;)if(i(t,e[r]))return!0;return!1}},50949:(e,t,i)=>{i.d(t,{J3:()=>d,a9:()=>l,oT:()=>s,u4:()=>c,w9:()=>u});var r=i(80286),a=i(94147),o=i(81196),n=i(47260);let s=(e,t)=>o.g.isModelSupportVision(e,t)((0,a.l)()),d=(e,t)=>o.g.isModelSupportVideo(e,t)((0,a.l)())||!1,l=(e,t)=>{let i=e,r=(0,a.l)().enabledAiModels?.find(i=>i.id===e&&i.providerId===t);return r&&r.config?.deploymentName&&(i=r.config?.deploymentName),i},u=e=>n.w.isProviderFetchOnClient(e)((0,a.l)()),c=e=>{if(Object.values(r.ModelProvider).includes(e))return e;let t=n.w.providerConfigById(e)((0,a.l)());return t?.settings.sdkType||"openai"}},55582:(e,t,i)=>{i.d(t,{W:()=>o});var r=i(77605);class a{constructor(){this.getUserRegistrationDuration=async()=>r.du.user.getUserRegistrationDuration.query(),this.getUserState=async()=>r.du.user.getUserState.query(),this.getUserSSOProviders=async()=>r.du.user.getUserSSOProviders.query(),this.unlinkSSOProvider=async(e,t)=>r.du.user.unlinkSSOProvider.mutate({provider:e,providerAccountId:t}),this.makeUserOnboarded=async()=>r.du.user.makeUserOnboarded.mutate(),this.updateAvatar=async e=>r.du.user.updateAvatar.mutate(e),this.updatePreference=async e=>r.du.user.updatePreference.mutate(e),this.updateGuide=async e=>r.du.user.updateGuide.mutate(e),this.updateUserSettings=async(e,t)=>r.du.user.updateSettings.mutate(e,{signal:t}),this.resetUserSettings=async()=>r.du.user.resetSettings.mutate()}}let o=new a},60506:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(65204);let a=function(e){return e!=e},o=function(e,t,i){for(var r=i-1,a=e.length;++r<a;)if(e[r]===t)return r;return -1},n=function(e,t,i){return t==t?o(e,t,i):(0,r.A)(e,a,i)}},61505:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(44459),a=i(24225);let o=function(e,t){return e&&e.length?(0,a.A)(e,(0,r.A)(t,2)):[]}},61520:(e,t,i)=>{i.d(t,{P:()=>l,f:()=>d});var r=i(74551),a=i(96987),o=i(96773);let n=r.Se,s=e=>o.S4?e.isSignedIn?e.user?.username:"anonymous":r.xl?e.user?.username:n,d={displayUserName:e=>s(e)||e.user?.email||"",email:e=>e.user?.email||"",fullName:e=>e.user?.fullName||"",nickName:e=>{let t=e.user?.fullName||e.user?.username;return o.S4?e.isSignedIn?t:(0,a.t)("userPanel.anonymousNickName",{ns:"common"}):r.xl?t:(0,a.t)("userPanel.defaultNickname",{ns:"common"})},userAvatar:e=>e.user?.avatar||"",userId:e=>e.user?.id,userProfile:e=>e.user,username:s},l={isLoaded:e=>e.isLoaded,isLogin:e=>!o.S4||e.isSignedIn,isLoginWithAuth:e=>e.isSignedIn,isLoginWithClerk:e=>e.isSignedIn&&o.Nd||!1,isLoginWithNextAuth:e=>e.isSignedIn&&!!o.J_||!1}},64752:(e,t,i)=>{i.d(t,{createHeaderWithAuth:()=>f,ZE:()=>p,q9:()=>A});var r=i(74551),a=i(32901),o=i(80286),n=i(47260),s=i(94147),d=i(38759),l=i(45282),u=i(61520),c=i(96773);let g=e=>new TextEncoder().encode(e),v=e=>btoa(String.fromCharCode(...((e,t)=>{let i=new Uint8Array(e.length);for(let[r,a]of e.entries())i[r]=a^t[r%t.length];return i})(g(JSON.stringify(e)),g(c.RX))));var m=i(50949);let p=e=>{let t=n.w.providerKeyVaults(e)(s.d.getState())||{},i=(0,m.u4)(e);return{...((e,t)=>{switch(e){case o.ModelProvider.Bedrock:{let{accessKeyId:e,region:i,secretAccessKey:r,sessionToken:a}=t;return{accessKeyId:e,accessKeySecret:r,apiKey:(r||"")+(e||""),awsAccessKeyId:e,awsRegion:i,awsSecretAccessKey:r,awsSessionToken:a,region:i,sessionToken:a}}case o.ModelProvider.Azure:return{apiKey:a.SU.pick(t.apiKey),apiVersion:t.apiVersion,azureApiVersion:t.apiVersion,baseURL:t.baseURL||t.endpoint};case o.ModelProvider.Ollama:return{baseURL:t?.baseURL};case o.ModelProvider.Cloudflare:return{apiKey:a.SU.pick(t?.apiKey),baseURLOrAccountID:t?.baseURLOrAccountID,cloudflareBaseURLOrAccountID:t?.baseURLOrAccountID};case o.ModelProvider.ComfyUI:return{apiKey:t?.apiKey,authType:t?.authType,baseURL:t?.baseURL,customHeaders:t?.customHeaders,password:t?.password,username:t?.username};case o.ModelProvider.VertexAI:return{apiKey:t?.apiKey,baseURL:t?.baseURL,vertexAIRegion:t?.region};default:return{apiKey:a.SU.pick(t?.apiKey),baseURL:t?.baseURL}}})(i,t),runtimeProvider:i}},A=e=>v(p(e)),f=async e=>{let t=e?.payload||{};e?.provider&&(t={...t,...p(e?.provider)});let i=((e={})=>v({accessCode:l.t.password(d.k.getState()),userId:u.f.userId(d.k.getState()),...e}))(t);return{...e?.headers,[r.Zk]:i}}},65204:(e,t,i)=>{i.d(t,{A:()=>r});let r=function(e,t,i,r){for(var a=e.length,o=i+(r?1:-1);r?o--:++o<a;)if(t(e[o],o,e))return o;return -1}},71457:(e,t,i)=>{i.d(t,{U:()=>a});var r=i(74551);let a={hideSettingsMoveGuide:e=>e.preference.guide?.moveSettingsToAvatar,hideSyncAlert:e=>e.preference.hideSyncAlert,isPreferenceInit:e=>e.isUserStateInit,shouldTriggerFileInKnowledgeBaseTip:e=>"boolean"!=typeof e.preference.guide?.moveSettingsToAvatar,showUploadFileInKnowledgeBaseTip:e=>e.preference.guide?.uploadFileInKnowledgeBase,topicDisplayMode:e=>e.preference.topicDisplayMode||r.I4.topicDisplayMode,useCmdEnterToSend:e=>e.preference.useCmdEnterToSend||!1,userAllowTrace:e=>e.preference.telemetry}},81196:(e,t,i)=>{i.d(t,{g:()=>u});var r=i(80286),a=i(88573);let o=e=>e.aiProviderModelList.filter(e=>e.enabled),n=e=>e.aiProviderModelList.length,s=(e,t)=>i=>i.enabledAiModels?.find(i=>i.id===e&&(!t||t===i.providerId)),d=(e,t)=>i=>{let r=s(e,t)(i);return r?.settings?.extendParams},l=(e,t)=>i=>{let r=s(e,t)(i);return r?.settings?.searchImpl},u={aiProviderChatModelListIds:e=>e.aiProviderModelList.filter(e=>"chat"===e.type).map(e=>e.id),disabledAiProviderModelList:e=>e.aiProviderModelList.filter(e=>!e.enabled),enabledAiProviderModelList:o,filteredAiProviderModelList:e=>{let t=e.modelSearchKeyword.toLowerCase().trim();return e.aiProviderModelList.filter(e=>e.id.toLowerCase().includes(t)||e.displayName?.toLowerCase().includes(t))},getAiModelById:e=>t=>t.aiProviderModelList.find(t=>t.id===e),getEnabledModelById:s,getModelCard:(e,t)=>i=>i.builtinAiModelList.find(i=>i.id===e&&i.providerId===t),hasRemoteModels:e=>e.aiProviderModelList.some(e=>e.source===r.AiModelSourceEnum.Remote),isEmptyAiProviderModelList:e=>0===n(e),isModelBuiltinSearchInternal:(e,t)=>i=>l(e,t)(i)===a.P.Internal,isModelEnabled:e=>t=>o(t).some(t=>t.id===e),isModelHasBuiltinSearch:(e,t)=>i=>!!l(e,t)(i),isModelHasBuiltinSearchConfig:(e,t)=>i=>{let r=l(e,t)(i);return!!r&&[a.P.Tool,a.P.Params].includes(r)},isModelHasContextWindowToken:(e,t)=>i=>{let r=s(e,t)(i);return"number"==typeof r?.contextWindowTokens},isModelHasExtendParams:(e,t)=>i=>{let r=d(e,t)(i);return!!r&&r.length>0},isModelLoading:e=>t=>t.aiModelLoadingIds.includes(e),isModelSupportFiles:(e,t)=>i=>{let r=s(e,t)(i);return r?.abilities?.files},isModelSupportReasoning:(e,t)=>i=>{let r=s(e,t)(i);return r?.abilities?.reasoning},isModelSupportToolUse:(e,t)=>i=>{let r=s(e,t)(i);return r?.abilities?.functionCall||!1},isModelSupportVideo:(e,t)=>i=>{let r=s(e,t)(i);return r?.abilities?.video},isModelSupportVision:(e,t)=>i=>{let r=s(e,t)(i);return r?.abilities?.vision||!1},modelBuiltinSearchImpl:l,modelContextWindowTokens:(e,t)=>i=>{let r=s(e,t)(i);return r?.contextWindowTokens},modelExtendParams:d,totalAiProviderModelList:n}},94147:(e,t,i)=>{i.d(t,{l:()=>k,d:()=>_});var r,a=i(50786),o=i(23993),n=i(41734);let s={activeProviderModelList:[],aiProviderConfigUpdatingIds:[],aiProviderList:[],aiProviderLoadingIds:[],aiProviderRuntimeConfig:{},initAiProviderList:!1,isInitAiProviderRuntimeState:!1,providerSearchKeyword:"",aiModelLoadingIds:[],aiProviderModelList:[],builtinAiModelList:[],modelSearchKeyword:""};var d=i(31021),l=i.n(d),u=i(64911),c=i(46265),g=i(77605);class v{constructor(){this.createAiModel=async e=>g.du.aiModel.createAiModel.mutate(e),this.getAiProviderModelList=async e=>g.du.aiModel.getAiProviderModelList.query({id:e}),this.getAiModelById=async e=>g.du.aiModel.getAiModelById.query({id:e}),this.toggleModelEnabled=async e=>g.du.aiModel.toggleModelEnabled.mutate(e),this.updateAiModel=async(e,t,i)=>g.du.aiModel.updateAiModel.mutate({id:e,providerId:t,value:i}),this.batchUpdateAiModels=async(e,t)=>g.du.aiModel.batchUpdateAiModels.mutate({id:e,models:t}),this.batchToggleAiModels=async(e,t,i)=>g.du.aiModel.batchToggleAiModels.mutate({enabled:i,id:e,models:t}),this.clearModelsByProvider=async e=>g.du.aiModel.clearModelsByProvider.mutate({providerId:e}),this.clearRemoteModels=async e=>g.du.aiModel.clearRemoteModels.mutate({providerId:e}),this.updateAiModelOrder=async(e,t)=>g.du.aiModel.updateAiModelOrder.mutate({providerId:e,sortMap:t}),this.deleteAiModel=async e=>g.du.aiModel.removeAiModel.mutate(e)}}let m=new v,p="FETCH_AI_PROVIDER_MODELS";var A=i(74551),f=i(16748),h=i(61505),P=i(5750),y=i(38759),S=i(61520),w=i(77186);let M=(e,t)=>async(i,r)=>{let a,o=i.filter(t=>t.providerId===r&&t.type===e);return o.length?(a=await Promise.all(o.map(e=>t(e))),(0,h.A)(a,"id")):[]},L=async e=>{let t=e.parameters?Promise.resolve(e.parameters):(0,f.TS)(e.id,"parameters",e.providerId),i=e.pricing?Promise.resolve(e.pricing):(0,f.TS)(e.id,"pricing",e.providerId),r=(0,f.TS)(e.id,"description",e.providerId),[a,o,n]=await Promise.all([t,i,r]),s=e.parameters??a,{price:d,approximatePrice:l}=(0,f.r7)(o);return{abilities:e.abilities||{},contextWindowTokens:e.contextWindowTokens,displayName:e.displayName??"",id:e.id,...s&&{parameters:s},...n&&{description:n},...o&&{pricing:o},..."number"==typeof l&&{approximatePricePerImage:l},..."number"==typeof d&&{pricePerImage:d}}},b=M("chat",async e=>({abilities:e.abilities||{},contextWindowTokens:e.contextWindowTokens,displayName:e.displayName??"",id:e.id})),I=M("image",L),U=async(e,t,i)=>Promise.all(e.map(async e=>({...e,children:await i(t,e.id),name:e.name||e.id}))),R=async(e,t)=>U(e,t,I),C=async(e,t)=>U(e,t,b);var E=((r=E||{}).fetchAiProviderItem="FETCH_AI_PROVIDER_ITEM",r.fetchAiProviderList="FETCH_AI_PROVIDER",r.fetchAiProviderRuntimeState="FETCH_AI_PROVIDER_RUNTIME_STATE",r);let T=(0,n.t)("aiInfra"),_=(0,o.h)()(T((...e)=>({...s,...((e,t)=>({batchToggleAiModels:async(e,i)=>{let{activeAiProvider:r}=t();r&&(await m.batchToggleAiModels(r,e,i),await t().refreshAiModelList())},batchUpdateAiModels:async e=>{let{activeAiProvider:i}=t();i&&(await m.batchUpdateAiModels(i,e),await t().refreshAiModelList())},clearModelsByProvider:async e=>{await m.clearModelsByProvider(e),await t().refreshAiModelList()},clearRemoteModels:async e=>{await m.clearRemoteModels(e),await t().refreshAiModelList()},createNewAiModel:async e=>{await m.createAiModel(e),await t().refreshAiModelList()},fetchRemoteModelList:async e=>{let{modelsService:r}=await Promise.all([i.e(83663),i.e(85614),i.e(91416)]).then(i.bind(i,91416)),a=await r.getModels(e);a&&(await t().batchUpdateAiModels(a.map(e=>({...e,abilities:{files:e.files,functionCall:e.functionCall,imageOutput:e.imageOutput,reasoning:e.reasoning,search:e.search,video:e.video,vision:e.vision},enabled:e.enabled||!1,source:"remote",type:e.type||"chat"}))),await t().refreshAiModelList())},internal_toggleAiModelLoading:(t,i)=>{e(e=>i?{aiModelLoadingIds:[...e.aiModelLoadingIds,t]}:{aiModelLoadingIds:e.aiModelLoadingIds.filter(e=>e!==t)},!1,"toggleAiModelLoading")},refreshAiModelList:async()=>{await (0,u.j)([p,t().activeAiProvider]),t().refreshAiProviderRuntimeState()},removeAiModel:async(e,i)=>{await m.deleteAiModel({id:e,providerId:i}),await t().refreshAiModelList()},toggleModelEnabled:async e=>{let{activeAiProvider:i}=t();i&&(t().internal_toggleAiModelLoading(e.id,!0),await m.toggleModelEnabled({...e,providerId:i}),await t().refreshAiModelList(),t().internal_toggleAiModelLoading(e.id,!1))},updateAiModelsConfig:async(e,i,r)=>{await m.updateAiModel(e,i,r),await t().refreshAiModelList()},updateAiModelsSort:async(e,i)=>{await m.updateAiModelOrder(e,i),await t().refreshAiModelList()},useFetchAiProviderModels:i=>(0,c.lA)([p,i],([,e])=>m.getAiProviderModelList(e),{onSuccess:r=>{t().isAiModelListInit&&l()(r,t().aiProviderModelList)||e({aiProviderModelList:r,isAiModelListInit:!0},!1,`useFetchAiProviderModels/${i}`)}})}))(...e),...((e,t)=>({createNewAiProvider:async e=>{await P.F.createAiProvider({...e,source:w.Ag.Custom}),await t().refreshAiProviderList()},deleteAiProvider:async e=>{await P.F.deleteAiProvider(e),await t().refreshAiProviderList()},internal_toggleAiProviderConfigUpdating:(t,i)=>{e(e=>i?{aiProviderConfigUpdatingIds:[...e.aiProviderConfigUpdatingIds,t]}:{aiProviderConfigUpdatingIds:e.aiProviderConfigUpdatingIds.filter(e=>e!==t)},!1,"toggleAiProviderLoading")},internal_toggleAiProviderLoading:(t,i)=>{e(e=>i?{aiProviderLoadingIds:[...e.aiProviderLoadingIds,t]}:{aiProviderLoadingIds:e.aiProviderLoadingIds.filter(e=>e!==t)},!1,"toggleAiProviderLoading")},refreshAiProviderDetail:async()=>{await (0,u.j)(["FETCH_AI_PROVIDER_ITEM",t().activeAiProvider]),await t().refreshAiProviderRuntimeState()},refreshAiProviderList:async()=>{await (0,u.j)("FETCH_AI_PROVIDER"),await t().refreshAiProviderRuntimeState()},refreshAiProviderRuntimeState:async()=>{await Promise.all([(0,u.j)(["FETCH_AI_PROVIDER_RUNTIME_STATE",!0]),(0,u.j)(["FETCH_AI_PROVIDER_RUNTIME_STATE",!1])])},removeAiProvider:async e=>{await P.F.deleteAiProvider(e),await t().refreshAiProviderList()},toggleProviderEnabled:async(e,i)=>{t().internal_toggleAiProviderLoading(e,!0),await P.F.toggleProviderEnabled(e,i),await t().refreshAiProviderList(),t().internal_toggleAiProviderLoading(e,!1)},updateAiProvider:async(e,i)=>{t().internal_toggleAiProviderLoading(e,!0),await P.F.updateAiProvider(e,i),await t().refreshAiProviderList(),await t().refreshAiProviderDetail(),t().internal_toggleAiProviderLoading(e,!1)},updateAiProviderConfig:async(e,i)=>{t().internal_toggleAiProviderConfigUpdating(e,!0),await P.F.updateAiProviderConfig(e,i),await t().refreshAiProviderDetail(),t().internal_toggleAiProviderConfigUpdating(e,!1)},updateAiProviderSort:async e=>{await P.F.updateAiProviderOrder(e),await t().refreshAiProviderList()},useFetchAiProviderItem:t=>(0,c.lA)(["FETCH_AI_PROVIDER_ITEM",t],()=>P.F.getAiProviderById(t),{onSuccess:i=>{i&&e({activeAiProvider:t,aiProviderDetail:i},!1,"useFetchAiProviderItem")}}),useFetchAiProviderList:i=>(0,c.lA)(i?.enabled===!1?null:"FETCH_AI_PROVIDER",()=>P.F.getAiProviderList(),{fallbackData:[],onSuccess:i=>{t().initAiProviderList?e({aiProviderList:i},!1,"useFetchAiProviderList/refresh"):e({aiProviderList:i,initAiProviderList:!0},!1,"useFetchAiProviderList/init")}}),useFetchAiProviderRuntimeState:t=>{let r=S.P.isLoaded(y.k.getState())&&null!=t;return(0,c.lA)(r?["FETCH_AI_PROVIDER_RUNTIME_STATE",t]:null,async([,e])=>{let[{LOBE_DEFAULT_MODEL_LIST:t},{DEFAULT_MODEL_PROVIDER_LIST:r}]=await Promise.all([Promise.resolve().then(i.bind(i,80286)),Promise.resolve().then(i.bind(i,67400))]);if(e){let e=await P.F.getAiProviderRuntimeState(),[i,r]=await Promise.all([C(e.enabledChatAiProviders,e.enabledAiModels),R(e.enabledImageAiProviders,e.enabledAiModels)]);return{...e,builtinAiModelList:t,enabledChatModelList:i,enabledImageModelList:r}}let a=r.filter(e=>e.enabled).map(e=>({id:e.id,name:e.name,source:w.Ag.Builtin})),o=a.filter(e=>t.some(t=>t.providerId===e.id&&"chat"===t.type)),n=a.filter(e=>t.some(t=>t.providerId===e.id&&"image"===t.type)).map(e=>({id:e.id,name:e.name,source:w.Ag.Builtin})),s=t.filter(e=>e.enabled),[d,l]=await Promise.all([C(o,s),R(n,s)]);return{builtinAiModelList:t,enabledAiModels:s,enabledAiProviders:a,enabledChatAiProviders:o,enabledChatModelList:d,enabledImageAiProviders:n,enabledImageModelList:l,runtimeConfig:{}}},{focusThrottleInterval:A.xl?100:void 0,onSuccess:t=>{t&&e({aiProviderRuntimeConfig:t.runtimeConfig,builtinAiModelList:t.builtinAiModelList,enabledAiModels:t.enabledAiModels,enabledAiProviders:t.enabledAiProviders,enabledChatModelList:t.enabledChatModelList||[],enabledImageModelList:t.enabledImageModelList||[],isInitAiProviderRuntimeState:!0},!1,"useFetchAiProviderRuntimeState")}})}}))(...e)})),a.x),k=()=>_.getState()}}]);