"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65819],{1824:(e,t,n)=>{n.d(t,{e:()=>A});var a=n(28802),i=n(12389),l=n(97299),o=n(35426),r=n(25622),s=n(599),d=n(92317),c=n(49008),g=n(83179),u=n(83034),p=n(59121),m=n(35245),h=n(78397),b=n(62326),y=n(12467),v=n(64811);let A=({mobile:e}={})=>{let{t}=(0,p.Bd)("setting"),n=e?20:void 0,A=(0,v.B)(e=>e.activeId)===m.Ed,{enablePlugins:f}=(0,b.wo)(y.E);return(0,u.useMemo)(()=>[!A&&{icon:(0,a.Y)(i.default,{icon:l.A,size:n}),key:h.iL.Meta,label:t("agentTab.meta")},{icon:(0,a.Y)(i.default,{icon:o.A,size:n}),key:h.iL.Prompt,label:t("agentTab.prompt")},!A&&{icon:(0,a.Y)(i.default,{icon:r.A,size:n}),key:h.iL.Opening,label:t("agentTab.opening")},{icon:(0,a.Y)(i.default,{icon:s.A,size:n}),key:h.iL.Chat,label:t("agentTab.chat")},{icon:(0,a.Y)(i.default,{icon:d.A,size:n}),key:h.iL.Modal,label:t("agentTab.modal")},{icon:(0,a.Y)(i.default,{icon:c.A,size:n}),key:h.iL.TTS,label:t("agentTab.tts")},f&&{icon:(0,a.Y)(i.default,{icon:g.A,size:n}),key:h.iL.Plugin,label:t("agentTab.plugin")}].filter(Boolean),[t,A,f])}},26683:(e,t,n)=>{n.d(t,{M:()=>o});var a=n(47878),i=n(83034),l=n(29261);let o=(e="")=>{let[t,n]=(0,i.useState)(0),o=(0,i.useCallback)((0,a.A)(e=>{(0,l.X)(e).then(n).catch(()=>{n(e.length)})},300),[]);return(0,i.useEffect)(()=>((0,i.startTransition)(()=>{o(e||"")}),()=>{o.cancel()}),[e,o]),t}},43777:(e,t,n)=>{n.d(t,{e:()=>s});var a=n(28802),i=n(83034),l=n(81088),o=n(98602);let r=(0,i.memo)(({onConfigChange:e,instanceRef:t,id:n,onMetaChange:a,meta:r,config:s,loading:d})=>{let c=(0,o.PI)(),g=(0,l.H)(c);g("meta",r),g("config",s),g("onConfigChange",e),g("onMetaChange",a),g("loading",d),g("id",n);let u=(()=>{let{autocompleteMeta:e,autocompleteAllMeta:t,autocompleteAgentTitle:n,autocompleteAgentDescription:a,autocompleteAgentTags:l,autoPickEmoji:r}=(0,o.PI)().getState();return(0,i.useMemo)(()=>({autoPickEmoji:r,autocompleteAgentDescription:a,autocompleteAgentTags:l,autocompleteAgentTitle:n,autocompleteAllMeta:t,autocompleteMeta:e}),[])})();return(0,i.useImperativeHandle)(t,()=>u),null}),s=(0,i.memo)(({children:e,...t})=>(0,a.FD)(o.Kq,{createStore:o.y$,children:[(0,a.Y)(r,{...t}),e]}))},74732:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(28802),i=n(3136),l=n(83034),o=n(26683);let r=(0,l.memo)(({value:e,style:t})=>{let n=(0,o.M)(e);if(e&&n)return(0,a.FD)(i.A,{style:{marginTop:24,width:"fit-content",...t},children:["Token: ",n]})})},91346:(e,t,n)=>{n.d(t,{A:()=>e6});var a=n(28802),i=n(59202),l=n(83034),o=n(78397),r=n(62326),s=n(98602),d=n(12467),c=n(43588),g=n(92085),u=n(40681),p=n(96337),m=n(42507),h=n(42213),b=n(31021),y=n.n(b),v=n(599),A=n(31334),f=n(59121),C=n(49935),Y=n(45628),k=n(60051);let T=(0,l.memo)(()=>{let{t:e}=(0,f.Bd)("setting"),[t]=c.Ay.useForm(),{isDarkMode:n}=(0,h.e)(),i=(0,s.Pj)(e=>e.setChatConfig),l=(0,s.Pj)(k.T.currentChatConfig,y()),o={children:[{children:(0,a.Y)(g.A,{height:86,options:[{icon:v.A,img:(0,Y.b8)(`chatmode_chat_${n?"dark":"light"}.webp`),label:e("settingChat.chatStyleType.type.chat"),value:"chat"},{icon:A.A,img:(0,Y.b8)(`chatmode_docs_${n?"dark":"light"}.webp`),label:e("settingChat.chatStyleType.type.docs"),value:"docs"}],style:{marginRight:2},unoptimized:!1,width:144}),label:e("settingChat.chatStyleType.title"),minWidth:void 0,name:"displayMode"},{children:(0,a.Y)(u.A,{placeholder:e("settingChat.inputTemplate.placeholder")}),desc:e("settingChat.inputTemplate.desc"),label:e("settingChat.inputTemplate.title"),name:"inputTemplate"},{children:(0,a.Y)(m.A,{}),desc:e("settingChat.enableAutoCreateTopic.desc"),label:e("settingChat.enableAutoCreateTopic.title"),layout:"horizontal",minWidth:void 0,name:"enableAutoCreateTopic",valuePropName:"checked"},{children:(0,a.Y)(p.A,{max:8,min:0,unlimitedInput:!0}),desc:e("settingChat.autoCreateTopicThreshold.desc"),divider:!1,hidden:!l.enableAutoCreateTopic,label:e("settingChat.autoCreateTopicThreshold.title"),name:"autoCreateTopicThreshold"},{children:(0,a.Y)(m.A,{}),label:e("settingChat.enableHistoryCount.title"),layout:"horizontal",minWidth:void 0,name:"enableHistoryCount",valuePropName:"checked"},{children:(0,a.Y)(p.A,{max:20,min:0,unlimitedInput:!0}),desc:e("settingChat.historyCount.desc"),divider:!1,hidden:!l.enableHistoryCount,label:e("settingChat.historyCount.title"),name:"historyCount"},{children:(0,a.Y)(m.A,{}),hidden:!l.enableHistoryCount,label:e("settingChat.enableCompressHistory.title"),layout:"horizontal",minWidth:void 0,name:"enableCompressHistory",valuePropName:"checked"}],title:e("settingChat.title")};return(0,a.Y)(c.Ay,{footer:(0,a.Y)(c.Ay.SubmitFooter,{texts:{reset:e("submitFooter.reset"),submit:e("settingChat.submit"),unSaved:e("submitFooter.unSaved"),unSavedWarning:e("submitFooter.unSavedWarning")}}),form:t,initialValues:l,items:[o],itemsType:"group",onFinish:i,variant:"borderless",...C.pC})});var S=n(37412),P=n(15447),x=n(79778),F=n(3629),M=n(35245),_=n(9274),w=n(11577),E=n(33375),z=n(80457),L=n(5930),j=n(76694);let D=(0,E.default)(()=>Promise.all([n.e(18733),n.e(37326),n.e(49615),n.e(65277),n.e(6429)]).then(n.bind(n,65277)),{loadableGenerated:{webpack:()=>[65277]},ssr:!1}),I=(0,l.memo)(({loading:e,background:t,value:n,onChange:i,onGenerate:l,canAutoGenerate:o})=>{let{t:r}=(0,f.Bd)("common"),s=(0,w.DP)(),d=(0,L.o)(j.c.currentLanguage);return(0,a.FD)(z.Flexbox,{align:"center",flex:"none",gap:2,horizontal:!0,padding:2,style:{background:s.colorBgContainer,border:`1px solid ${s.colorBorderSecondary}`,borderRadius:32,paddingRight:8,width:"fit-content"},children:[(0,a.Y)(D,{background:t||s.colorFillTertiary,loading:e,locale:d,onChange:i,size:48,style:{background:s.colorFillTertiary},value:n}),(0,a.Y)(_.A,{disabled:!o,icon:F.A,loading:e,onClick:l,size:"small",title:r(o?"autoGenerate":"autoGenerateTooltipDisabled")})]})});var W=n(69033);let B=(0,l.memo)(({loading:e,value:t,onChange:n,onGenerate:i,canAutoGenerate:o,...r})=>{let{t:s}=(0,f.Bd)("common"),[d,c]=(0,l.useState)(t||""),g=(0,l.useRef)(!1),u=(0,l.useRef)(!1),p=(0,l.useCallback)(()=>{n?.(d)},[d]);return(0,l.useEffect)(()=>{void 0!==t&&c(t)},[t]),(0,a.Y)(W.A,{suffix:i&&(0,a.Y)(_.A,{disabled:!o,icon:F.A,loading:e,onClick:i,size:"small",style:{marginRight:-4},title:s(o?"autoGenerate":"autoGenerateTooltipDisabled")}),...r,onBlur:()=>{p(),u.current=!1},onChange:e=>{c(e.target.value)},onCompositionEnd:()=>{g.current=!1},onCompositionStart:()=>{g.current=!0},onFocus:()=>{u.current=!0},onPressEnter:e=>{e.shiftKey||g.current||(e.preventDefault(),p(),u.current=!1)},value:d})});var R=n(47762),N=n(13380);let O=(0,l.memo)(({loading:e,onGenerate:t,value:n,canAutoGenerate:i,onChange:l,...o})=>{let{t:r}=(0,f.Bd)("common");return(0,a.Y)(R.A,{mode:"tags",onChange:e=>{l?.((0,N.A)(e)?e.split(","):e)},open:!1,style:{width:"100%"},suffixIcon:t&&(0,a.Y)(_.A,{disabled:!i,icon:F.A,loading:e,onClick:t,size:"small",style:{marginRight:-4},title:r(i?"autoGenerate":"autoGenerateTooltipDisabled")}),tokenSeparators:[",","，"," "],value:(0,N.A)(n)?n.split(","):n,...o})});var $=n(32565),V=n(50159),q=n(99278);let K=(0,l.memo)(({defaultValue:e=q.z6,value:t,onChange:n,onValuesChange:i})=>{let{t:l}=(0,f.Bd)("color");return(0,a.Y)($.A,{colors:[{color:"rgba(0, 0, 0, 0)",title:l("default")},{color:V.d_.red,title:l("red")},{color:V.d_.orange,title:l("orange")},{color:V.d_.gold,title:l("gold")},{color:V.d_.yellow,title:l("yellow")},{color:V.d_.lime,title:l("lime")},{color:V.d_.green,title:l("green")},{color:V.d_.cyan,title:l("cyan")},{color:V.d_.blue,title:l("blue")},{color:V.d_.geekblue,title:l("geekblue")},{color:V.d_.purple,title:l("purple")},{color:V.d_.magenta,title:l("magenta")},{color:V.d_.volcano,title:l("volcano")}],defaultValue:e,enableColorPicker:!0,onChange:e=>{n?.(e),i?.(e)},texts:{custom:l("custom"),presets:l("presets")},value:t})}),G=(0,l.memo)(()=>{let{t:e}=(0,f.Bd)("setting"),[t]=c.Ay.useForm(),{isAgentEditable:n}=(0,r.wo)(d.E),[i,o,g,u]=(0,s.Pj)(e=>[!!e.config.systemRole,e.setAgentMeta,e.autocompleteMeta,e.autocompleteAllMeta]),[p,m]=(0,s.Pj)(e=>[e.id===M.Ed,e.loadingState]),h=(0,s.Pj)(k.T.currentMetaConfig,y()),[b,v]=(0,l.useState)(h.backgroundColor);if((0,x.A)(()=>{t.setFieldsValue(h)},[h]),p)return;let A=[{Render:B,key:"title",label:e("settingAgent.name.title"),placeholder:e("settingAgent.name.placeholder")},{Render:B,desc:e("settingAgent.description.desc"),key:"description",label:e("settingAgent.description.title"),placeholder:e("settingAgent.description.placeholder")},{Render:O,desc:e("settingAgent.tag.desc"),key:"tags",label:e("settingAgent.tag.title"),placeholder:e("settingAgent.tag.placeholder")}].map(e=>{let t=e.Render;return{children:(0,a.Y)(t,{canAutoGenerate:i,loading:m?.[e.key],onGenerate:()=>{g(e.key)},placeholder:e.placeholder}),label:e.label,name:e.key}}),Y={children:[{children:(0,a.Y)(I,{background:b,canAutoGenerate:i,loading:m?.avatar,onGenerate:()=>g("avatar")}),label:e("settingAgent.avatar.title"),layout:"horizontal",minWidth:void 0,name:"avatar"},{children:(0,a.Y)(K,{onValuesChange:e=>v(e)}),label:e("settingAgent.backgroundColor.title"),minWidth:void 0,name:"backgroundColor"},...A],extra:(0,a.Y)(S.A,{title:e(i?"autoGenerateTooltip":"autoGenerateTooltipDisabled",{ns:"common"}),children:(0,a.Y)(P.A,{disabled:!i,icon:F.A,iconPosition:"end",iconProps:{size:12},loading:Object.values(m).some(e=>!!e),onClick:e=>{e.stopPropagation(),u(!0)},size:"small",children:e("autoGenerate",{ns:"common"})})}),title:e("settingAgent.title")};return(0,a.Y)(c.Ay,{disabled:!n,footer:(0,a.Y)(c.Ay.SubmitFooter,{texts:{reset:e("submitFooter.reset"),submit:e("settingAgent.submit"),unSaved:e("submitFooter.unSaved"),unSavedWarning:e("submitFooter.unSavedWarning")}}),form:t,initialValues:h,items:[Y],itemsType:"group",onFinish:o,variant:"borderless",...C.pC})});var H=n(87508),Q=n(80176),U=n(88980),J=n(99859),X=n(87381);let Z=(0,w.rU)(({css:e,token:t})=>({checkbox:e`
    .ant-checkbox-inner {
      border-radius: 4px;
    }

    &:hover .ant-checkbox-inner {
      border-color: ${t.colorPrimary};
    }
  `,label:e`
    user-select: none;
  `,sliderWrapper:e`
    display: flex;
    gap: 16px;
    align-items: center;
    width: 100%;
  `})),ee=(0,l.memo)(({value:e,onChange:t,disabled:n,checked:i,onToggle:l,styles:o,min:r,max:s,step:d})=>(0,a.FD)("div",{className:o.sliderWrapper,children:[(0,a.Y)(H.A,{checked:i,className:o.checkbox,onChange:e=>{e.stopPropagation(),l(e.target.checked)}}),(0,a.Y)("div",{style:{flex:1},children:(0,a.Y)(p.A,{disabled:n,max:s,min:r,onChange:t,step:d,value:e})})]})),et={frequency_penalty:["params","frequency_penalty"],presence_penalty:["params","presence_penalty"],temperature:["params","temperature"],top_p:["params","top_p"]},en={frequency_penalty:0,presence_penalty:0,temperature:.7,top_p:1},ea={frequency_penalty:{descKey:"settingModel.frequencyPenalty.desc",labelKey:"settingModel.frequencyPenalty.title",slider:{max:2,min:-2,step:.1},tag:"frequency_penalty"},presence_penalty:{descKey:"settingModel.presencePenalty.desc",labelKey:"settingModel.presencePenalty.title",slider:{max:2,min:-2,step:.1},tag:"presence_penalty"},temperature:{descKey:"settingModel.temperature.desc",labelKey:"settingModel.temperature.title",slider:{max:2,min:0,step:.1},tag:"temperature"},top_p:{descKey:"settingModel.topP.desc",labelKey:"settingModel.topP.title",slider:{max:1,min:0,step:.1},tag:"top_p"}},ei=(0,l.memo)(()=>{let{t:e}=(0,f.Bd)("setting"),[t]=c.Ay.useForm(),n=(0,s.Pj)(k.T.currentAgentConfig,y()),{styles:i}=Z(),o=Q.A.useWatch(["chatConfig","enableMaxTokens"],t),r=Q.A.useWatch(["chatConfig","enableReasoningEffort"],t),d=(0,s.Pj)(e=>e.setAgentConfig),g=(0,s.Pj)(e=>e.config.provider),u=(0,X.u)(g),{temperature:h,top_p:b,presence_penalty:v,frequency_penalty:A}=n.params??{},Y=(0,l.useRef)({frequency_penalty:A,presence_penalty:v,temperature:h,top_p:b});(0,l.useEffect)(()=>{t.setFieldsValue({...n,_modalConfig:{model:n.model,provider:n.provider}}),"number"==typeof h&&(Y.current.temperature=h),"number"==typeof b&&(Y.current.top_p=b),"number"==typeof v&&(Y.current.presence_penalty=v),"number"==typeof A&&(Y.current.frequency_penalty=A)},[n,t,h,b,v,A]);let T=Q.A.useWatch(et.temperature,t),S=Q.A.useWatch(et.top_p,t),P=Q.A.useWatch(et.presence_penalty,t),x=Q.A.useWatch(et.frequency_penalty,t);(0,l.useEffect)(()=>{"number"==typeof T&&(Y.current.temperature=T)},[T]),(0,l.useEffect)(()=>{"number"==typeof S&&(Y.current.top_p=S)},[S]),(0,l.useEffect)(()=>{"number"==typeof P&&(Y.current.presence_penalty=P)},[P]),(0,l.useEffect)(()=>{"number"==typeof x&&(Y.current.frequency_penalty=x)},[x]);let F={frequency_penalty:"number"==typeof x,presence_penalty:"number"==typeof P,temperature:"number"==typeof T,top_p:"number"==typeof S},M=(0,l.useCallback)((e,n)=>{let a=et[e];if(!n){let n=t.getFieldValue(a);"number"==typeof n&&(Y.current[e]=n),t.setFieldValue(a,void 0);return}let i=Y.current[e],l="number"==typeof i?i:en[e];Y.current[e]=l,t.setFieldValue(a,l)},[t]),_=Object.keys(ea).map(t=>{let n=ea[t],l=F[t];return{children:(0,a.Y)(ee,{checked:l,disabled:!l,max:n.slider.max,min:n.slider.min,onToggle:e=>M(t,e),step:n.slider.step,styles:i}),desc:e(n.descKey),label:(0,a.FD)(z.Flexbox,{align:"center",className:i.label,gap:8,horizontal:!0,children:[e(n.labelKey),(0,a.Y)(U.A,{title:e(n.descKey)})]}),name:et[t],tag:n.tag}}),w={children:[{children:(0,a.Y)(J.A,{}),desc:e("settingModel.model.desc",{provider:u}),label:e("settingModel.model.title"),name:"_modalConfig",tag:"model"},{children:(0,a.Y)(m.A,{}),desc:e("settingChat.enableStreaming.desc"),label:e("settingChat.enableStreaming.title"),layout:"horizontal",minWidth:void 0,name:["chatConfig","enableStreaming"],valuePropName:"checked"},..._,{children:(0,a.Y)(m.A,{}),label:e("settingModel.enableMaxTokens.title"),layout:"horizontal",minWidth:void 0,name:["chatConfig","enableMaxTokens"],valuePropName:"checked"},{children:(0,a.Y)(p.A,{disabled:!o,max:32e3,min:0,step:100,unlimitedInput:!0}),desc:e("settingModel.maxTokens.desc"),divider:!1,hidden:!o,label:e("settingModel.maxTokens.title"),name:["params","max_tokens"],tag:"max_tokens"},{children:(0,a.Y)(m.A,{}),label:e("settingModel.enableReasoningEffort.title"),layout:"horizontal",minWidth:void 0,name:["chatConfig","enableReasoningEffort"],valuePropName:"checked"},{children:(0,a.Y)(R.A,{defaultValue:"medium",options:[{label:e("settingModel.reasoningEffort.options.low"),value:"low"},{label:e("settingModel.reasoningEffort.options.medium"),value:"medium"},{label:e("settingModel.reasoningEffort.options.high"),value:"high"}]}),desc:e("settingModel.reasoningEffort.desc"),hidden:!r,label:e("settingModel.reasoningEffort.title"),name:["params","reasoning_effort"],tag:"reasoning_effort"}],title:e("settingModel.title")};return(0,a.Y)(c.Ay,{footer:(0,a.Y)(c.Ay.SubmitFooter,{texts:{reset:e("submitFooter.reset"),submit:e("settingModel.submit"),unSaved:e("submitFooter.unSaved"),unSavedWarning:e("submitFooter.unSavedWarning")}}),form:t,initialValues:{...n,_modalConfig:{model:n.model,provider:n.provider}},items:[w],itemsType:"group",onFinish:({_modalConfig:e,...t})=>{let n={...t};if(n.params){let e={...n.params};Object.keys(e).forEach(t=>{void 0===e[t]&&(e[t]=null)}),n.params=e}d({model:e?.model,provider:e?.provider,...n})},variant:"borderless",...C.pC})});var el=n(88459),eo=n(39001);let er=(0,w.rU)(({css:e,token:t})=>({markdown:e`
    border: unset;
  `,wrapper:e`
    width: 100%;
    padding: 8px;
    border: 1px solid ${t.colorBorder};
    border-radius: ${t.borderRadiusLG-1}px;

    background: ${t.colorBgContainer};
  `})),es=(0,l.memo)(()=>{let{t:e}=(0,f.Bd)("setting"),{styles:t}=er(),n=(0,s.Pj)(k.T.openingMessage),i=(0,s.Pj)(e=>e.setAgentConfig),o=(0,l.useCallback)(e=>{i({openingMessage:e})},[i]),[r,d]=(0,l.useState)(!1),c=(0,l.useCallback)(()=>{d(!0)},[]),g=!r&&n&&(0,a.Y)(P.A,{onClick:c,size:"small",children:(0,a.Y)(eo.A,{size:16})});return(0,a.Y)("div",{className:t.wrapper,children:(0,a.FD)(z.Flexbox,{direction:"horizontal",children:[(0,a.Y)(el.A,{classNames:{markdown:t.markdown},editButtonSize:"small",editing:r,height:"auto",onChange:o,onEditingChange:d,placeholder:e("settingOpening.openingMessage.placeholder"),showEditWhenEmpty:!0,text:{cancel:e("cancel",{ns:"common"}),confirm:e("ok",{ns:"common"})},value:n??"",variant:"borderless"}),g]})})});var ed=n(2460),ec=n(89098),eg=n(16602),eu=n(90897),ep=n(80201),em=n(63639);let eh=(0,w.rU)(({css:e,token:t})=>({empty:e`
    margin-block: 24px;
    margin-inline: 0;
  `,questionItemContainer:e`
    padding-block: 8px;
    padding-inline-end: 8px;
  `,questionItemContent:e`
    flex: 1;
  `,questionsList:e`
    width: 100%;
    margin-block-start: 16px;
  `,repeatError:e`
    margin: 0;
    color: ${t.colorErrorText};
  `})),eb=(0,l.memo)(()=>{let{t:e}=(0,f.Bd)("setting"),{styles:t}=eh(),[n,i]=(0,l.useState)(""),o=(0,s.Pj)(k.T.openingQuestions),r=(0,s.Pj)(e=>e.setAgentConfig),[d,c]=(0,em.A)(o,{onChange:e=>r({openingQuestions:e}),value:o}),g=(0,l.useMemo)(()=>d.map((e,t)=>({content:e,id:e||t})),[d]),u=(0,l.useCallback)(()=>{n.trim()&&(c([...o,n.trim()]),i(""))},[o,n,c]),p=(0,l.useCallback)(e=>{let t=[...o],n=t.indexOf(e);t.splice(n,1),c(t)},[o,c]),m=(0,l.useCallback)(e=>{c(e.map(e=>e.content))},[c]),h=o.includes(n.trim());return(0,a.FD)(z.Flexbox,{gap:8,children:[(0,a.FD)(z.Flexbox,{gap:4,children:[(0,a.FD)(ec.A.Compact,{children:[(0,a.Y)(W.A,{onChange:e=>i(e.target.value),onPressEnter:u,placeholder:e("settingOpening.openingQuestions.placeholder"),value:n}),(0,a.Y)(P.A,{disabled:o.includes(n.trim()),icon:eu.A,onClick:u})]}),h&&(0,a.Y)("p",{className:t.repeatError,children:e("settingOpening.openingQuestions.repeat")})]}),(0,a.Y)("div",{className:t.questionsList,children:o.length>0?(0,a.Y)(ed.A,{items:g,onChange:m,renderItem:e=>(0,a.FD)(ed.A.Item,{className:t.questionItemContainer,id:e.id,variant:"filled",children:[(0,a.Y)(ed.A.DragHandle,{}),(0,a.Y)("div",{className:t.questionItemContent,children:e.content}),(0,a.Y)(_.A,{icon:ep.A,onClick:()=>p(e.content),size:"small"})]})}):(0,a.Y)(eg.A,{className:t.empty,description:e("settingOpening.openingQuestions.empty"),image:eg.A.PRESENTED_IMAGE_SIMPLE})})]})}),ey={style:{maxWidth:"100%",width:"100%"}},ev=(0,l.memo)(()=>{let{t:e}=(0,f.Bd)("setting");return(0,a.Y)(c.Ay,{items:[{children:[{children:(0,a.Y)(es,{}),desc:e("settingOpening.openingMessage.desc"),label:e("settingOpening.openingMessage.title"),layout:"vertical",wrapperCol:ey},{children:(0,a.Y)(eb,{}),desc:e("settingOpening.openingQuestions.desc"),label:e("settingOpening.openingQuestions.title"),layout:"vertical",wrapperCol:ey}],title:e("settingOpening.title")}],itemsType:"group",variant:"borderless",...C.pC})});var eA=n(67072),ef=n(3136),eC=n(20966),eY=n(40718),ek=n(51997),eT=n.n(ek),eS=n(20480),eP=n(61405),ex=n(36740),eF=n(58065),eM=n(16451),e_=n(74038),ew=n(23211),eE=n(35863),ez=n(80734),eL=n(78778);let ej=(0,l.forwardRef)((e,t)=>{let{t:n}=(0,f.Bd)("setting"),[i,o]=(0,l.useState)(!1),[r]=(0,s.Pj)(e=>[e.toggleAgentPlugin]),[d,c]=(0,e_.j)(e=>[e.installCustomPlugin,e.updateNewCustomPlugin]);return(0,a.FD)("div",{onClick:e=>{e.stopPropagation()},children:[(0,a.Y)(eL.A,{onOpenChange:o,onSave:async e=>{await d(e),r(e.identifier)},onValueChange:c,open:i}),(0,a.Y)(P.A,{icon:ez.A,onClick:()=>{o(!0)},ref:t,size:"small",children:n("plugin.addTooltip")})]})}),eD=(0,w.rU)(({css:e,prefixCls:t})=>({avatar:e`
    .${t}-skeleton-header {
      padding-inline-end: 0;
    }
  `,label:e`
    li {
      height: 14px !important;
    }

    li + li {
      margin-block-start: 12px !important;
    }
  `})),eI=(0,l.memo)(({id:e})=>{let[t,n]=(0,s.Pj)(e=>[e.toggleAgentPlugin,!!e.config.plugins]),i=(0,s.Pj)(e=>e.config.plugins||[]),[l,o]=(0,e_.j)(e=>[e.useFetchPluginStore,e.installPlugin]),r=(0,e_.j)(e=>e.pluginInstallLoading,y());return l(),(0,a.Y)(z.Flexbox,{align:"center",gap:8,horizontal:!0,children:(0,a.Y)(m.A,{checked:!r[e]&&!!n&&i.includes(e),loading:r[e],onChange:n=>{t(e),n&&o(e)}})})}),eW=(0,l.memo)(({identifier:e})=>{let t=(0,e_.j)(e=>e.pluginInstallLoading,y()),[n,i,l]=(0,s.Pj)(e=>[e.config.plugins||[],!!e.config.plugins,e.toggleAgentPlugin]);return(0,a.Y)(z.Flexbox,{align:"center",gap:8,horizontal:!0,children:(0,a.Y)(m.A,{checked:!t[e]&&!!i&&n.includes(e),loading:t[e],onChange:()=>{l(e)}})})}),eB=(0,l.memo)(()=>{let{t:e}=(0,f.Bd)("setting"),[t,n]=(0,l.useState)(!1),[o,g]=(0,s.Pj)(e=>[e.config.plugins||[],e.toggleAgentPlugin]),{showMarket:u}=(0,r.wo)(d.E),p=(0,e_.j)(eE.P.metaList,y()),{isLoading:h}=(0,eM.S)(),b=0===p.length&&0===o.length,v=p.map(({identifier:e,type:t,meta:n,author:i})=>{let l="customPlugin"===t;return{avatar:(0,a.Y)(eP.A,{avatar:ew.V.getPluginAvatar(n),size:40}),children:l?(0,a.Y)(eI,{id:e}):(0,a.Y)(eW,{identifier:e}),desc:ew.V.getPluginDesc(n),label:(0,a.FD)(z.Flexbox,{align:"center",gap:8,horizontal:!0,children:[ew.V.getPluginTitle(n),(0,a.Y)(ex.A,{author:i,type:t})]}),layout:"horizontal",minWidth:void 0}}),A=o.filter(e=>!p.some(t=>t.identifier===e)).map(t=>({avatar:(0,a.Y)(eA.A,{avatar:"♻️",size:40}),children:(0,a.Y)(m.A,{checked:!0,onChange:()=>{g(t)}}),label:(0,a.FD)(z.Flexbox,{align:"center",gap:8,horizontal:!0,children:[t,(0,a.Y)(ef.A,{color:"red",children:e("plugin.installStatus.deprecated")})]}),layout:"horizontal",minWidth:void 0,tag:t})),Y=A.length>0,k=(()=>{let{styles:e}=eD(),t={avatar:(0,a.Y)(i.A,{active:!0,avatar:{size:40},className:e.avatar,paragraph:!1,title:!1}),label:(0,a.Y)(i.A,{active:!0,avatar:!1,paragraph:{className:e.label,style:{marginBottom:0}},style:{width:300},title:!1})};return[t,t,t]})(),T=(0,a.FD)(ec.A.Compact,{style:{width:"auto"},children:[(0,a.Y)(ej,{}),Y?(0,a.Y)(S.A,{title:e("plugin.clearDeprecated"),children:(0,a.Y)(P.A,{icon:eC.A,onClick:e=>{for(let t of(e.stopPropagation(),A))g(t.tag)},size:"small"})}):null,u?(0,a.Y)(S.A,{title:e("plugin.store"),children:(0,a.Y)(P.A,{icon:eY.A,onClick:e=>{e.stopPropagation(),n(!0)},size:"small"})}):null]}),x=(0,a.Y)(eS.default,{padding:40,children:(0,a.Y)(eg.A,{description:(0,a.FD)(f.x6,{i18nKey:"plugin.empty",ns:"setting",children:["暂无安装插件，",(0,a.Y)(eT(),{href:"/",onClick:e=>{e.preventDefault(),n(!0)},children:"前往插件市场"}),"安装"]}),image:eg.A.PRESENTED_IMAGE_SIMPLE})}),F={children:h?k:b?u?x:[]:[...A,...v],extra:T,title:e("settingPlugin.title")};return(0,a.FD)(a.FK,{children:[(0,a.Y)(eF.A,{open:t,setOpen:n}),(0,a.Y)(c.Ay,{items:[F],itemsType:"group",variant:"borderless",...C.pC})]})});var eR=n(38069),eN=n(74732);let eO=(0,l.memo)(()=>{let{t:e}=(0,f.Bd)("setting"),t=(0,r.wo)(e=>e.isMobile),[n,i]=(0,l.useState)(!1),[o,d]=(0,s.Pj)(e=>[e.config.systemRole,e.setAgentConfig]),g=!n&&!!o&&(0,a.Y)(P.A,{icon:eR.A,iconPosition:"end",iconProps:{size:12},onClick:e=>{e.stopPropagation(),i(!0)},size:"small",type:"primary",children:e("edit",{ns:"common"})});return(0,a.Y)(c.Ay,{items:[{children:(0,a.FD)(z.Flexbox,{paddingBlock:16*!!t,children:[(0,a.Y)(el.A,{editing:n,height:"auto",markdownProps:{variant:"chat"},onChange:e=>{d({systemRole:e})},onEditingChange:i,placeholder:e("settingAgent.prompt.placeholder"),showEditWhenEmpty:!0,text:{cancel:e("cancel",{ns:"common"}),confirm:e("ok",{ns:"common"})},value:o,variant:"borderless"}),!n&&!!o&&(0,a.Y)(eN.A,{value:o})]}),extra:g,title:e("settingAgent.prompt.title")}],itemsType:"group",variant:"borderless",...C.pC})});var e$=n(3268),eV=n(78884),eq=n(79998),eK=n(17917),eG=n(80122),eH=n(91888),eQ=n(14980);let eU=(0,l.forwardRef)(({value:e,options:t,server:n,onSelect:i,...o},r)=>{let[s,d]=(0,l.useState)(),[c,g]=(0,l.useState)(e),{t:u}=(0,f.Bd)("welcome"),p=(0,w.DP)(),m=["Lobe Chat",u("slogan.title"),u("slogan.desc1")].join(". "),h=(0,l.useCallback)(e=>{d({body:e,message:u("tts.responseError",{ns:"error"}),type:500})},[u]),{isGlobalLoading:b,audio:y,stop:v,start:A,response:C,setText:Y}=(0,eQ.F)(m,{onError:e=>{v(),h(e)},onErrorRetry:e=>{v(),h(e)},onSuccess:async()=>{if(!C||200===C.status)return;let e=await (0,eq.EB)(C);e?d(e):h(),v()},server:n,voice:c}),k=(0,l.useCallback)(()=>{d(void 0),v()},[v]),T=(0,l.useCallback)(()=>{d(void 0),v(),A()},[v,A]);return(0,a.FD)(z.Flexbox,{gap:8,children:[(0,a.FD)(z.Flexbox,{align:"center",gap:8,horizontal:!0,style:{width:"100%"},children:[(0,a.Y)(R.A,{onSelect:(e,t)=>{v(),g(e),Y([m,t?.label].join(" - ")),i?.(e,t)},options:t,ref:r,value:e,...o}),(0,a.Y)(eK.A,{allowPause:!1,audio:y,buttonActive:!0,buttonSize:{blockSize:36,size:16},buttonStyle:{background:p.colorBgContainer,border:`1px solid ${p.colorBorder}`},isLoading:b,onInitPlay:A,onLoadingStop:v,showDonload:!1,showSlider:!1,showTime:!1,style:{flex:"none",padding:0,width:"unset"},title:u("settingTTS.voice.preview",{ns:"setting"})})]}),s&&(0,a.Y)(eG.A,{action:(0,a.Y)(P.A,{onClick:T,size:"small",type:"primary",children:u("retry",{ns:"common"})}),closable:!0,extra:s.body&&(0,a.Y)(eH.A,{actionIconSize:"small",language:"json",variant:"borderless",children:JSON.stringify(s.body,null,2)}),message:s.message,onClose:k,style:{alignItems:"center",width:"100%"},type:"error"})]})});var eJ=n(12173),eX=n(23493),eZ=n(25598);let e0=[{label:(0,a.Y)(eZ.IW,{Icon:eJ.A.Avatar,label:"OpenAI"}),value:"openai"},{label:(0,a.Y)(eZ.IW,{Icon:eX.A.Avatar,label:"Edge Speech"}),value:"edge"},{label:(0,a.Y)(eZ.IW,{Icon:eX.A.Avatar,label:"Microsoft Speech"}),value:"microsoft"}],{openaiVoiceOptions:e1,localeOptions:e8}=e$.F,e2=(0,l.memo)(()=>{let{t:e}=(0,f.Bd)("setting"),[t]=c.Ay.useForm(),n=(0,L.o)(e=>{let t=j.c.currentLanguage(e);return e=>new e$.F(e?void 0:t)}),i=(0,s.Pj)(k.T.currentTtsConfig,y()),o=(0,s.Pj)(e=>e.setAgentConfig),{edgeVoiceOptions:r,microsoftVoiceOptions:d}=(0,l.useMemo)(()=>n(i.showAllLocaleVoice),[i.showAllLocaleVoice]),g={children:[{children:(0,a.Y)(R.A,{options:e0}),desc:e("settingTTS.ttsService.desc"),label:e("settingTTS.ttsService.title"),name:["tts","ttsService"]},{children:(0,a.Y)(m.A,{}),desc:e("settingTTS.showAllLocaleVoice.desc"),hidden:"openai"===i.ttsService,label:e("settingTTS.showAllLocaleVoice.title"),layout:"horizontal",minWidth:void 0,name:["tts","showAllLocaleVoice"],valuePropName:"checked"},{children:(0,a.Y)(eU,{options:e1,server:"openai"}),desc:e("settingTTS.voice.desc"),hidden:"openai"!==i.ttsService,label:e("settingTTS.voice.title"),name:["tts","voice","openai"]},{children:(0,a.Y)(eU,{options:r,server:"edge"}),desc:e("settingTTS.voice.desc"),divider:!1,hidden:"edge"!==i.ttsService,label:e("settingTTS.voice.title"),name:["tts","voice","edge"]},{children:(0,a.Y)(eU,{options:d,server:"microsoft"}),desc:e("settingTTS.voice.desc"),divider:!1,hidden:"microsoft"!==i.ttsService,label:e("settingTTS.voice.title"),name:["tts","voice","microsoft"]},{children:(0,a.Y)(R.A,{options:[{label:e("settingCommon.lang.autoMode"),value:"auto"},...e8||[]]}),desc:e("settingTTS.sttLocale.desc"),label:e("settingTTS.sttLocale.title"),name:["tts","sttLocale"]}],icon:eV.A,title:e("settingTTS.title")};return(0,a.Y)(c.Ay,{footer:(0,a.Y)(c.Ay.SubmitFooter,{texts:{reset:e("submitFooter.reset"),submit:e("settingTTS.submit"),unSaved:e("submitFooter.unSaved"),unSavedWarning:e("submitFooter.unSavedWarning")}}),form:t,initialValues:{tts:i},items:[g],itemsType:"group",onFinish:o,variant:"borderless",...C.pC})}),e3=(0,l.memo)(({tab:e,loadingSkeleton:t})=>{let n=(0,s.Pj)(e=>e.loading),{enablePlugins:i}=(0,r.wo)(d.E);return n?t:(0,a.FD)(a.FK,{children:[e===o.iL.Meta&&(0,a.Y)(G,{}),e===o.iL.Prompt&&(0,a.Y)(eO,{}),e===o.iL.Opening&&(0,a.Y)(ev,{}),e===o.iL.Chat&&(0,a.Y)(T,{}),e===o.iL.Modal&&(0,a.Y)(ei,{}),e===o.iL.TTS&&(0,a.Y)(e2,{}),i&&e===o.iL.Plugin&&(0,a.Y)(eB,{})]})});var e7=n(43777);let e6=(0,l.memo)(({tab:e=o.iL.Meta,...t})=>{let n=(0,r.wo)(e=>e.isMobile),s=(0,a.Y)(i.A,{active:!0,paragraph:{rows:6},style:{padding:16*!!n},title:!1});return(0,a.Y)(e7.e,{...t,children:(0,a.Y)(l.Suspense,{fallback:s,children:(0,a.Y)(e3,{loadingSkeleton:s,tab:e})})})})},98602:(e,t,n)=>{n.d(t,{Kq:()=>S,y$:()=>Y,Pj:()=>k,PI:()=>T});var a=n(2773),i=n(14308),l=n(50786),o=n(23993),r=n(15361),s=n(22309),d=n(70674),c=n(71411),g=n(14306),u=n(38759),p=n(70030),m=n(67095),h=n(61497),b=n(99278),y=n(99061);let v={config:y.HA,loading:!0,loadingState:{avatar:!1,backgroundColor:!1,description:!1,tags:!1,title:!1},meta:b.M3};var A=n(85601);let f=(0,h.K)("AgentSettings"),C=(e,t)=>({...v,autoPickEmoji:async()=>{let{config:e,meta:n,dispatchMeta:a}=t(),i=e.systemRole;c.O.fetchPresetTaskResult({onFinish:async e=>{a({type:"update",value:{avatar:e}})},onLoadingChange:e=>{t().updateLoadingState("avatar",e)},params:(0,m.h)(t().internal_getSystemAgentForMeta(),(0,r.ju)([n.title,n.description,i].filter(Boolean).join(","))),trace:t().getCurrentTracePayload({traceName:s.Fs.EmojiPicker})})},autocompleteAgentDescription:async()=>{let{dispatchMeta:e,config:n,meta:a,updateLoadingState:i,streamUpdateMetaString:l}=t(),o=n.systemRole;if(!o)return;let d=a.description;e({type:"update",value:{description:"..."}}),c.O.fetchPresetTaskResult({onError:()=>{e({type:"update",value:{description:d}})},onLoadingChange:e=>{i("description",e)},onMessageHandle:l("description"),params:(0,m.h)(t().internal_getSystemAgentForMeta(),(0,r.e0)(o,g.J.getCurrentLanguage())),trace:t().getCurrentTracePayload({traceName:s.Fs.SummaryAgentDescription})})},autocompleteAgentTags:async()=>{let{dispatchMeta:e,config:n,meta:a,updateLoadingState:i,streamUpdateMetaArray:l}=t(),o=n.systemRole;if(!o)return;let d=a.tags;e({type:"update",value:{tags:["..."]}}),c.O.fetchPresetTaskResult({onError:()=>{e({type:"update",value:{tags:d}})},onLoadingChange:e=>{i("tags",e)},onMessageHandle:l("tags"),params:(0,m.h)(t().internal_getSystemAgentForMeta(),(0,r.fY)([a.title,a.description,o].filter(Boolean).join(","),g.J.getCurrentLanguage())),trace:t().getCurrentTracePayload({traceName:s.Fs.SummaryAgentTags})})},autocompleteAgentTitle:async()=>{let{dispatchMeta:e,config:n,meta:a,updateLoadingState:i,streamUpdateMetaString:l}=t(),o=n.systemRole;if(!o)return;let d=a.title;e({type:"update",value:{title:"..."}}),c.O.fetchPresetTaskResult({onError:()=>{e({type:"update",value:{title:d}})},onLoadingChange:e=>{i("title",e)},onMessageHandle:l("title"),params:(0,m.h)(t().internal_getSystemAgentForMeta(),(0,r.qY)([a.description,o].filter(Boolean).join(","),g.J.getCurrentLanguage())),trace:t().getCurrentTracePayload({traceName:s.Fs.SummaryAgentTitle})})},autocompleteAllMeta:e=>{let{meta:n}=t();(!n.title||e)&&t().autocompleteAgentTitle(),(!n.description||e)&&t().autocompleteAgentDescription(),(!n.avatar||e)&&t().autoPickEmoji(),(!n.tags||e)&&t().autocompleteAgentTags()},autocompleteMeta:e=>{let{autoPickEmoji:n,autocompleteAgentTitle:a,autocompleteAgentDescription:i,autocompleteAgentTags:l}=t();switch(e){case"avatar":return void n();case"description":return void i();case"title":return void a();case"tags":return void l()}},dispatchConfig:async n=>{let a=((e,t)=>{switch(t.type){case"update":return(0,A.jM)(e,e=>(0,m.h)(e,t.config));case"togglePlugin":return(0,A.jM)(e,e=>{let{pluginId:n,state:a}=t;(void 0===e.plugins&&(e.plugins=[]),void 0===a)?e.plugins.includes(n)?e.plugins.splice(e.plugins.indexOf(n),1):e.plugins.push(n):a?e.plugins.push(n):e.plugins=e.plugins.filter(e=>e!==n)});case"reset":return y.HA;default:return e}})(t().config,n);e({config:a},!1,n),await t().onConfigChange?.(a)},dispatchMeta:async n=>{let a=((e,t)=>{switch(t.type){case"update":return(0,A.jM)(e,e=>(0,m.h)(e,t.value));case"reset":return b.M3}})(t().meta,n);e({meta:a},!1,n),await t().onMetaChange?.(a)},getCurrentTracePayload:e=>({sessionId:t().id,topicId:s.lK.AgentSettings,...e}),internal_getSystemAgentForMeta:()=>p.v.agentMeta(u.k.getState()),resetAgentConfig:async()=>{await t().dispatchConfig({type:"reset"})},resetAgentMeta:async()=>{await t().dispatchMeta({type:"reset"})},setAgentConfig:async e=>{await t().dispatchConfig({config:e,type:"update"})},setAgentMeta:async e=>{let{dispatchMeta:n,id:a,meta:i}=t(),l=(0,m.h)(i,e);try{let e=(0,d.wZ)();e&&e.track({name:"agent_meta_updated",properties:{assistant_avatar:l.avatar,assistant_background_color:l.backgroundColor,assistant_description:l.description,assistant_name:l.title,assistant_tags:l.tags,is_inbox:"inbox"===a,session_id:a||"unknown",timestamp:Date.now(),user_id:u.k.getState().user?.id||"anonymous"}})}catch(e){console.warn("Failed to track agent meta update:",e)}await n({type:"update",value:e})},setChatConfig:async e=>{await t().setAgentConfig({chatConfig:e})},streamUpdateMetaArray:e=>{let n="";return a=>{"text"===a.type&&(n+=a.text,t().dispatchMeta({type:"update",value:{[e]:n.split(",")}}))}},streamUpdateMetaString:e=>{let n="";return a=>{"text"===a.type&&(n+=a.text,t().dispatchMeta({type:"update",value:{[e]:n}}))}},toggleAgentPlugin:(e,n)=>{t().dispatchConfig({pluginId:e,state:n,type:"togglePlugin"})},updateLoadingState:(n,a)=>{e({loadingState:{...t().loadingState,[n]:a}},!1,f("updateLoadingState",{key:n,value:a}))}}),Y=()=>(0,o.h)((0,i.eh)(C),l.x),{useStore:k,useStoreApi:T,Provider:S}=(0,a.q)()},99859:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(28802),i=n(47762),l=n(11577),o=n(83034),r=n(25598),s=n(6332);let d=(0,l.rU)(({css:e,prefixCls:t})=>({popup:e`
    &.${t}-select-dropdown .${t}-select-item-option-grouped {
      padding-inline-start: 12px;
    }
  `,select:e`
    .${t}-select-selection-item {
      .${r.$} {
        display: none;
      }
    }
  `})),c=(0,o.memo)(({value:e,onChange:t,showAbility:n=!0,requiredAbilities:l})=>{let c=(0,s.J)(),{styles:g}=d(),u=(0,o.useMemo)(()=>{let e=e=>(l&&l.length>0?e.children.filter(e=>l.every(t=>!!e.abilities?.[t])):e.children).map(t=>({label:(0,a.Y)(r.$z,{...t,...t.abilities,showInfoTag:n}),provider:e.id,value:`${e.id}/${t.id}`}));return 1===c.length?e(c[0]):c.map(t=>{let n=e(t);if(0!==n.length)return{label:(0,a.Y)(r.TK,{logo:t.logo,name:t.name,provider:t.id,source:t.source}),options:n}}).filter(Boolean)},[c,l,n]);return console.log("options",u),console.log("enabledList",c),(0,a.Y)(i.A,{className:g.select,classNames:{popup:{root:g.popup}},defaultValue:`${e?.provider}/${e?.model}`,onChange:(e,n)=>{let a=e.split("/").slice(1).join("/");t?.({model:a,provider:n.provider})},options:u,popupMatchSelectWidth:!1,value:`${e?.provider}/${e?.model}`})})}}]);