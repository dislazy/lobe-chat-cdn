"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[16992],{14741:(e,t,o)=>{o.d(t,{I:()=>n});var r=o(89196),s=o(83034),a=o(27697);let n=()=>{let[e]=(0,a.ok)();return(0,s.useMemo)(()=>r.A.parse(e.toString()),[e])}},16992:(e,t,o)=>{o.r(t),o.d(t,{default:()=>F});var r=o(28802),s=o(80457),a=o(30179),n=o(27697),i=o(82520),l=o(28573),c=o(11577),d=o(3779),u=o(83034),h=o(20480),p=o(96477),g=o(61451),f=o(30069),m=o(38153),k=o(12389),y=o(28755),w=o(22577),b=o(20439),C=o(59121),A=o(72947),I=o(14741),v=o(62894),S=o(83268);let M=(0,u.memo)(()=>{let{t:e}=(0,C.Bd)("discover"),t=(0,A.a)(),{sort:o}=(0,I.I)(),s=(0,v.j)(),{isAuthenticated:a,getCurrentUserInfo:n}=(0,S.useMarketAuth)(),i=(0,u.useMemo)(()=>t.split("discover/")[1],[t]),l=(0,u.useMemo)(()=>{switch(i){case g.bz.Assistants:{let t=[{key:g.eC.CreatedAt,label:e("assistants.sorts.createdAt")},{key:g.eC.Title,label:e("assistants.sorts.title")},{key:g.eC.Identifier,label:e("assistants.sorts.identifier")},{key:g.eC.TokenUsage,label:e("assistants.sorts.tokenUsage")},{key:g.eC.PluginCount,label:e("assistants.sorts.pluginCount")},{key:g.eC.KnowledgeCount,label:e("assistants.sorts.knowledgeCount")}];return a&&t.push({key:g.eC.MyOwn,label:e("assistants.sorts.myown")}),t}case g.bz.Plugins:return[{key:g.vk.CreatedAt,label:e("plugins.sorts.createdAt")},{key:g.vk.Title,label:e("plugins.sorts.title")},{key:g.vk.Identifier,label:e("plugins.sorts.identifier")}];case g.bz.Models:return[{key:g.DU.ReleasedAt,label:e("models.sorts.releasedAt")},{key:g.DU.Identifier,label:e("models.sorts.identifier")},{key:g.DU.ContextWindowTokens,label:e("models.sorts.contextWindowTokens")},{key:g.DU.InputPrice,label:e("models.sorts.inputPrice")},{key:g.DU.OutputPrice,label:e("models.sorts.outputPrice")},{key:g.DU.ProviderCount,label:e("models.sorts.providerCount")}];case g.bz.Providers:return[{key:g.PN.Default,label:e("providers.sorts.default")},{key:g.PN.Identifier,label:e("providers.sorts.identifier")},{key:g.PN.ModelCount,label:e("providers.sorts.modelCount")}];case g.bz.Mcp:return[{key:g.kf.IsFeatured,label:e("mcp.sorts.isFeatured")},{key:g.kf.IsValidated,label:e("mcp.sorts.isValidated")},{key:g.kf.InstallCount,label:e("mcp.sorts.installCount")},{key:g.kf.RatingCount,label:e("mcp.sorts.ratingCount")},{key:g.kf.UpdatedAt,label:e("mcp.sorts.updatedAt")},{label:e("mcp.sorts.createdAt"),value:g.kf.CreatedAt}];default:return[]}},[e,i,a]),c=(0,u.useMemo)(()=>{if(o){let e=l?.find(e=>e.key===o);if(e)return e}return l?.[0]},[l,o]);return l?.length===0?null:(0,r.Y)(m.A,{menu:{activeKey:c.key,items:l,onClick:({key:e})=>(e=>{let o={sort:e};if(e===g.eC.MyOwn){let e=n();console.log("userInfo",e),e?.accountId&&(o.ownerId=e.accountId)}s.push(t,{query:o})})(e)},trigger:["click","hover"],children:(0,r.FD)(y.Ay,{"data-testid":"sort-dropdown",icon:(0,r.Y)(k.default,{icon:w.A}),type:"text",children:[c.label,(0,r.Y)(k.default,{icon:b.A})]})})});var _=o(40718);let x=(0,u.memo)(()=>{let{t:e}=(0,C.Bd)("discover"),t=(0,v.j)(),o=(0,p.I)().source??"new",s=(0,u.useMemo)(()=>[{key:"new",label:e("assistants.marketSource.new")},{key:"legacy",label:e("assistants.marketSource.legacy")}],[e]);return(0,r.Y)(m.A,{menu:{activeKey:o,items:s,onClick:({key:e})=>{t.push("/discover/assistant",{query:{page:null,source:"new"===e?null:e}})}},trigger:["click","hover"],children:(0,r.FD)(y.Ay,{icon:(0,r.Y)(k.default,{icon:_.A}),type:"text",children:[e("assistants.marketSource.label"),":"," ",s.find(e=>e.key===o)?.label,(0,r.Y)(k.default,{icon:b.A})]})})});x.displayName="MarketSourceSwitch";var D=o(7729),O=o(12020);let T=(0,c.rU)(({cx:e,stylish:t,css:o,token:r})=>({container:e(t.blur,o`
      position: absolute;
      z-index: 9;
      inset-block-start: 52px;
      inset-inline: 0 0;

      padding-block: 4px;
      border-block-end: 1px solid ${r.colorBorderSecondary};

      background: ${(0,d.B3)(r.colorBgContainerSecondary,.9)};

      transition: all 0.3s ${r.motionEaseInOut};
    `),hide:o`
    transform: translateY(-150%);
  `})),z=(0,u.memo)(()=>{var e;let t,[o,a]=(0,u.useState)(!1),c=(0,n.zy)(),d=(0,n.Zp)(),{cx:m,styles:k}=T(),{items:y,activeKey:w}=(0,f.h)(),{q:b}=(0,p.I)();e=(e,t)=>{t<0?a(!1):e>600&&t>0&&a(!0)},t=(0,u.useRef)(0),(0,u.useEffect)(()=>{if(O.i)return;let o=document.querySelector(`#${i.n}`);if(!o)return;let r=(0,D.A)(()=>{let r=o.scrollTop,s=r-t.current;e?.(r,s),t.current=r});return o.addEventListener("scroll",r,{passive:!0}),()=>{o.removeEventListener("scroll",r)}},[]);let C="/"===c.pathname;return(0,r.Y)(h.default,{className:m(k.container,o&&k.hide),height:46,children:(0,r.FD)(s.Flexbox,{align:"center",horizontal:!0,justify:"space-between",style:{maxWidth:i.g,width:"100%"},children:[(0,r.Y)(s.Flexbox,{align:"center",gap:4,horizontal:!0,children:(0,r.Y)(l.A,{activeKey:w,compact:!0,items:y,onChange:e=>{d((e===g.bz.Home?"/discover":`/discover/${e}`)+(b?`?q=${encodeURIComponent(b)}`:""),{replace:!0});let t=document?.querySelector(`#${i.n}`);t&&t.scrollTo({behavior:"smooth",top:0})},style:{fontWeight:500}})}),!C&&(0,r.FD)(s.Flexbox,{align:"center",gap:8,horizontal:!0,children:[w===g.bz.Assistants&&(0,r.Y)(x,{}),(0,r.Y)(M,{})]})]})})}),P=()=>(0,r.FD)(r.FK,{children:[(0,r.Y)(z,{}),(0,r.Y)(s.Flexbox,{align:"center",flex:1,id:i.n,padding:16,style:{overflowX:"hidden",overflowY:"scroll",position:"relative"},width:"100%",children:(0,r.FD)(s.Flexbox,{gap:16,style:{maxWidth:i.g,paddingTop:64,position:"relative"},width:"100%",children:[(0,r.Y)(n.sv,{}),(0,r.Y)("div",{}),(0,r.Y)(a.A,{})]})})]});P.displayName="DesktopDiscoverStoreLayout";let F=P},30069:(e,t,o)=>{o.d(t,{h:()=>g});var r=o(28802),s=o(50344),a=o(12389),n=o(66843),i=o(35426),l=o(18223),c=o(29449),d=o(83034),u=o(59121),h=o(27697),p=o(61451);let g=()=>{let e=(0,h.zy)(),{t}=(0,u.Bd)("discover"),o=(0,d.useMemo)(()=>{let t=e.pathname;for(let e of Object.values(p.bz))if(t.includes(`/${p.bz.Plugins}`))return p.bz.Mcp;else if(t.includes(`/${e}`))return e;return p.bz.Home},[e.pathname]),g=(0,d.useMemo)(()=>[{icon:(0,r.Y)(a.default,{icon:n.A,size:16}),key:p.bz.Home,label:(0,r.Y)("div",{style:{color:"inherit",display:"inline"},children:t("tab.home")})},{icon:(0,r.Y)(a.default,{icon:i.A,size:16}),key:p.bz.Assistants,label:(0,r.Y)("div",{style:{color:"inherit",display:"inline"},children:t("tab.assistant")})},{icon:(0,r.Y)(s.A,{className:"anticon",size:16}),key:p.bz.Mcp,label:(0,r.Y)("div",{style:{color:"inherit",display:"inline"},children:`MCP ${t("tab.plugin")}`})},{icon:(0,r.Y)(a.default,{icon:l.A,size:16}),key:p.bz.Models,label:(0,r.Y)("div",{style:{color:"inherit",display:"inline"},children:t("tab.model")})},{icon:(0,r.Y)(a.default,{icon:c.A,size:16}),key:p.bz.Providers,label:(0,r.Y)("div",{style:{color:"inherit",display:"inline"},children:t("tab.provider")})}],[t]);return{activeItem:g.find(e=>e.key===o),activeKey:o,items:g}}},30179:(e,t,o)=>{o.d(t,{A:()=>M});var r=o(28802),s=o(12389),a=o(11577),n=o(50833),i=o(51997),l=o.n(i),c=o(83034),d=o(59121),u=o(80457),h=o(20480),p=o(92619),g=o(31985),f=o(3779);let m=(0,a.rU)(({css:e,token:t,prefixCls:o})=>({content:e`
      .${o}-modal-footer {
        margin: 0;
        padding: 16px;
      }
      .${o}-modal-header {
        display: flex;
        gap: 4px;
        align-items: center;
        justify-content: center;

        height: 56px;
        margin-block-end: 0;
        padding: 16px;
      }
      .${o}-modal-content {
        overflow: hidden;
        padding: 0;
        border: 1px solid ${t.colorSplit};
        border-radius: ${t.borderRadiusLG}px;
      }
    `,wrap:e`
      overflow: hidden auto;
    `})),k=(0,c.memo)(({className:e,title:t,desc:o,cover:s,width:a=360,...n})=>{let{styles:i,cx:l,theme:c}=m();return(0,r.Y)(p.Ay,{theme:{token:{colorBgElevated:(0,f.a)(.005,c.colorBgContainer)}},children:(0,r.FD)(g.A,{centered:!0,className:l(i.content,e),closable:!1,maskClosable:!0,width:a,wrapClassName:i.wrap,...n,children:[s,(0,r.FD)(u.Flexbox,{padding:16,children:[(0,r.Y)("h3",{style:{fontWeight:"bold"},children:t}),(0,r.Y)("p",{style:{marginBottom:0},children:o})]})]})})}),y=(0,c.memo)(({height:e,width:t,src:o})=>{let s=(0,a.DP)();return(0,r.Y)("video",{autoPlay:!0,controls:!1,height:e,loop:!0,muted:!0,src:o,style:{background:s.colorFillSecondary,height:"auto",width:"100%"},width:t})});var w=o(98724),b=o(45628),C=o(62326),A=o(12467),I=o(12020);let v=(0,a.rU)(({css:e,token:t})=>e`
    font-size: 12px;
    color: ${t.colorTextSecondary};
  `),S=(0,c.memo)(()=>{let{t:e}=(0,d.Bd)("common"),[t,o]=(0,c.useState)(!1),[a,i]=(0,c.useState)(!1),{styles:p}=v(),{hideGitHub:g}=(0,C.wo)(A.E);return g?null:(0,r.FD)(r.FK,{children:[(0,r.Y)(u.Flexbox,{className:"settings-layout-footer",justify:"flex-end",children:(0,r.Y)(h.default,{as:"footer",className:p,flex:"none",horizontal:!0,padding:16,width:"100%",children:(0,r.FD)("div",{style:{textAlign:"center"},children:[(0,r.Y)(s.default,{icon:n.A})," ",`${e("footer.title")} `,(0,r.Y)(l(),{"aria-label":"star",href:b.U0,onClick:e=>{e.preventDefault(),o(!0)},children:e("footer.action.star")}),` ${e("footer.and")} `,(0,r.Y)(l(),{"aria-label":"feedback",href:b.ve,onClick:e=>{e.preventDefault(),i(!0)},children:e("footer.action.feedback")})," !"]})})}),(0,r.Y)(k,{cancelText:e("footer.later"),cover:(0,r.Y)(y,{height:269,src:"/videos/star.mp4?v=1",width:358}),desc:e("footer.star.desc"),okText:e("footer.star.action"),onCancel:()=>o(!1),onOk:()=>{I.i||window.open(b.U0,"__blank")},open:t,title:e("footer.star.title")}),(0,r.Y)(k,{cancelText:e("footer.later"),cover:(0,r.Y)(y,{height:269,src:"/videos/feedback.mp4?v=1",width:358}),desc:e("footer.feedback.desc",{appName:w.Se}),okText:e("footer.feedback.action"),onCancel:()=>i(!1),onOk:()=>{I.i||window.open(b.ve,"__blank")},open:a,title:e("footer.feedback.title")})]})});S.displayName="SettingFooter";let M=S},72947:(e,t,o)=>{o.d(t,{a:()=>s});var r=o(27697);let s=()=>(0,r.zy)().pathname},82520:(e,t,o)=>{o.d(t,{g:()=>r,n:()=>s});let r=1440,s="discover-scroll"},83268:(e,t,o)=>{o.d(t,{MarketAuthProvider:()=>f,useMarketAuth:()=>m});var r=o(28802),s=o(83034),a=o(32308),n=o(86076),i=o(55036);class l{static{this.DESKTOP_HANDOFF_CLIENT="desktop"}static{this.DESKTOP_HANDOFF_POLL_INTERVAL=1500}static{this.DESKTOP_HANDOFF_TIMEOUT=3e5}constructor(e){this.config=e}generateCodeVerifier(){console.log("[MarketOIDC] Generating PKCE code verifier");let e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}async generateCodeChallenge(e){console.log("[MarketOIDC] Generating PKCE code challenge");let t=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",t);return btoa(String.fromCharCode.apply(null,Array.from(new Uint8Array(o)))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}generateState(){console.log("[MarketOIDC] Generating random state");let e=new Uint8Array(16);return crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}async generatePKCEParams(){console.log("[MarketOIDC] Generating PKCE parameters");let e=this.generateCodeVerifier(),t=await this.generateCodeChallenge(e),o=this.generateState();return sessionStorage.setItem("market_code_verifier",e),sessionStorage.setItem("market_state",o),console.log("[MarketOIDC] PKCE parameters generated and stored"),{codeChallenge:t,codeVerifier:e,state:o}}async buildAuthUrl(){console.log("[MarketOIDC] Building authorization URL");let e=await this.generatePKCEParams();console.log("[MarketOIDC] this.config:",this.config);let t=new URL(`${this.config.baseUrl.replace(/\/$/,"")}${a.sg.auth}`);return t.searchParams.set("client_id",this.config.clientId),t.searchParams.set("redirect_uri",this.config.redirectUri),t.searchParams.set("response_type","code"),t.searchParams.set("scope",this.config.scope),t.searchParams.set("state",e.state),t.searchParams.set("code_challenge",e.codeChallenge),t.searchParams.set("code_challenge_method","S256"),console.log("[MarketOIDC] Authorization URL built:",t.toString()),t.toString()}async exchangeCodeForToken(e,t){if(console.log("[MarketOIDC] Exchanging authorization code for token"),t!==sessionStorage.getItem("market_state"))throw console.error("[MarketOIDC] State parameter mismatch"),new n.V("stateMismatch",{message:"Invalid state parameter"});let o=sessionStorage.getItem("market_code_verifier");if(!o)throw console.error("[MarketOIDC] Code verifier not found"),new n.V("codeVerifierMissing",{message:"Code verifier not found"});let r=a.sg.token,s=new URLSearchParams({client_id:this.config.clientId,code:e,code_verifier:o,grant_type:"authorization_code",redirect_uri:this.config.redirectUri});console.log("[MarketOIDC] Sending token exchange request",{client_id:this.config.clientId,code:e,code_verifier:o,grant_type:"authorization_code",redirect_uri:this.config.redirectUri});let i=await fetch(r,{body:s.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"});if(console.log("[MarketOIDC] Token exchange response:",i),!i.ok){let e=await i.json().catch(()=>void 0);console.log("[MarketOIDC] Token exchange error data:",e);let t=`Token exchange failed: ${i.status} ${i.statusText} ${e?.error_description||e?.error||""}`.trim();throw console.error("[MarketOIDC]",t),new n.V("authorizationFailed",{message:t,meta:{error:e,status:i.status,statusText:i.statusText}})}let l=await i.json();return console.log("[MarketOIDC] Token exchange successful"),sessionStorage.removeItem("market_code_verifier"),sessionStorage.removeItem("market_state"),l}async startAuthorization(){console.log("[MarketOIDC] Starting authorization flow");let e=await this.buildAuthUrl(),t=sessionStorage.getItem("market_state");if(!t)throw console.error("[MarketOIDC] Missing state parameter in session storage"),new n.V("stateMissing",{message:"Authorization state not found. Please try again."});let r="1"===i.env.NEXT_PUBLIC_IS_DESKTOP_APP,s=null;if(r){console.log("[MarketOIDC] Desktop app detected, opening system browser via IPC");let{remoteServerService:r}=await Promise.resolve().then(o.bind(o,37844));try{let t=await r.requestMarketAuthorization({authUrl:e});if(!t.success)throw console.error("[MarketOIDC] Failed to open system browser:",t.error),new n.V("openBrowserFailed",{message:t.error||"Failed to open system browser",meta:{error:t.error}});console.log("[MarketOIDC] System browser opened successfully")}catch(e){throw console.error("[MarketOIDC] Exception opening system browser:",e),new n.V("openBrowserFailed",{cause:e,message:"Failed to open system browser. Please try again."})}return this.pollDesktopHandoff(t)}if(!(s=window.open(e,"market_auth","width=580,height=720,scrollbars=yes,resizable=yes")))throw console.error("[MarketOIDC] Failed to open authorization popup"),new n.V("openPopupFailed",{message:"Failed to open authorization popup. Please check popup blocker settings."});return new Promise((e,t)=>{let o,r;function a(){window.removeEventListener("message",r),o&&clearInterval(o)}r=o=>{console.log("[MarketOIDC] Received message from popup:",o.data),"MARKET_AUTH_SUCCESS"===o.data.type?(a(),e({code:o.data.code,state:o.data.state})):"MARKET_AUTH_ERROR"===o.data.type&&(a(),s?.close(),t(new n.V("authorizationFailed",{message:o.data.error||"Authorization failed",meta:{error:o.data.error}})))},window.addEventListener("message",r),s&&(o=setInterval(()=>{s.closed&&(a(),t(new n.V("popupClosed",{message:"Authorization popup was closed"})))},1e3))})}async pollDesktopHandoff(e){console.log("[MarketOIDC] Starting desktop handoff polling with state:",e);let t=Date.now(),o=`${a.sg.handoff}?id=${encodeURIComponent(e)}&client=${encodeURIComponent(l.DESKTOP_HANDOFF_CLIENT)}`;for(console.log("[MarketOIDC] Poll URL:",o);Date.now()-t<l.DESKTOP_HANDOFF_TIMEOUT;)try{let t=await fetch(o,{cache:"no-store",credentials:"include"}),r=await t.json().catch(()=>void 0);if(console.log("[MarketOIDC] Poll response:",t.status,r),200===t.status&&r?.status==="success"&&"string"==typeof r?.code)return console.log("[MarketOIDC] Desktop handoff succeeded"),{code:r.code,state:e};if(202===t.status||r?.status==="pending"){await new Promise(e=>{setTimeout(e,l.DESKTOP_HANDOFF_POLL_INTERVAL)});continue}if(404===t.status||r?.status==="consumed")throw new n.V("codeConsumed",{message:"Authorization code already consumed. Please retry."});if(410===t.status||r?.status==="expired")throw new n.V("sessionExpired",{message:"Authorization session expired. Please restart the sign-in process."});let s=r?.error||r?.message||`Handoff request failed with status ${t.status}`;throw console.error("[MarketOIDC] Handoff polling failed:",s),new n.V("handoffFailed",{message:s,meta:{data:r,status:t.status}})}catch(t){if(console.error("[MarketOIDC] Error while polling handoff endpoint:",t),t instanceof n.V)throw t;let e=t instanceof Error?t.message:"Failed to retrieve authorization result from handoff endpoint.";throw new n.V("handoffFailed",{cause:t,message:e})}throw console.warn("[MarketOIDC] Desktop handoff polling timed out"),new n.V("handoffTimeout",{message:"Authorization timeout. Please complete the authorization in the browser and try again."})}}var c=o(55036);let d=(0,s.createContext)(null),u=(e,t)=>{console.log("[MarketAuth] Storing token to cookie");let o=new Date(Date.now()+1e3*t);document.cookie=`market-bearertoken=${e}; expires=${o.toUTCString()}; path=/; secure; samesite=strict`},h=()=>{console.log("[MarketAuth] Removing token from cookie"),document.cookie="market-bearertoken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"},p=async e=>{try{let t=await fetch(a.sg.userinfo,{body:JSON.stringify({token:e}),headers:{"Content-Type":"application/json"},method:"POST"});if(console.log("[MarketAuth] User info response:",t),!t.ok)return console.error("[MarketAuth] Failed to fetch user info:",t.status,t.statusText),null;let o=await t.json();return console.log("[MarketAuth] User info fetched successfully:",o),o}catch(e){return console.error("[MarketAuth] Error fetching user info:",e),null}},g=async()=>(console.log("[MarketAuth] Refresh token not implemented yet"),!1),f=({children:e,isDesktop:t})=>{let[o,i]=(0,s.useState)(null),[f,m]=(0,s.useState)("loading"),[k,y]=(0,s.useState)(null),[w,b]=(0,s.useState)(!1);(0,s.useEffect)(()=>{{let e=c.env.NEXT_PUBLIC_MARKET_BASE_URL||"https://market.lobehub.com",o=new URL(a.sg.desktopCallback,e).toString(),r=t?o:`${window.location.origin}/market-auth-callback`;y(new l({baseUrl:e,clientId:t?"lobehub-desktop":"lobechat-com",redirectUri:r,scope:"openid profile email"}))}},[t]);let C=async()=>{if(console.log("[MarketAuth] Starting sign in process"),!k)throw console.error("[MarketAuth] OIDC client not initialized"),new n.V("oidcNotReady",{message:"OIDC client not initialized"});try{m("loading");let e=await k.startAuthorization();console.log("[MarketAuth] Authorization successful, exchanging code for token",e);let t=await k.exchangeCodeForToken(e.code,e.state);console.log("[MarketAuth] Token response:",t);let o=await p(t.accessToken),r={accessToken:t.accessToken,expiresAt:Date.now()+1e3*t.expiresIn,expiresIn:t.expiresIn,scope:t.scope,tokenType:t.tokenType,userInfo:o||void 0};return u(t.accessToken,t.expiresIn),sessionStorage.setItem("market_auth_session",JSON.stringify(r)),o&&sessionStorage.setItem("market_user_info",JSON.stringify(o)),i(r),m("authenticated"),console.log("[MarketAuth] Sign in completed successfully"),o?.accountId??null}catch(e){throw console.error("[MarketAuth] Sign in failed:",e),m("unauthenticated"),e}};return(0,s.useEffect)(()=>{(()=>{if(console.log("[MarketAuth] Attempting to restore session"),(()=>{if("undefined"==typeof document)return null;for(let e of document.cookie.split(";")){let[t,o]=e.trim().split("=");if("market-bearertoken"===t)return console.log("[MarketAuth] Found market token in cookie"),o}return null})()){let e=sessionStorage.getItem("market_auth_session");if(e)try{let t=JSON.parse(e);if(t.expiresAt>Date.now()){if(console.log("[MarketAuth] Session restored from storage"),console.log("parsedSession",t),console.log("parsedSession.userInfo",t.userInfo),console.log("sessionStorage.getItem('market_user_info')",sessionStorage.getItem("market_user_info")),!t.userInfo){let e=sessionStorage.getItem("market_user_info");if(e)try{t.userInfo=JSON.parse(e)}catch(e){console.error("[MarketAuth] Failed to parse stored user info:",e)}else b(!0)}i(t),m("authenticated");return}console.log("[MarketAuth] Stored session has expired, will trigger re-authorization"),sessionStorage.removeItem("market_auth_session"),h(),b(!0);return}catch(e){console.error("[MarketAuth] Failed to parse stored session:",e),sessionStorage.removeItem("market_auth_session"),h()}}console.log("[MarketAuth] No valid session found"),m("unauthenticated")})()},[]),(0,s.useEffect)(()=>{(async()=>{if(w&&k){b(!1);try{m("loading");let e=await k.startAuthorization(),t=await k.exchangeCodeForToken(e.code,e.state),o=await p(t.accessToken),r={accessToken:t.accessToken,expiresAt:Date.now()+1e3*t.expiresIn,expiresIn:t.expiresIn,scope:t.scope,tokenType:t.tokenType,userInfo:o||void 0};u(t.accessToken,t.expiresIn),sessionStorage.setItem("market_auth_session",JSON.stringify(r)),o&&sessionStorage.setItem("market_user_info",JSON.stringify(o)),i(r),m("authenticated"),console.log("[MarketAuth] Auto re-authorization completed successfully")}catch(e){console.error("[MarketAuth] Auto re-authorization failed:",e),m("unauthenticated")}}})()},[w,k]),(0,r.Y)(d.Provider,{value:{getCurrentUserInfo:()=>{if(console.log("getCurrentUserInfo-session",o,o?.userInfo),o?.userInfo)return o.userInfo;try{let e=sessionStorage.getItem("market_user_info");if(e)return JSON.parse(e)}catch(e){console.error("[MarketAuth] Failed to get user info from storage:",e)}return null},isAuthenticated:"authenticated"===f,isLoading:"loading"===f,refreshToken:g,session:o,signIn:C,signOut:()=>{i(null),m("unauthenticated"),h(),sessionStorage.removeItem("market_auth_session"),sessionStorage.removeItem("market_user_info")},status:f},children:e})},m=()=>{let e=(0,s.useContext)(d);if(!e)throw Error("useMarketAuth must be used within a MarketAuthProvider");return e}},86076:(e,t,o)=>{o.d(t,{V:()=>r,j:()=>a});class r extends Error{constructor(e,t={}){super(t.message??e),this.name="MarketAuthError",this.code=e,this.meta=t.meta,t.cause&&(this.cause=t.cause)}}let s=[[/authorization can only be initiated in a browser environment/i,"browserOnly"],[/authorization code already consumed/i,"codeConsumed"],[/authorization popup was closed/i,"popupClosed"],[/authorization session expired/i,"sessionExpired"],[/authorization state not found/i,"stateMissing"],[/state mismatch/i,"stateMismatch"],[/code verifier not found/i,"codeVerifierMissing"],[/failed to open authorization popup/i,"openPopupFailed"],[/failed to open system browser/i,"openBrowserFailed"],[/oidc client not initialized/i,"oidcNotReady"],[/failed to retrieve authorization result from handoff endpoint/i,"handoffFailed"],[/invalid state parameter/i,"stateMismatch"],[/timeout/i,"handoffTimeout"]],a=e=>{if(e instanceof r)return e;if(e instanceof Error){let t=s.find(([t])=>t.test(e.message));return t?new r(t[1],{cause:e}):new r("authorizationFailed",{cause:e,meta:{message:e.message}})}return new r("general")}},96477:(e,t,o)=>{o.d(t,{I:()=>n});var r=o(50718),s=o(89196),a=o(83034);let n=()=>{let e=(0,r.useSearchParams)();return(0,a.useMemo)(()=>s.A.parse(e.toString()),[e])}}}]);