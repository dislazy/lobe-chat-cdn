"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[76157],{43262:(e,t,a)=>{a.d(t,{C:()=>r});let r={isSyncActive:e=>e.dataSyncConfig.active,remoteServerUrl:e=>e.dataSyncConfig.remoteServerUrl||"",storageMode:e=>e.dataSyncConfig.storageMode}},76157:(e,t,a)=>{a.d(t,{T:()=>g,desktopRemoteRPCFetch:()=>u,q:()=>p});var r=a(74551),n=a(14343),s=a(79998),o=a(68096),i=a.n(o),l=a(64694),c=a(43262);let d=i()("utils:desktopRemoteRPCFetch"),u=async(e,t)=>{let a=c.C.isSyncActive((0,l.R)());if(d("isSyncActive:",a),a){d("Using IPC proxy for tRPC request");try{let a=new URL(e,window.location.origin),r=a.pathname+a.search,o=t?.method?.toUpperCase()||"GET",i=(0,s.jD)(t?.headers),l=await (0,s.gj)(t?.body),c=await (0,n.dispatch)("proxyTRPCRequest",{body:l,headers:i,method:o,urlPath:r});d(`Received ${e} IPC proxy response:`,{status:c.status});let u=new Response(c.body,{headers:c.headers,status:c.status,statusText:c.statusText});return u.ok||console.warn(`[lambda] ${e} IPC proxy response indicates an error:`,u.status,u.statusText),u}catch(t){return console.error(`[lambda] Error during ${e} IPC proxy call:`,t),new Response(`IPC Proxy Error: ${t instanceof Error?t.message:"Unknown error"}`,{status:500,statusText:"IPC Proxy Error"})}}},p=async(e,t)=>{if(r.xl){let a=await u(e,t);if(a)return a}return fetch(e,t)},g=async(e,t)=>{if(r.xl){let a=c.C.isSyncActive((0,l.R)());if(d("isSyncActive:",a),a)return d("Using IPC stream proxy for request to:",e),(0,n.$l)(e,t)}return fetch(e,t)}},79998:(e,t,a)=>{a.d(t,{aY:()=>y,EB:()=>u,gj:()=>m,jD:()=>h,Pv:()=>g});var r=a(74551),n=a(16748),s=a(22309);async function o(e,t){let a,r=e.getReader();for(;!(a=await r.read()).done;)t(a.value)}function i(){return{data:"",event:"",id:"",retry:void 0}}let l="last-event-id";var c=a(46322),d=a(85614);let u=async e=>{let t;try{let a=await e.json();t={body:a.body,message:(0,d.t)(`response.${a.errorType}`,{ns:"error"}),type:a.errorType}}catch{t={message:(0,d.t)(`response.${e.status}`,{ns:"error"}),type:e.status}}return t},p=e=>{let{startSpeed:t=10}=e,a="",r=[],n=!1,s=null,o=0,i=0,l=t,c=0;return{isAnimationActive:!1,isTokenRemain:()=>r.length>0,pushToQueue:e=>{r.push(...e.split(""))},startAnimation:(d=t)=>new Promise(t=>{if(n)return void t();n=!0,o=performance.now(),i=0,l=d,c=0;let u=p=>{if(!n){null!==s&&cancelAnimationFrame(s),t();return}let g=p-o;o=p,i+=g;let y=0;if(r.length>0){let e=Math.max(d,r.length),t=8e-4*Math.abs(r.length-c)+.005;l+=(e-l)*t,y=Math.floor(i*l/1e3)}if(y>0){i-=1e3*y/l;let t=Math.min(y,r.length),n=r.splice(0,t).join("");a+=n,e.onTextUpdate(n,a)}c=r.length,r.length>0&&n?s=requestAnimationFrame(u):(n=!1,s=null,t())};s=requestAnimationFrame(u)}),stopAnimation:()=>{n=!1,null!==s&&(cancelAnimationFrame(s),s=null)}}},g=e=>"object"==typeof e?e:{text:e},y=async(e,t={})=>{let a,d,y,h,m,f,b=!1,w="done",{text:x,speed:k}=g(t.responseAnimation??{}),v="none"===x,A="smooth"===x,C="",T=null,P=()=>{C&&(t.onMessageHandle?.({text:C,type:"text"}),C="")},E="",M=p({onTextUpdate:(e,a)=>{E=a,t.onMessageHandle?.({text:e,type:"text"})},startSpeed:k}),H="",R=p({onTextUpdate:(e,a)=>{H=a,t.onMessageHandle?.({text:e,type:"reasoning"})},startSpeed:k}),S="",U=null,_=()=>{S&&(t.onMessageHandle?.({text:S,type:"reasoning"}),S="")},I=[];if(await function(e,{signal:t,headers:a,onopen:r,onmessage:n,onclose:s,onerror:c,fetch:d,...u}){return new Promise(p=>{let g={...a};g.accept||(g.accept="text/event-stream");let y=d??window.fetch;!async function(){try{var a,d;let c,h,m,f,b,w,x=await y(e,{...u,headers:g,signal:t});await r(x),await o(x.body,(a=e=>{e?g[l]=e:delete g[l]},c=i(),h=new TextDecoder,d=function(e,t){if(0===e.length)n?.(c),c=i();else if(t>0){let r=h.decode(e.subarray(0,t)),n=t+(32===e[t+1]?2:1),s=h.decode(e.subarray(n));switch(r){case"data":c.data=c.data?c.data+"\n"+s:s;break;case"event":c.event=s;break;case"id":a(c.id=s)}}},w=!1,function(e){var t,a;let r;void 0===m?(m=e,f=0,b=-1):(t=m,a=e,(r=new Uint8Array(t.length+a.length)).set(t),r.set(a,t.length),m=r);let n=m.length,s=0;for(;f<n;){w&&(10===m[f]&&(s=++f),w=!1);let e=-1;for(;f<n&&-1===e;++f)switch(m[f]){case 58:-1===b&&(b=f-s);break;case 13:w=!0;case 10:e=f}if(-1===e)break;d(m.subarray(s,e),b),s=f,b=-1}s===n?m=void 0:0!==s&&(m=m.subarray(s),f-=s)})),s?.(),p()}catch(e){c?.(e),p()}}()})}(e,{body:t.body,fetch:t?.fetcher,headers:t.headers,method:t.method,onerror:e=>{if(e===r.OB||"AbortError"===e.name)w="abort",t?.onAbort?.(E),M.stopAnimation();else{w="error",t.onErrorHandle?.(e.type?e:{body:{message:e.message,name:e.name,stack:e.stack},message:e.message,type:s.T_.UnknownChatFetchError});return}},onmessage:e=>{let r;b=!0;try{r=JSON.parse(e.data)}catch(a){console.warn("parse error:",a),t.onErrorHandle?.({body:{context:{chunk:e.data,error:{message:a.message,name:a.name}},message:"chat response streaming chunk parse error, please contact your API Provider to fix it."},message:"parse error",type:"StreamChunkError"});return}switch(e.event){case"error":w="error",t.onErrorHandle?.(r);break;case"base64_image":{let e="tmp_img_"+(0,c.Ak)(),a={data:r,id:e,isBase64:!0};I.push(a),t.onMessageHandle?.({id:e,image:a,images:I,type:"base64_image"});break}case"text":if(!r)break;v?(E+=r,t.onMessageHandle?.({text:r,type:"text"})):A?(M.pushToQueue(r),M.isAnimationActive||M.startAnimation()):(E+=r,C+=r,T||(T=setTimeout(()=>{P(),T=null},300)));break;case"usage":d=r,t.onMessageHandle?.({type:"usage",usage:r});break;case"speed":y=r,t.onMessageHandle?.({speed:r,type:"speed"});break;case"grounding":a=r,t.onMessageHandle?.({grounding:r,type:"grounding"});break;case"reasoning_signature":f=r;break;case"stop":t.onMessageHandle?.({reason:r,type:"stop"});break;case"reasoning":A?(R.pushToQueue(r),R.isAnimationActive||R.startAnimation()):(H+=r,S+=r,U||(U=setTimeout(()=>{_(),U=null},300)));break;case"tool_calls":h||(h=[]),h=(0,n.NN)(h,r),t.onMessageHandle?.({tool_calls:h,type:"tool_calls"})}},onopen:async e=>{if(!(m=e.clone()).ok)throw await u(e)},signal:t.signal}),m&&(M.stopAnimation(),T&&(clearTimeout(T),P()),U&&(clearTimeout(U),_()),m.ok)){b||(E=await m.clone().text(),t.onMessageHandle?.({text:E,type:"text"}));let e=m.headers.get(r.g_),n=m.headers.get(r.TE);M.isTokenRemain()&&await M.startAnimation(k),await t?.onFinish?.(E,{grounding:a,images:I.length>0?I:void 0,observationId:n,reasoning:H?{content:H,signature:f}:void 0,speed:y,toolCalls:h,traceId:e,type:w,usage:d})}return m},h=e=>{let t={};return e&&(e instanceof Headers?e.forEach((e,a)=>{t[a]=e}):Array.isArray(e)?e.forEach(([e,a])=>{t[e]=a}):Object.assign(t,e),delete t.host,delete t.connection,delete t["content-length"]),t},m=async e=>{if(e){if("string"==typeof e||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(e instanceof Blob)return await e.arrayBuffer();throw console.warn("Unsupported IPC proxy request body type:",typeof e),Error("Unsupported IPC proxy request body type")}}}}]);