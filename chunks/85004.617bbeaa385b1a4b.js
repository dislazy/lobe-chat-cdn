"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85004],{29914:(e,t,a)=>{let r,i,n;a.d(t,{Ay:()=>o,Ew:()=>i,iU:()=>r,yl:()=>n});var s=a(58244);let o=(0,a(83034).memo)(()=>{let e=s.A.useApp();return r=e.message,n=e.modal,i=e.notification,null})},38759:(e,t,a)=>{a.d(t,{c:()=>O,k:()=>L});var r=a(14308),i=a(50786),n=a(23993),s=a(41734),o=a(89872);let l={preference:o.I},d={...{defaultSettings:a(74551).a$,settings:{}},...l,...{},...{isOnboard:!1,isShowPWAGuide:!1,isUserCanEnableTrace:!1,isUserHasConversation:!1,isUserStateInit:!1}};var u=a(96773),c=a(70674),g=a(64911),m=a(85366),p=a(46265),f=a(55582),h=a(67095),S=a(61497),v=a(71457);let A=(0,S.K)("common"),y="initUserState",b=(0,S.K)("preference");var w=a(31021),U=a.n(w),k=a(19530),N=a(45628);class P{constructor(){this.createShareSettingsUrl=e=>`/?${N.N}=${encodeURI(JSON.stringify(e))}`,this.decodeShareSettings=e=>{try{return{data:JSON.parse(e)}}catch(e){return{message:JSON.stringify(e)}}}}}let C=new P;var I=a(34743),x=a(1866),Y=a(28074);let E=(0,s.t)("user"),L=(0,n.h)()((0,r.eh)(E((...e)=>({...d,...((e,t)=>({addToolToAllowList:async e=>{let a=t().settings.tool?.humanIntervention?.allowList||[];a.includes(e)||await t().setSettings({tool:{humanIntervention:{allowList:[...a,e]}}})},importAppSettings:async e=>{let{setSettings:a}=t();await a(e)},importUrlShareSettings:async e=>{if(e){let a=C.decodeShareSettings(e);!a?.message&&a?.data&&await t().setSettings(a.data)}},internal_createSignal:()=>{let a=t().updateSettingsSignal;a&&!a.signal.aborted&&a.abort(k.ve);let r=new AbortController;return e({updateSettingsSignal:r},!1,"signalForUpdateSettings"),r},resetSettings:async()=>{await f.W.resetUserSettings(),await t().refreshUserState()},setSettings:async a=>{let r,{settings:i,defaultSettings:n}=t(),s=(0,h.h)(i,a);if(U()(i,s))return;let o=(r=(e,t)=>(0,I.A)(e,(e,a,i)=>{(0,x.A)(a)&&(0,x.A)(t[i])?U()(a,t[i])||(e[i]=a):U()(a,t[i])||(e[i]=(0,Y.A)(a)&&(0,Y.A)(t[i])?r(a,t[i]):a)}))(s,n);e({settings:o},!1,"optimistic_updateSettings");let l=t().internal_createSignal();await f.W.updateUserSettings(o,l.signal),await t().refreshUserState()},updateDefaultAgent:async e=>{await t().setSettings({defaultAgent:e})},updateGeneralConfig:async e=>{await t().setSettings({general:e})},updateHumanIntervention:async e=>{let a=t().settings.tool?.humanIntervention||{};await t().setSettings({tool:{humanIntervention:{...a,...e}}})},updateKeyVaults:async e=>{await t().setSettings({keyVaults:e})},updateSystemAgent:async(e,a)=>{await t().setSettings({systemAgent:{[e]:{...a}}})}}))(...e),...((e,t)=>({updateGuideState:async e=>{let{updatePreference:a}=t(),r=(0,h.h)(t().preference.guide,e);await a({guide:r})},updateLab:async e=>{let{updatePreference:a}=t(),r=(0,h.h)(t().preference.lab,e);await a({lab:r},b("updateLab"))},updatePreference:async(a,r)=>{let i=(0,h.h)(t().preference,a);e({preference:i},!1,r||b("updatePreference")),await f.W.updatePreference(i)}}))(...e),...((e,t)=>({enableAuth:()=>u.S4,logout:async()=>{if(u.Nd)return void t().clerkSignOut?.({redirectUrl:location.toString()});if(u.J_){let{signOut:e}=await a.e(4975).then(a.bind(a,4975));e()}},openLogin:async()=>{if(u.Nd){let e=location.toString();t().clerkSignIn?.({fallbackRedirectUrl:e,signUpForceRedirectUrl:e,signUpUrl:"/signup"});return}if(u.J_){let{signIn:e}=await a.e(4975).then(a.bind(a,4975)),r=t()?.oAuthSSOProviders;if(r&&1===r.length)return void e(r[0]);e()}}}))(...e),...((e,t)=>({refreshUserState:async()=>{await (0,g.j)(y)},updateAvatar:async e=>{await f.W.updateAvatar(e),await t().refreshUserState()},updateKeyVaultConfig:async(e,a)=>{await t().setSettings({keyVaults:{[e]:a}})},useCheckTrace:e=>(0,m.Ay)(e?"checkTrace":null,()=>"boolean"==typeof v.U.userAllowTrace(t())?Promise.resolve(!1):Promise.resolve(t().isUserCanEnableTrace),{revalidateOnFocus:!1}),useInitUserState:(a,r,i)=>(0,p.Ju)(a?y:null,()=>f.W.getUserState(),{onError:e=>{i?.onError?.(e)},onSuccess:a=>{if(i?.onSuccess?.(a),a){let i={defaultAgent:r.defaultAgent,image:r.image,systemAgent:r.systemAgent},n=(0,h.h)(t().defaultSettings,i),s=0===Object.keys(a.preference||{}).length?o.I:a.preference,l=a.avatar||a.userId?(0,h.h)(t().user,{avatar:a.avatar,email:a.email,firstName:a.firstName,fullName:a.fullName,id:a.userId,latestName:a.lastName,username:a.username}):t().user;e({defaultSettings:n,isOnboard:a.isOnboard,isShowPWAGuide:a.canEnablePWAGuide,isUserCanEnableTrace:a.canEnableTrace,isUserHasConversation:a.hasConversation,isUserStateInit:!0,preference:s,settings:a.settings||{},subscriptionPlan:a.subscriptionPlan,user:l},!1,A("initUserState"));let d=(0,c.wZ)();d?.identify(a.userId||"",{email:a.email,firstName:a.firstName,lastName:a.lastName,username:a.username})}}})}))(...e)}))),i.x),O=()=>L.getState()},43262:(e,t,a)=>{a.d(t,{C:()=>r});let r={isSyncActive:e=>e.dataSyncConfig.active,remoteServerUrl:e=>e.dataSyncConfig.remoteServerUrl||"",storageMode:e=>e.dataSyncConfig.storageMode}},44268:(e,t,a)=>{a.d(t,{A:()=>h});var r=a(28802),i=a(41675),n=a(13286),s=a(91055),o=a(54819),l=a(95225),d=a(31031),u=a(69233),c=a(48727),g=a(52771),m=a(73576),p=a(3543);a(83034);let f={auth0:n.A,authelia:s.A.Color,authentik:o.A.Color,casdoor:l.A.Color,cloudflare:d.A.Color,default:u.A.Color,github:c.A,google:i.A.Color,logto:g.A.Color,"microsoft-entra-id":m.A.Color,zitadel:p.A.Color},h=(e,t=36)=>{let a=f[e]||f.default;return(0,r.Y)(a,{size:t})}},49683:(e,t,a)=>{a.d(t,{fetchErrorNotification:()=>A});var r=a(28802),i=a(51717),n=a(96987),s=a(29914),o=a(12389),l=a(59202),d=a(11577),u=a(70510),c=a(20439),g=a(33375),m=a(83034),p=a(59121),f=a(80457);let h=(0,d.AH)`
  pre.shiki {
    padding: 8px !important;
  }
`,S=(0,g.default)(()=>Promise.all([a.e(66304),a.e(3136),a.e(60590),a.e(20659),a.e(69507),a.e(38927)]).then(a.bind(a,446)),{loadableGenerated:{webpack:()=>[446]},loading:()=>(0,r.Y)(l.A,{avatar:!1,title:!1}),ssr:!1}),v=(0,m.memo)(({message:e,status:t})=>{let{t:a}=(0,p.Bd)("error"),[i,n]=(0,m.useState)(!1);return(0,r.FD)(f.Flexbox,{gap:8,children:[a(`response.${t}`),(0,r.FD)(f.Flexbox,{gap:4,horizontal:!0,onClick:()=>{n(!i)},style:{cursor:"pointer",fontSize:12},children:[a("fetchError.detail")," ",(0,r.Y)(o.default,{icon:i?u.A:c.A})]}),(0,r.Y)(S,{className:(0,d.cx)(h),language:"text",style:{display:i?void 0:"none",maxHeight:80},children:e})]})}),A={error:({status:e,errorMessage:t})=>{s.Ew.error({description:(0,r.Y)(v,{message:t,status:e}),icon:(0,r.Y)(i.A,{emoji:"\uD83E\uDD27",size:24}),message:(0,n.t)("fetchError.title",{ns:"error"}),type:"error"})}}},55582:(e,t,a)=>{a.d(t,{W:()=>n});var r=a(77605);class i{constructor(){this.getUserRegistrationDuration=async()=>r.du.user.getUserRegistrationDuration.query(),this.getUserState=async()=>r.du.user.getUserState.query(),this.getUserSSOProviders=async()=>r.du.user.getUserSSOProviders.query(),this.unlinkSSOProvider=async(e,t)=>r.du.user.unlinkSSOProvider.mutate({provider:e,providerAccountId:t}),this.makeUserOnboarded=async()=>r.du.user.makeUserOnboarded.mutate(),this.updateAvatar=async e=>r.du.user.updateAvatar.mutate(e),this.updatePreference=async e=>r.du.user.updatePreference.mutate(e),this.updateGuide=async e=>r.du.user.updateGuide.mutate(e),this.updateUserSettings=async(e,t)=>r.du.user.updateSettings.mutate(e,{signal:t}),this.resetUserSettings=async()=>r.du.user.resetSettings.mutate()}}let n=new i},61520:(e,t,a)=>{a.d(t,{P:()=>d,f:()=>l});var r=a(74551),i=a(96987),n=a(96773);let s=r.Se,o=e=>n.S4?e.isSignedIn?e.user?.username:"anonymous":r.xl?e.user?.username:s,l={displayUserName:e=>o(e)||e.user?.email||"",email:e=>e.user?.email||"",fullName:e=>e.user?.fullName||"",nickName:e=>{let t=e.user?.fullName||e.user?.username;return n.S4?e.isSignedIn?t:(0,i.t)("userPanel.anonymousNickName",{ns:"common"}):r.xl?t:(0,i.t)("userPanel.defaultNickname",{ns:"common"})},userAvatar:e=>e.user?.avatar||"",userId:e=>e.user?.id,userProfile:e=>e.user,username:o},d={isLoaded:e=>e.isLoaded,isLogin:e=>!n.S4||e.isSignedIn,isLoginWithAuth:e=>e.isSignedIn,isLoginWithClerk:e=>e.isSignedIn&&n.Nd||!1,isLoginWithNextAuth:e=>e.isSignedIn&&!!n.J_||!1}},63874:(e,t,a)=>{a.d(t,{A:()=>O});var r=a(28802),i=a(43588),n=a(69033),s=a(59202),o=a(83034),l=a(59121),d=a(96773),u=a(49935),c=a(42550),g=a(92912),m=a(49615),p=a(49683),f=a(38759),h=a(25040),S=a(83395);let v=(0,o.memo)(({size:e=40,compressSize:t=256,...a})=>{let i,n=(0,f.k)(e=>e.updateAvatar),[s,l]=o.useState(!1),d=(0,o.useCallback)((i=async e=>{try{l(!0);let a=new Image;a.src=e,await new Promise((e,t)=>{a.addEventListener("load",e),a.addEventListener("error",t)});let r=(0,h.U)({img:a,size:t});await n(r),l(!1)}catch(e){console.error("Failed to upload avatar:",e),l(!1),p.fetchErrorNotification.error({errorMessage:e instanceof Error?e.message:String(e),status:500})}},e=>{let t=new FileReader;t.readAsDataURL(e),t.addEventListener("load",()=>{i(String(t.result))})}),[t,n]);return(0,r.Y)(g.A,{indicator:(0,r.Y)(c.A,{spin:!0}),spinning:s,children:(0,r.Y)(m.A,{beforeUpload:d,itemRender:()=>void 0,maxCount:1,children:(0,r.Y)(S.A,{clickable:!0,size:e,...a})})})});var A=a(61520),y=a(54645),b=a(9274),w=a(20659),U=a(58751),k=a(4902),N=a(80457),P=a(29914),C=a(44268),I=a(46265),x=a(55582);let{Item:Y}=y.A,E={textTransform:"capitalize"},L=(0,o.memo)(()=>{let[e]=(0,f.k)(e=>[A.f.userProfile(e)]),{t}=(0,l.Bd)("auth"),[a,i]=(0,o.useState)(!1),[n,s]=(0,o.useState)(null),{data:d,isLoading:u,mutate:c}=(0,I.Ju)("profile-sso-providers",async()=>{let e=await x.W.getUserSSOProviders();return i(e?.length>1),e}),g=async(a,i)=>{d?.length!==1&&d?P.yl.confirm({content:t("profile.sso.unlink.description",{email:e?.email||"None",provider:a,providerAccountId:i}),okButtonProps:{danger:!0},onOk:async()=>{await x.W.unlinkSSOProvider(a,i),c()},title:(0,r.Y)("span",{style:E,children:t("profile.sso.unlink.title",{provider:a})})}):P.Ew.error({message:t("profile.sso.unlink.forbidden")})};return u?(0,r.FD)(N.Flexbox,{align:"center",gap:4,horizontal:!0,children:[(0,r.Y)(b.A,{icon:U.A,spin:!0}),t("profile.sso.loading")]}):(0,r.Y)(N.Flexbox,{children:d?.map((e,t)=>(0,r.Y)(Y,{actions:(0,r.FD)(N.Flexbox,{gap:4,horizontal:!0,children:[(0,r.Y)(w.A,{content:e.providerAccountId,size:"small"}),(0,r.Y)(b.A,{disabled:!a,icon:k.A,onClick:()=>g(e.provider,e.providerAccountId),size:"small"})]}),avatar:(0,C.A)(e.provider),date:e.expires_at,description:e.providerAccountId,onMouseEnter:()=>s(t),onMouseLeave:()=>s(null),showAction:n===t,title:(0,r.Y)("span",{style:E,children:e.provider})},[e.provider,e.providerAccountId].join("-")))})}),O=(0,o.memo)(({mobile:e})=>{let[t,a]=(0,f.k)(e=>[A.P.isLoginWithNextAuth(e),A.P.isLogin(e)]),[o,c,g,m]=(0,f.k)(e=>[A.f.nickName(e),A.f.username(e),A.f.userProfile(e),!e.isLoaded]),[p]=i.Ay.useForm(),{t:h}=(0,l.Bd)("auth");if(m)return(0,r.Y)(s.A,{active:!0,paragraph:{rows:6},style:{padding:e?16:void 0},title:!1});let y={children:[{children:d.S4&&!a?(0,r.Y)(S.A,{}):(0,r.Y)(v,{}),label:h("profile.avatar"),layout:"horizontal",minWidth:void 0},{children:(0,r.Y)(n.A,{disabled:!0}),label:h("profile.username"),name:"username"},{children:(0,r.Y)(n.A,{disabled:!0}),hidden:!t||!g?.email,label:h("profile.email"),name:"email"},{children:(0,r.Y)(L,{}),hidden:!t,label:h("profile.sso.providers"),layout:"vertical",minWidth:void 0}],title:h("tab.profile")};return(0,r.Y)(i.Ay,{form:p,initialValues:{email:g?.email||"--",username:o||c},items:[y],itemsType:"group",variant:"borderless",...u.pC})})},71457:(e,t,a)=>{a.d(t,{U:()=>i});var r=a(74551);let i={hideSettingsMoveGuide:e=>e.preference.guide?.moveSettingsToAvatar,hideSyncAlert:e=>e.preference.hideSyncAlert,isPreferenceInit:e=>e.isUserStateInit,shouldTriggerFileInKnowledgeBaseTip:e=>"boolean"!=typeof e.preference.guide?.moveSettingsToAvatar,showUploadFileInKnowledgeBaseTip:e=>e.preference.guide?.uploadFileInKnowledgeBase,topicDisplayMode:e=>e.preference.topicDisplayMode||r.I4.topicDisplayMode,useCmdEnterToSend:e=>e.preference.useCmdEnterToSend||!1,userAllowTrace:e=>e.preference.telemetry}},83395:(e,t,a)=>{a.d(t,{A:()=>h});var r=a(28802),i=a(67072),n=a(11577),s=a(83034),o=a(98724),l=a(99278),d=a(64861),u=a(64694),c=a(43262),g=a(38759),m=a(61520);let p=(0,n.rU)(({css:e,token:t})=>({clickable:e`
    position: relative;
    transition: all 200ms ease-out 0s;

    &::before {
      content: '';

      position: absolute;
      transform: skewX(-45deg) translateX(-400%);

      overflow: hidden;

      box-sizing: border-box;
      width: 25%;
      height: 100%;

      background: rgba(255, 255, 255, 50%);

      transition: all 200ms ease-out 0s;
    }

    &:hover {
      box-shadow: 0 0 0 2px ${t.colorPrimary};

      &::before {
        transform: skewX(-45deg) translateX(400%);
      }
    }
  `})),f=(0,s.forwardRef)(({size:e=40,background:t,clickable:a,className:n,style:f,...h},S)=>{let{styles:v,cx:A}=p(),[y,b]=(0,g.k)(e=>[m.f.userAvatar(e),m.f.username(e)]),w=(0,g.k)(m.P.isLogin),U=(0,u.p)(c.C.remoteServerUrl),k=(0,s.useMemo)(()=>w&&y?d.xl&&y.startsWith("/")&&U?U+y:y:l.CB,[w,y,U]);return(0,r.Y)(i.A,{alt:w&&b?b:o.Se,avatar:k,background:w&&y?t:"transparent",className:A(a&&v.clickable,n),ref:S,size:e,style:{flex:"none",...f},unoptimized:!0,...h})});f.displayName="UserAvatar";let h=f},85004:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var r=a(28802),i=a(59202),n=a(33375),s=a(83034),o=a(96773),l=a(63874);let d=(0,n.default)(()=>Promise.all([a.e(95518),a.e(33792)]).then(a.bind(a,76583)),{loadableGenerated:{webpack:()=>[76583]},loading:()=>(0,r.Y)("div",{style:{flex:1},children:(0,r.Y)(i.A,{paragraph:{rows:8},title:!1})})}),u=(0,s.memo)(()=>o.Nd?(0,r.Y)(d,{mobile:!0}):(0,r.Y)(l.A,{mobile:!0}));u.displayName="MobileProfileHomePage";let c=u}}]);