"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[24308],{11441:(e,o,t)=>{t.d(o,{A:()=>d});var l=t(28802),r=t(67072),a=t(11577),n=t(83034),i=t(20480),s=t(80457);let c=(0,a.rU)(({css:e,token:o})=>({container:e`
    border: 1px solid ${o.colorSplit};
    border-radius: 8px;
    color: ${o.colorText};
    background: ${o.colorBgContainer};
  `,desc:e`
    color: ${o.colorTextTertiary};
    text-align: center;
  `,form:e`
    width: 100%;
    max-width: 300px;
  `})),d=(0,n.memo)(({children:e,background:o,title:t,description:a,avatar:n,animation:d,className:u,gap:h=16,...m})=>{let{cx:p,styles:w,theme:f}=c();return(0,l.FD)(i.default,{className:p(w.form,u),gap:h,...m,children:[(0,l.Y)(r.A,{animation:d,avatar:n,background:o??f.colorFillContent,gap:12,size:80}),(0,l.FD)(s.Flexbox,{gap:8,width:"100%",children:[(0,l.Y)(s.Flexbox,{style:{fontSize:18,fontWeight:"bold",textAlign:"center"},children:t}),(0,l.Y)(s.Flexbox,{className:w.desc,children:a})]}),e]})})},24308:(e,o,t)=>{t.r(o),t.d(o,{default:()=>g});var l=t(28802),r=t(1596),a=t(69033),n=t(80122),i=t(15447),s=t(97721),c=t(11577),d=t(83034),u=t(59121),h=t(20480),m=t(80457),p=t(11441),w=t(46265),f=t(91416),b=t(9402);let g=(0,d.memo)(({model:e,onSuccessDownload:o,extraAction:t})=>{let{t:g}=(0,u.Bd)(["modelProvider","error"]),[x,y]=(0,d.useState)(e),[C,k]=(0,d.useState)(0),[S,F]=(0,d.useState)(0),{remainingTime:D,downloadSpeed:v}=((e,o)=>{let[t,l]=(0,d.useState)("0 KB/s"),[r,a]=(0,d.useState)("-"),n=(0,d.useRef)(o),i=(0,d.useRef)(Date.now());return(0,d.useEffect)(()=>{let t=Date.now(),r=(t-i.current)/1e3;if(o>0&&r>1){let s=Math.max(0,(o-n.current)/r);l((0,b.DB)(s));let c=e-o;a((0,b.fU)(c/s)),n.current=o,i.current=t}},[o]),{downloadSpeed:t,remainingTime:r}})(S,C),A=(0,d.useMemo)(()=>S?Number((C/S*100).toFixed(1)):0,[C,S]),P=(0,c.DP)(),_=(0,d.useCallback)(e=>{e.completed&&k(e.completed),e.total&&F(e.total)},[]),{mutate:T,isValidating:Y,error:M}=(0,w.Cf)([x],async([e])=>(await f.modelsService.downloadModel({model:e,provider:"ollama"},{onProgress:_}),!0),{onSuccess:o});return(0,l.FD)(h.default,{gap:16,paddingBlock:32,style:{width:"100%"},children:[(0,l.Y)(p.A,{avatar:(0,l.Y)(r.A,{color:P.colorPrimary,size:64}),description:g(Y?"ollama.download.desc":"ollama.unlock.description"),title:Y?g("ollama.download.title",{model:x}):g("ollama.unlock.title"),children:!Y&&(0,l.Y)(a.A,{onChange:e=>{y(e.target.value)},value:x})}),Y&&(0,l.FD)(m.Flexbox,{flex:1,gap:8,style:{maxWidth:300},width:"100%",children:[(0,l.Y)(s.A,{percent:A,showInfo:!0,strokeColor:P.colorSuccess,trailColor:P.colorSuccessBg}),(0,l.FD)(m.Flexbox,{distribution:"space-between",horizontal:!0,style:{color:P.colorTextDescription,fontSize:12},children:[(0,l.FD)("span",{children:[g("ollama.download.remainingTime"),": ",D]}),(0,l.FD)("span",{children:[g("ollama.download.speed"),": ",v]})]})]}),(0,l.FD)(m.Flexbox,{gap:12,style:{maxWidth:300},width:"100%",children:[M?.message&&(0,l.Y)(n.A,{closable:!0,description:M.message,message:g("ollama.download.failed"),showIcon:!1,type:"error"}),(0,l.Y)(i.A,{block:!0,loading:Y,onClick:()=>{T()},style:{marginTop:8},type:"primary",children:Y?S?g("ollama.unlock.downloaded",{completed:(0,b.Xq)(C,2),total:(0,b.Xq)(S,2)}):g("ollama.unlock.starting"):g("ollama.unlock.confirm")}),Y?(0,l.Y)(i.A,{onClick:()=>{f.modelsService.abortPull()},children:g("ollama.unlock.cancel")}):t]})]})})},91416:(e,o,t)=>{t.d(o,{modelsService:()=>h});var l=t(79998),r=t(64752),a=t(47260),n=t(94147),i=t(32308),s=t(28557),c=t(50949);let d=e=>a.w.isProviderFetchOnClient(e)((0,n.l)());class u{constructor(){this._abortController=null,this.getModels=async e=>{let o=await (0,r.createHeaderWithAuth)({headers:{"Content-Type":"application/json"},provider:e}),t=(0,c.u4)(e);try{if(d(e))return(await (0,s.H)({provider:e,runtimeProvider:t})).models();let l=await fetch(i.Sn.models(t),{headers:o});if(!l.ok)return;return l.json()}catch{return}},this.downloadModel=async({model:e,provider:o},{onProgress:t}={})=>{try{let a;this._abortController=new AbortController;let n=this._abortController.signal,u=await (0,r.createHeaderWithAuth)({headers:{"Content-Type":"application/json"},provider:o}),h=(0,c.u4)(o),m=d(o);if(console.log("enableFetchOnClientï¼š",m),m){let t=await (0,s.H)({provider:o,runtimeProvider:h});a=await t.pullModel({model:e},{signal:n})}else a=await fetch(i.Sn.modelPull(h),{body:JSON.stringify({model:e}),headers:u,method:"POST",signal:n});if(!a.ok)throw await (0,l.EB)(a);a.body&&await this.processModelPullStream(a,{onProgress:t})}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;throw console.error("download model error:",e),e}finally{this._abortController=null}},this.abortPull=()=>{this._abortController&&(this._abortController.abort(),this._abortController=null)},this.processModelPullStream=async(e,{onProgress:o,onError:t})=>{let l=e.body?.getReader();if(l)for(;;){let{done:e,value:r}=await l.read();if(e)break;for(let e of new TextDecoder().decode(r).trim().split("\n")){let l;try{l=JSON.parse(e)}catch(o){console.error("Error parsing progress update:",o),console.error("raw data",e)}if("canceled"===l.status&&console.log("progress:",l),"error"===l.status)throw t?.({message:l.error}),Error(l.error);(void 0!==l.completed||l.status)&&o?.(l)}}}}}let h=new u}}]);