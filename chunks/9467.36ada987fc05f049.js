"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9467],{9467:(e,t,a)=>{a.d(t,{getUserStoreState:()=>s.c});var s=a(38759)},38759:(e,t,a)=>{a.d(t,{c:()=>_,k:()=>W});var s=a(14308),r=a(50786),n=a(23993),i=a(41734),u=a(89872);let l={preference:u.I},o={...{defaultSettings:a(74551).a$,settings:{}},...l,...{},...{isOnboard:!1,isShowPWAGuide:!1,isUserCanEnableTrace:!1,isUserHasConversation:!1,isUserStateInit:!1}};var d=a(96773),c=a(70674),g=a(64911),S=a(85366),p=a(46265),f=a(55582),h=a(67095),m=a(61497),y=a(71457);let U=(0,m.K)("common"),v="initUserState",w=(0,m.K)("preference");var A=a(31021),b=a.n(A),I=a(19530),N=a(45628);class P{constructor(){this.createShareSettingsUrl=e=>`/?${N.N}=${encodeURI(JSON.stringify(e))}`,this.decodeShareSettings=e=>{try{return{data:JSON.parse(e)}}catch(e){return{message:JSON.stringify(e)}}}}}let T=new P;var k=a(34743),O=a(1866),C=a(28074);let E=(0,i.t)("user"),W=(0,n.h)()((0,s.eh)(E((...e)=>({...o,...((e,t)=>({addToolToAllowList:async e=>{let a=t().settings.tool?.humanIntervention?.allowList||[];a.includes(e)||await t().setSettings({tool:{humanIntervention:{allowList:[...a,e]}}})},importAppSettings:async e=>{let{setSettings:a}=t();await a(e)},importUrlShareSettings:async e=>{if(e){let a=T.decodeShareSettings(e);!a?.message&&a?.data&&await t().setSettings(a.data)}},internal_createSignal:()=>{let a=t().updateSettingsSignal;a&&!a.signal.aborted&&a.abort(I.ve);let s=new AbortController;return e({updateSettingsSignal:s},!1,"signalForUpdateSettings"),s},resetSettings:async()=>{await f.W.resetUserSettings(),await t().refreshUserState()},setSettings:async a=>{let s,{settings:r,defaultSettings:n}=t(),i=(0,h.h)(r,a);if(b()(r,i))return;let u=(s=(e,t)=>(0,k.A)(e,(e,a,r)=>{(0,O.A)(a)&&(0,O.A)(t[r])?b()(a,t[r])||(e[r]=a):b()(a,t[r])||(e[r]=(0,C.A)(a)&&(0,C.A)(t[r])?s(a,t[r]):a)}))(i,n);e({settings:u},!1,"optimistic_updateSettings");let l=t().internal_createSignal();await f.W.updateUserSettings(u,l.signal),await t().refreshUserState()},updateDefaultAgent:async e=>{await t().setSettings({defaultAgent:e})},updateGeneralConfig:async e=>{await t().setSettings({general:e})},updateHumanIntervention:async e=>{let a=t().settings.tool?.humanIntervention||{};await t().setSettings({tool:{humanIntervention:{...a,...e}}})},updateKeyVaults:async e=>{await t().setSettings({keyVaults:e})},updateSystemAgent:async(e,a)=>{await t().setSettings({systemAgent:{[e]:{...a}}})}}))(...e),...((e,t)=>({updateGuideState:async e=>{let{updatePreference:a}=t(),s=(0,h.h)(t().preference.guide,e);await a({guide:s})},updateLab:async e=>{let{updatePreference:a}=t(),s=(0,h.h)(t().preference.lab,e);await a({lab:s},w("updateLab"))},updatePreference:async(a,s)=>{let r=(0,h.h)(t().preference,a);e({preference:r},!1,s||w("updatePreference")),await f.W.updatePreference(r)}}))(...e),...((e,t)=>({enableAuth:()=>d.S4,logout:async()=>{if(d.Nd)return void t().clerkSignOut?.({redirectUrl:location.toString()});if(d.J_){let{signOut:e}=await a.e(4975).then(a.bind(a,4975));e()}},openLogin:async()=>{if(d.Nd){let e=location.toString();t().clerkSignIn?.({fallbackRedirectUrl:e,signUpForceRedirectUrl:e,signUpUrl:"/signup"});return}if(d.J_){let{signIn:e}=await a.e(4975).then(a.bind(a,4975)),s=t()?.oAuthSSOProviders;if(s&&1===s.length)return void e(s[0]);e()}}}))(...e),...((e,t)=>({refreshUserState:async()=>{await (0,g.j)(v)},updateAvatar:async e=>{await f.W.updateAvatar(e),await t().refreshUserState()},updateKeyVaultConfig:async(e,a)=>{await t().setSettings({keyVaults:{[e]:a}})},useCheckTrace:e=>(0,S.Ay)(e?"checkTrace":null,()=>"boolean"==typeof y.U.userAllowTrace(t())?Promise.resolve(!1):Promise.resolve(t().isUserCanEnableTrace),{revalidateOnFocus:!1}),useInitUserState:(a,s,r)=>(0,p.Ju)(a?v:null,()=>f.W.getUserState(),{onError:e=>{r?.onError?.(e)},onSuccess:a=>{if(r?.onSuccess?.(a),a){let r={defaultAgent:s.defaultAgent,image:s.image,systemAgent:s.systemAgent},n=(0,h.h)(t().defaultSettings,r),i=0===Object.keys(a.preference||{}).length?u.I:a.preference,l=a.avatar||a.userId?(0,h.h)(t().user,{avatar:a.avatar,email:a.email,firstName:a.firstName,fullName:a.fullName,id:a.userId,latestName:a.lastName,username:a.username}):t().user;e({defaultSettings:n,isOnboard:a.isOnboard,isShowPWAGuide:a.canEnablePWAGuide,isUserCanEnableTrace:a.canEnableTrace,isUserHasConversation:a.hasConversation,isUserStateInit:!0,preference:i,settings:a.settings||{},subscriptionPlan:a.subscriptionPlan,user:l},!1,U("initUserState"));let o=(0,c.wZ)();o?.identify(a.userId||"",{email:a.email,firstName:a.firstName,lastName:a.lastName,username:a.username})}}})}))(...e)}))),r.x),_=()=>W.getState()},55582:(e,t,a)=>{a.d(t,{W:()=>n});var s=a(77605);class r{constructor(){this.getUserRegistrationDuration=async()=>s.du.user.getUserRegistrationDuration.query(),this.getUserState=async()=>s.du.user.getUserState.query(),this.getUserSSOProviders=async()=>s.du.user.getUserSSOProviders.query(),this.unlinkSSOProvider=async(e,t)=>s.du.user.unlinkSSOProvider.mutate({provider:e,providerAccountId:t}),this.makeUserOnboarded=async()=>s.du.user.makeUserOnboarded.mutate(),this.updateAvatar=async e=>s.du.user.updateAvatar.mutate(e),this.updatePreference=async e=>s.du.user.updatePreference.mutate(e),this.updateGuide=async e=>s.du.user.updateGuide.mutate(e),this.updateUserSettings=async(e,t)=>s.du.user.updateSettings.mutate(e,{signal:t}),this.resetUserSettings=async()=>s.du.user.resetSettings.mutate()}}let n=new r},71457:(e,t,a)=>{a.d(t,{U:()=>r});var s=a(74551);let r={hideSettingsMoveGuide:e=>e.preference.guide?.moveSettingsToAvatar,hideSyncAlert:e=>e.preference.hideSyncAlert,isPreferenceInit:e=>e.isUserStateInit,shouldTriggerFileInKnowledgeBaseTip:e=>"boolean"!=typeof e.preference.guide?.moveSettingsToAvatar,showUploadFileInKnowledgeBaseTip:e=>e.preference.guide?.uploadFileInKnowledgeBase,topicDisplayMode:e=>e.preference.topicDisplayMode||s.I4.topicDisplayMode,useCmdEnterToSend:e=>e.preference.useCmdEnterToSend||!1,userAllowTrace:e=>e.preference.telemetry}}}]);