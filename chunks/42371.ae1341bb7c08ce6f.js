"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42371],{5750:(e,i,t)=>{t.d(i,{F:()=>o});var r=t(77605);class a{constructor(){this.createAiProvider=async e=>r.du.aiProvider.createAiProvider.mutate(e),this.getAiProviderList=async()=>r.du.aiProvider.getAiProviderList.query(),this.getAiProviderById=async e=>r.du.aiProvider.getAiProviderById.query({id:e}),this.toggleProviderEnabled=async(e,i)=>r.du.aiProvider.toggleProviderEnabled.mutate({enabled:i,id:e}),this.updateAiProvider=async(e,i)=>r.du.aiProvider.updateAiProvider.mutate({id:e,value:i}),this.updateAiProviderConfig=async(e,i)=>r.du.aiProvider.updateAiProviderConfig.mutate({id:e,value:i}),this.updateAiProviderOrder=async e=>r.du.aiProvider.updateAiProviderOrder.mutate({sortMap:e}),this.deleteAiProvider=async e=>r.du.aiProvider.removeAiProvider.mutate({id:e}),this.getAiProviderRuntimeState=async e=>r.du.aiProvider.getAiProviderRuntimeState.query({isLogin:e})}}let o=new a},27809:(e,i,t)=>{t.d(i,{P:()=>r});let r=async(e,i,t=!0)=>{try{let t=await fetch(e,{cache:"no-store",credentials:"omit",mode:"cors"});if(!t.ok)throw Error(`Failed to fetch image: ${t.status} ${t.statusText}`);let r=await t.blob(),a=window.URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=i,o.style.display="none",document.body.append(o),o.click(),o.remove(),window.URL.revokeObjectURL(a)}catch(i){if(console.log("Download failed:",i),t)window.open(e);else throw i}}},32901:(e,i,t)=>{t.d(i,{Om:()=>m,SU:()=>a,qp:()=>n,PE:()=>s.P,HP:()=>l,Vz:()=>c,rX:()=>P,pU:()=>h});class r{getKeyStore(e){let i=this._cache.get(e);if(!i){let t=e.split(",").map(e=>e.trim()).filter(e=>!!e);i={index:0,keyLen:t.length,keys:t},this._cache.set(e,i)}return i}pick(e=""){if(!e)return;let i=this.getKeyStore(e),t=0;return"turn"===this._mode&&(t=i.index++%i.keyLen),"random"===this._mode&&(t=Math.floor(Math.random()*i.keyLen)),i.keys[t]}constructor(){this._cache=new Map,this._mode="random"}}let a=new r,o=e=>{let i=new Image;i.addEventListener("load",function(){let e=document.createElement("canvas");e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0);try{e.toBlob(function(e){let i=new ClipboardItem({"image/png":e});navigator.clipboard.write([i]).then(function(){console.log("Image copied to clipboard successfully using canvas and modern API")})})}catch{let i=e.toDataURL("image/png"),t=document.createElement("textarea");t.value=i,document.body.append(t),t.select(),document.execCommand("copy"),t.remove()}}),i.src=e},d=async e=>{try{let i=await fetch(e),t=await i.blob(),r=new ClipboardItem({"image/png":t});await navigator.clipboard.write([r])}catch(i){console.error("Failed to copy image using modern API:",i),o(e)}},n=async e=>{navigator.clipboard&&"write"in navigator.clipboard?await d(e):o(e)};var s=t(27809);let l=(e,i)=>{let t=new Blob([e],{type:"plain/text"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=i||"file.txt",document.body.append(a),a.click(),URL.revokeObjectURL(r),a.remove()},c=(e,i)=>{let t=new Blob([JSON.stringify(e)],{type:"application/json"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download=i,document.body.append(a),a.click(),URL.revokeObjectURL(r),a.remove()};var u=t(38759),g=t(61520),v=t(46322);let m={date:()=>new Date().toLocaleDateString(),datetime:()=>new Date().toLocaleString(),day:()=>new Date().getDate().toString().padStart(2,"0"),hour:()=>new Date().getHours().toString().padStart(2,"0"),iso:()=>new Date().toISOString(),locale:()=>Intl.DateTimeFormat().resolvedOptions().locale,minute:()=>new Date().getMinutes().toString().padStart(2,"0"),month:()=>(new Date().getMonth()+1).toString().padStart(2,"0"),second:()=>new Date().getSeconds().toString().padStart(2,"0"),time:()=>new Date().toLocaleTimeString(),timestamp:()=>Date.now().toString(),timezone:()=>Intl.DateTimeFormat().resolvedOptions().timeZone,weekday:()=>new Date().toLocaleDateString("en-US",{weekday:"long"}),year:()=>new Date().getFullYear().toString(),email:()=>g.f.email(u.k.getState())??"",nickname:()=>g.f.nickName(u.k.getState())??"",username:()=>g.f.displayUserName(u.k.getState())??g.f.fullName(u.k.getState())??"",random:()=>Math.floor(1e6*Math.random()+1).toString(),random_bool:()=>Math.random()>.5?"true":"false",random_float:()=>(100*Math.random()).toFixed(2),random_hex:()=>Math.floor(0xffffff*Math.random()).toString(16).padStart(6,"0"),random_int:()=>Math.floor(100*Math.random()+1).toString(),random_string:()=>Math.random().toString(36).slice(2,15),random_digit:()=>Math.floor(10*Math.random()).toString(),uuid:()=>(0,v.uR)(),uuid_short:()=>(0,v.uR)().split("-")[0],language:()=>"undefined"!=typeof navigator?navigator.language:"",platform:()=>"undefined"!=typeof navigator?navigator.platform:"",user_agent:()=>"undefined"!=typeof navigator?navigator.userAgent:""};var p=t(83663);let P=e=>p.A.sanitize(e,{FORBID_ATTR:["onblur","onchange","onclick","onerror","onfocus","onkeydown","onkeypress","onkeyup","onload","onmousedown","onmouseout","onmouseover","onmouseup","onreset","onselect","onsubmit","onunload"],FORBID_TAGS:["embed","link","object","script","style"],KEEP_CONTENT:!1,USE_PROFILES:{svg:!0,svgFilters:!0}});var A=t(9402);let h=e=>{if(!e.type.startsWith("video/"))return{isValid:!0};let i=e.size<=0x1400000;return{actualSize:(0,A.Xq)(e.size),isValid:i}}},42897:(e,i,t)=>{t.d(i,{fe:()=>o,w0:()=>n});var r=t(74551),a=t(67095);let o=e=>(0,a.h)(e.defaultSettings,e.settings),d=e=>(0,a.h)(r.kz,o(e).defaultAgent),n={currentImageSettings:e=>o(e).image,currentSettings:o,currentSystemAgent:e=>(0,a.h)(r.fw,o(e).systemAgent),currentTTS:e=>(0,a.h)(r.Ff,o(e).tts),defaultAgent:d,defaultAgentConfig:e=>(0,a.h)(r.HA,d(e).config),defaultAgentMeta:e=>(0,a.h)(r.M3,d(e).meta),exportSettings:o,getHotkeyById:e=>i=>(0,a.h)(r.Ke,o(i).hotkey)[e],providerConfig:e=>i=>(o(i).languageModel||{})[e]}},45282:(e,i,t)=>{t.d(i,{t:()=>o});var r=t(42897);let a=e=>(0,r.fe)(e).keyVaults||{},o={getVaultByProvider:e=>i=>a(i)[e]||{},keyVaultsSettings:a,password:e=>a(e).password||""}},47260:(e,i,t)=>{t.d(i,{w:()=>l});var r=t(67400);let a=e=>e.aiProviderList.filter(e=>e.enabled).sort((e,i)=>e.sort-i.sort),o=e=>e.aiProviderDetail,d=new Set(["ollama","lmstudio"]),n=e=>o(e)?.keyVaults,s=e=>i=>{if(e)return i.aiProviderRuntimeConfig?.[e]},l={activeProviderConfig:o,disabledAiProviderList:e=>e.aiProviderList.filter(e=>!e.enabled),enabledAiProviderList:a,enabledImageModelList:e=>e.enabledImageModelList||[],isActiveProviderApiKeyNotEmpty:e=>{let i=n(e);return!!i?.apiKey||!!i?.accessKeyId||!!i?.secretAccessKey},isActiveProviderEndpointNotEmpty:e=>{let i=n(e);return!!i?.baseURL||!!i?.endpoint},isAiProviderConfigLoading:e=>i=>i.activeAiProvider!==e,isInitAiProviderRuntimeState:e=>!!e.isInitAiProviderRuntimeState,isProviderConfigUpdating:e=>i=>i.aiProviderConfigUpdatingIds.includes(e),isProviderEnableResponseApi:e=>i=>{let t=s(e)(i),r=t?.config?.enableResponseApi;return"boolean"==typeof r?r:"openai"===e},isProviderEnabled:e=>i=>a(i).some(i=>i.id===e),isProviderFetchOnClient:e=>i=>{let t=s(e)(i);if((0,r.isProviderDisableBrowserRequest)(e))return!1;if(d.has(e)&&void 0!==t?.fetchOnClient)return t?.fetchOnClient;let a=!!t?.keyVaults.baseURL,o=!!t?.keyVaults.apiKey;return(!!a||!!o)&&(!!a&&!o||void 0!==t?.fetchOnClient&&t?.fetchOnClient)},isProviderHasBuiltinSearch:e=>i=>{let t=s(e)(i);return!!t?.settings.searchMode},isProviderHasBuiltinSearchConfig:e=>i=>{let t=s(e)(i);return!!t?.settings.searchMode&&t?.settings.searchMode!=="internal"},isProviderLoading:e=>i=>i.aiProviderLoadingIds.includes(e),providerConfigById:s,providerKeyVaults:e=>i=>{if(e)return i.aiProviderRuntimeConfig?.[e]?.keyVaults}}},50949:(e,i,t)=>{t.d(i,{J3:()=>s,a9:()=>l,oT:()=>n,u4:()=>u,w9:()=>c});var r=t(80286),a=t(94147),o=t(81196),d=t(47260);let n=(e,i)=>o.g.isModelSupportVision(e,i)((0,a.l)()),s=(e,i)=>o.g.isModelSupportVideo(e,i)((0,a.l)())||!1,l=(e,i)=>{let t=e,r=(0,a.l)().enabledAiModels?.find(t=>t.id===e&&t.providerId===i);return r&&r.config?.deploymentName&&(t=r.config?.deploymentName),t},c=e=>d.w.isProviderFetchOnClient(e)((0,a.l)()),u=e=>{if(Object.values(r.ModelProvider).includes(e))return e;let i=d.w.providerConfigById(e)((0,a.l)());return i?.settings.sdkType||"openai"}},61520:(e,i,t)=>{t.d(i,{P:()=>l,f:()=>s});var r=t(74551),a=t(96987),o=t(96773);let d=r.Se,n=e=>o.S4?e.isSignedIn?e.user?.username:"anonymous":r.xl?e.user?.username:d,s={displayUserName:e=>n(e)||e.user?.email||"",email:e=>e.user?.email||"",fullName:e=>e.user?.fullName||"",nickName:e=>{let i=e.user?.fullName||e.user?.username;return o.S4?e.isSignedIn?i:(0,a.t)("userPanel.anonymousNickName",{ns:"common"}):r.xl?i:(0,a.t)("userPanel.defaultNickname",{ns:"common"})},userAvatar:e=>e.user?.avatar||"",userId:e=>e.user?.id,userProfile:e=>e.user,username:n},l={isLoaded:e=>e.isLoaded,isLogin:e=>!o.S4||e.isSignedIn,isLoginWithAuth:e=>e.isSignedIn,isLoginWithClerk:e=>e.isSignedIn&&o.Nd||!1,isLoginWithNextAuth:e=>e.isSignedIn&&!!o.J_||!1}},64752:(e,i,t)=>{t.d(i,{createHeaderWithAuth:()=>A,ZE:()=>p,q9:()=>P});var r=t(74551),a=t(32901),o=t(80286),d=t(47260),n=t(94147),s=t(38759),l=t(45282),c=t(61520),u=t(96773);let g=e=>new TextEncoder().encode(e),v=e=>btoa(String.fromCharCode(...((e,i)=>{let t=new Uint8Array(e.length);for(let[r,a]of e.entries())t[r]=a^i[r%i.length];return t})(g(JSON.stringify(e)),g(u.RX))));var m=t(50949);let p=e=>{let i=d.w.providerKeyVaults(e)(n.d.getState())||{},t=(0,m.u4)(e);return{...((e,i)=>{switch(e){case o.ModelProvider.Bedrock:{let{accessKeyId:e,region:t,secretAccessKey:r,sessionToken:a}=i;return{accessKeyId:e,accessKeySecret:r,apiKey:(r||"")+(e||""),awsAccessKeyId:e,awsRegion:t,awsSecretAccessKey:r,awsSessionToken:a,region:t,sessionToken:a}}case o.ModelProvider.Azure:return{apiKey:a.SU.pick(i.apiKey),apiVersion:i.apiVersion,azureApiVersion:i.apiVersion,baseURL:i.baseURL||i.endpoint};case o.ModelProvider.Ollama:return{baseURL:i?.baseURL};case o.ModelProvider.Cloudflare:return{apiKey:a.SU.pick(i?.apiKey),baseURLOrAccountID:i?.baseURLOrAccountID,cloudflareBaseURLOrAccountID:i?.baseURLOrAccountID};case o.ModelProvider.ComfyUI:return{apiKey:i?.apiKey,authType:i?.authType,baseURL:i?.baseURL,customHeaders:i?.customHeaders,password:i?.password,username:i?.username};case o.ModelProvider.VertexAI:return{apiKey:i?.apiKey,baseURL:i?.baseURL,vertexAIRegion:i?.region};default:return{apiKey:a.SU.pick(i?.apiKey),baseURL:i?.baseURL}}})(t,i),runtimeProvider:t}},P=e=>v(p(e)),A=async e=>{let i=e?.payload||{};e?.provider&&(i={...i,...p(e?.provider)});let t=((e={})=>v({accessCode:l.t.password(s.k.getState()),userId:c.f.userId(s.k.getState()),...e}))(i);return{...e?.headers,[r.Zk]:t}}},81196:(e,i,t)=>{t.d(i,{g:()=>c});var r=t(80286),a=t(88573);let o=e=>e.aiProviderModelList.filter(e=>e.enabled),d=e=>e.aiProviderModelList.length,n=(e,i)=>t=>t.enabledAiModels?.find(t=>t.id===e&&(!i||i===t.providerId)),s=(e,i)=>t=>{let r=n(e,i)(t);return r?.settings?.extendParams},l=(e,i)=>t=>{let r=n(e,i)(t);return r?.settings?.searchImpl},c={aiProviderChatModelListIds:e=>e.aiProviderModelList.filter(e=>"chat"===e.type).map(e=>e.id),disabledAiProviderModelList:e=>e.aiProviderModelList.filter(e=>!e.enabled),enabledAiProviderModelList:o,filteredAiProviderModelList:e=>{let i=e.modelSearchKeyword.toLowerCase().trim();return e.aiProviderModelList.filter(e=>e.id.toLowerCase().includes(i)||e.displayName?.toLowerCase().includes(i))},getAiModelById:e=>i=>i.aiProviderModelList.find(i=>i.id===e),getEnabledModelById:n,getModelCard:(e,i)=>t=>t.builtinAiModelList.find(t=>t.id===e&&t.providerId===i),hasRemoteModels:e=>e.aiProviderModelList.some(e=>e.source===r.AiModelSourceEnum.Remote),isEmptyAiProviderModelList:e=>0===d(e),isModelBuiltinSearchInternal:(e,i)=>t=>l(e,i)(t)===a.P.Internal,isModelEnabled:e=>i=>o(i).some(i=>i.id===e),isModelHasBuiltinSearch:(e,i)=>t=>!!l(e,i)(t),isModelHasBuiltinSearchConfig:(e,i)=>t=>{let r=l(e,i)(t);return!!r&&[a.P.Tool,a.P.Params].includes(r)},isModelHasContextWindowToken:(e,i)=>t=>{let r=n(e,i)(t);return"number"==typeof r?.contextWindowTokens},isModelHasExtendParams:(e,i)=>t=>{let r=s(e,i)(t);return!!r&&r.length>0},isModelLoading:e=>i=>i.aiModelLoadingIds.includes(e),isModelSupportFiles:(e,i)=>t=>{let r=n(e,i)(t);return r?.abilities?.files},isModelSupportReasoning:(e,i)=>t=>{let r=n(e,i)(t);return r?.abilities?.reasoning},isModelSupportToolUse:(e,i)=>t=>{let r=n(e,i)(t);return r?.abilities?.functionCall||!1},isModelSupportVideo:(e,i)=>t=>{let r=n(e,i)(t);return r?.abilities?.video},isModelSupportVision:(e,i)=>t=>{let r=n(e,i)(t);return r?.abilities?.vision||!1},modelBuiltinSearchImpl:l,modelContextWindowTokens:(e,i)=>t=>{let r=n(e,i)(t);return r?.contextWindowTokens},modelExtendParams:s,totalAiProviderModelList:d}},94147:(e,i,t)=>{t.d(i,{l:()=>k,d:()=>U});var r,a=t(50786),o=t(23993),d=t(41734);let n={activeProviderModelList:[],aiProviderConfigUpdatingIds:[],aiProviderList:[],aiProviderLoadingIds:[],aiProviderRuntimeConfig:{},initAiProviderList:!1,isInitAiProviderRuntimeState:!1,providerSearchKeyword:"",aiModelLoadingIds:[],aiProviderModelList:[],builtinAiModelList:[],modelSearchKeyword:""};var s=t(31021),l=t.n(s),c=t(64911),u=t(46265),g=t(77605);class v{constructor(){this.createAiModel=async e=>g.du.aiModel.createAiModel.mutate(e),this.getAiProviderModelList=async e=>g.du.aiModel.getAiProviderModelList.query({id:e}),this.getAiModelById=async e=>g.du.aiModel.getAiModelById.query({id:e}),this.toggleModelEnabled=async e=>g.du.aiModel.toggleModelEnabled.mutate(e),this.updateAiModel=async(e,i,t)=>g.du.aiModel.updateAiModel.mutate({id:e,providerId:i,value:t}),this.batchUpdateAiModels=async(e,i)=>g.du.aiModel.batchUpdateAiModels.mutate({id:e,models:i}),this.batchToggleAiModels=async(e,i,t)=>g.du.aiModel.batchToggleAiModels.mutate({enabled:t,id:e,models:i}),this.clearModelsByProvider=async e=>g.du.aiModel.clearModelsByProvider.mutate({providerId:e}),this.clearRemoteModels=async e=>g.du.aiModel.clearRemoteModels.mutate({providerId:e}),this.updateAiModelOrder=async(e,i)=>g.du.aiModel.updateAiModelOrder.mutate({providerId:e,sortMap:i}),this.deleteAiModel=async e=>g.du.aiModel.removeAiModel.mutate(e)}}let m=new v,p="FETCH_AI_PROVIDER_MODELS";var P=t(74551),A=t(16748),h=t(61505),f=t(5750),M=t(38759),y=t(61520),L=t(77186);let w=(e,i)=>async(t,r)=>{let a,o=t.filter(i=>i.providerId===r&&i.type===e);return o.length?(a=await Promise.all(o.map(e=>i(e))),(0,h.A)(a,"id")):[]},I=async e=>{let i=e.parameters?Promise.resolve(e.parameters):(0,A.TS)(e.id,"parameters",e.providerId),t=e.pricing?Promise.resolve(e.pricing):(0,A.TS)(e.id,"pricing",e.providerId),r=(0,A.TS)(e.id,"description",e.providerId),[a,o,d]=await Promise.all([i,t,r]),n=e.parameters??a,{price:s,approximatePrice:l}=(0,A.r7)(o);return{abilities:e.abilities||{},contextWindowTokens:e.contextWindowTokens,displayName:e.displayName??"",id:e.id,...n&&{parameters:n},...d&&{description:d},...o&&{pricing:o},..."number"==typeof l&&{approximatePricePerImage:l},..."number"==typeof s&&{pricePerImage:s}}},b=w("chat",async e=>({abilities:e.abilities||{},contextWindowTokens:e.contextWindowTokens,displayName:e.displayName??"",id:e.id})),S=w("image",I),R=async(e,i,t)=>Promise.all(e.map(async e=>({...e,children:await t(i,e.id),name:e.name||e.id}))),C=async(e,i)=>R(e,i,S),E=async(e,i)=>R(e,i,b);var _=((r=_||{}).fetchAiProviderItem="FETCH_AI_PROVIDER_ITEM",r.fetchAiProviderList="FETCH_AI_PROVIDER",r.fetchAiProviderRuntimeState="FETCH_AI_PROVIDER_RUNTIME_STATE",r);let T=(0,d.t)("aiInfra"),U=(0,o.h)()(T((...e)=>({...n,...((e,i)=>({batchToggleAiModels:async(e,t)=>{let{activeAiProvider:r}=i();r&&(await m.batchToggleAiModels(r,e,t),await i().refreshAiModelList())},batchUpdateAiModels:async e=>{let{activeAiProvider:t}=i();t&&(await m.batchUpdateAiModels(t,e),await i().refreshAiModelList())},clearModelsByProvider:async e=>{await m.clearModelsByProvider(e),await i().refreshAiModelList()},clearRemoteModels:async e=>{await m.clearRemoteModels(e),await i().refreshAiModelList()},createNewAiModel:async e=>{await m.createAiModel(e),await i().refreshAiModelList()},fetchRemoteModelList:async e=>{let{modelsService:r}=await Promise.all([t.e(83663),t.e(85614),t.e(91416)]).then(t.bind(t,91416)),a=await r.getModels(e);a&&(await i().batchUpdateAiModels(a.map(e=>({...e,abilities:{files:e.files,functionCall:e.functionCall,imageOutput:e.imageOutput,reasoning:e.reasoning,search:e.search,video:e.video,vision:e.vision},enabled:e.enabled||!1,source:"remote",type:e.type||"chat"}))),await i().refreshAiModelList())},internal_toggleAiModelLoading:(i,t)=>{e(e=>t?{aiModelLoadingIds:[...e.aiModelLoadingIds,i]}:{aiModelLoadingIds:e.aiModelLoadingIds.filter(e=>e!==i)},!1,"toggleAiModelLoading")},refreshAiModelList:async()=>{await (0,c.j)([p,i().activeAiProvider]),i().refreshAiProviderRuntimeState()},removeAiModel:async(e,t)=>{await m.deleteAiModel({id:e,providerId:t}),await i().refreshAiModelList()},toggleModelEnabled:async e=>{let{activeAiProvider:t}=i();t&&(i().internal_toggleAiModelLoading(e.id,!0),await m.toggleModelEnabled({...e,providerId:t}),await i().refreshAiModelList(),i().internal_toggleAiModelLoading(e.id,!1))},updateAiModelsConfig:async(e,t,r)=>{await m.updateAiModel(e,t,r),await i().refreshAiModelList()},updateAiModelsSort:async(e,t)=>{await m.updateAiModelOrder(e,t),await i().refreshAiModelList()},useFetchAiProviderModels:t=>(0,u.lA)([p,t],([,e])=>m.getAiProviderModelList(e),{onSuccess:r=>{i().isAiModelListInit&&l()(r,i().aiProviderModelList)||e({aiProviderModelList:r,isAiModelListInit:!0},!1,`useFetchAiProviderModels/${t}`)}})}))(...e),...((e,i)=>({createNewAiProvider:async e=>{await f.F.createAiProvider({...e,source:L.Ag.Custom}),await i().refreshAiProviderList()},deleteAiProvider:async e=>{await f.F.deleteAiProvider(e),await i().refreshAiProviderList()},internal_toggleAiProviderConfigUpdating:(i,t)=>{e(e=>t?{aiProviderConfigUpdatingIds:[...e.aiProviderConfigUpdatingIds,i]}:{aiProviderConfigUpdatingIds:e.aiProviderConfigUpdatingIds.filter(e=>e!==i)},!1,"toggleAiProviderLoading")},internal_toggleAiProviderLoading:(i,t)=>{e(e=>t?{aiProviderLoadingIds:[...e.aiProviderLoadingIds,i]}:{aiProviderLoadingIds:e.aiProviderLoadingIds.filter(e=>e!==i)},!1,"toggleAiProviderLoading")},refreshAiProviderDetail:async()=>{await (0,c.j)(["FETCH_AI_PROVIDER_ITEM",i().activeAiProvider]),await i().refreshAiProviderRuntimeState()},refreshAiProviderList:async()=>{await (0,c.j)("FETCH_AI_PROVIDER"),await i().refreshAiProviderRuntimeState()},refreshAiProviderRuntimeState:async()=>{await Promise.all([(0,c.j)(["FETCH_AI_PROVIDER_RUNTIME_STATE",!0]),(0,c.j)(["FETCH_AI_PROVIDER_RUNTIME_STATE",!1])])},removeAiProvider:async e=>{await f.F.deleteAiProvider(e),await i().refreshAiProviderList()},toggleProviderEnabled:async(e,t)=>{i().internal_toggleAiProviderLoading(e,!0),await f.F.toggleProviderEnabled(e,t),await i().refreshAiProviderList(),i().internal_toggleAiProviderLoading(e,!1)},updateAiProvider:async(e,t)=>{i().internal_toggleAiProviderLoading(e,!0),await f.F.updateAiProvider(e,t),await i().refreshAiProviderList(),await i().refreshAiProviderDetail(),i().internal_toggleAiProviderLoading(e,!1)},updateAiProviderConfig:async(e,t)=>{i().internal_toggleAiProviderConfigUpdating(e,!0),await f.F.updateAiProviderConfig(e,t),await i().refreshAiProviderDetail(),i().internal_toggleAiProviderConfigUpdating(e,!1)},updateAiProviderSort:async e=>{await f.F.updateAiProviderOrder(e),await i().refreshAiProviderList()},useFetchAiProviderItem:i=>(0,u.lA)(["FETCH_AI_PROVIDER_ITEM",i],()=>f.F.getAiProviderById(i),{onSuccess:t=>{t&&e({activeAiProvider:i,aiProviderDetail:t},!1,"useFetchAiProviderItem")}}),useFetchAiProviderList:t=>(0,u.lA)(t?.enabled===!1?null:"FETCH_AI_PROVIDER",()=>f.F.getAiProviderList(),{fallbackData:[],onSuccess:t=>{i().initAiProviderList?e({aiProviderList:t},!1,"useFetchAiProviderList/refresh"):e({aiProviderList:t,initAiProviderList:!0},!1,"useFetchAiProviderList/init")}}),useFetchAiProviderRuntimeState:i=>{let r=y.P.isLoaded(M.k.getState())&&null!=i;return(0,u.lA)(r?["FETCH_AI_PROVIDER_RUNTIME_STATE",i]:null,async([,e])=>{let[{LOBE_DEFAULT_MODEL_LIST:i},{DEFAULT_MODEL_PROVIDER_LIST:r}]=await Promise.all([Promise.resolve().then(t.bind(t,80286)),Promise.resolve().then(t.bind(t,67400))]);if(e){let e=await f.F.getAiProviderRuntimeState(),[t,r]=await Promise.all([E(e.enabledChatAiProviders,e.enabledAiModels),C(e.enabledImageAiProviders,e.enabledAiModels)]);return{...e,builtinAiModelList:i,enabledChatModelList:t,enabledImageModelList:r}}let a=r.filter(e=>e.enabled).map(e=>({id:e.id,name:e.name,source:L.Ag.Builtin})),o=a.filter(e=>i.some(i=>i.providerId===e.id&&"chat"===i.type)),d=a.filter(e=>i.some(i=>i.providerId===e.id&&"image"===i.type)).map(e=>({id:e.id,name:e.name,source:L.Ag.Builtin})),n=i.filter(e=>e.enabled),[s,l]=await Promise.all([E(o,n),C(d,n)]);return{builtinAiModelList:i,enabledAiModels:n,enabledAiProviders:a,enabledChatAiProviders:o,enabledChatModelList:s,enabledImageAiProviders:d,enabledImageModelList:l,runtimeConfig:{}}},{focusThrottleInterval:P.xl?100:void 0,onSuccess:i=>{i&&e({aiProviderRuntimeConfig:i.runtimeConfig,builtinAiModelList:i.builtinAiModelList,enabledAiModels:i.enabledAiModels,enabledAiProviders:i.enabledAiProviders,enabledChatModelList:i.enabledChatModelList||[],enabledImageModelList:i.enabledImageModelList||[],isInitAiProviderRuntimeState:!0},!1,"useFetchAiProviderRuntimeState")}})}}))(...e)})),a.x),k=()=>U.getState()}}]);