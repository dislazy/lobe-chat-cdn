"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14343,64694,81187],{14343:(e,t,r)=>{r.d(t,{e2:()=>i,dispatch:()=>o,$l:()=>n,A8:()=>l});let o=async(e,...t)=>{if(!window.electronAPI||!window.electronAPI.invoke)throw Error(`electronAPI.invoke not found. Please expose \`ipcRenderer.invoke\` to \`window.electronAPI.invoke\` in the preload:

import { contextBridge, ipcRenderer } from 'electron';

const invoke = async (event, ...data) =>
  ipcRenderer.invoke(event, ...data);

contextBridge.exposeInMainWorld('electronAPI', { invoke });
`);return window.electronAPI.invoke(e,...t)},s=async e=>{if(e){if("string"==typeof e||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(e instanceof Blob)return await e.arrayBuffer();throw console.warn("不支持的 IPC 代理请求体类型:",typeof e),Error("不支持的 IPC 代理请求体类型")}},n=async(e,t)=>{var r;let o,n=new URL(e.toString(),window.location.origin),a=n.pathname+n.search,i=t?.method?.toUpperCase()||"GET",c=(r=t?.headers,o={},r&&(r instanceof Headers?r.forEach((e,t)=>{o[t]=e}):Array.isArray(r)?r.forEach(([e,t])=>{o[e]=t}):Object.assign(o,r),delete o.host,delete o.connection,delete o["content-length"]),o),l={body:await s(t?.body),headers:c,method:i,urlPath:a};return new Promise((e,t)=>{let r,o=!1,s=new ReadableStream({cancel(){n?.()},start(e){r=e}}),n=window.electronAPI.onStreamInvoke(l,{onData:e=>{r&&r.enqueue(e)},onEnd:()=>{r&&r.close()},onError:e=>{console.error("[streamInvoke] Error during IPC stream proxy call:",e),o?r&&r.error(e):(o=!0,t(e))},onResponse:t=>{o||(o=!0,e(new Response(s,t)))}})})};var a,i=((a={}).Cloud="cloud",a.Local="local",a.SelfHost="selfHost",a),c=r(83034);let l=(e,t)=>{(0,c.useEffect)(()=>{if(!window.electron)return;let r=(e,r)=>{t(r)};return window.electron.ipcRenderer.on(e,r),()=>{window.electron.ipcRenderer.removeListener(e,r)}},[])}},20108:(e,t,r)=>{r.d(t,{f:()=>n});var o=r(50718),s=r(83034);let n=()=>{let[e,t]=(0,s.useState)(!1),[r,n]=(0,s.useState)(!1);(0,s.useEffect)(()=>{n(!0)},[]);let a=(0,o.useSearchParams)();return(0,s.useEffect)(()=>{r&&t("single"===a.get("mode"))},[a,r]),!!r&&e}},37844:(e,t,r)=>{r.d(t,{remoteServerService:()=>n});var o=r(14343);class s{constructor(){this.getRemoteServerConfig=async()=>(0,o.dispatch)("getRemoteServerConfig"),this.setRemoteServerConfig=async e=>(0,o.dispatch)("setRemoteServerConfig",e),this.clearRemoteServerConfig=async()=>(0,o.dispatch)("clearRemoteServerConfig"),this.requestAuthorization=async e=>(0,o.dispatch)("requestAuthorization",e),this.requestMarketAuthorization=async e=>(0,o.dispatch)("requestMarketAuthorization",e)}}let n=new s},50759:(e,t,r)=>{r.d(t,{N:()=>n});let o="__LOBE_GLOBAL_AGENT_CONTEXT__";class s{get context(){return window[o]||(window[o]={}),window[o]}set context(e){window[o]=e}getContext(){return this.context}updateContext(e){this.context={...this.context,...e}}setContext(e){this.context=e}fillTemplate(e){let t=this.getContext();return e?e.replaceAll(/{{([^}]+)}}/g,(e,r)=>{let o=r.trim();return void 0!==t[o]?String(t[o]):"[N/A]"}):""}}let n=new s},64464:(e,t,r)=>{r.d(t,{electronSystemService:()=>n});var o=r(14343);class s{async getAppState(){return(0,o.dispatch)("getDesktopAppState")}async closeWindow(){return(0,o.dispatch)("closeWindow")}async maximizeWindow(){return(0,o.dispatch)("maximizeWindow")}async minimizeWindow(){return(0,o.dispatch)("minimizeWindow")}constructor(){this.showContextMenu=async(e,t)=>(0,o.dispatch)("showContextMenu",{data:t,type:e})}}let n=new s},64694:(e,t,r)=>{r.d(t,{R:()=>k,p:()=>x});var o=r(50786),s=r(23993),n=r(41734),a=r(46265),i=r(64464),c=r(50759),l=r(67095),d=r(31021),h=r.n(d),p=r(64911),y=r(85366),u=r(90396);let S="electron:getProxySettings",g="electron:getDesktopHotkeys";var f=r(37844);let m={appState:{},dataSyncConfig:{storageMode:"local"},desktopHotkeys:{},isAppStateInit:!1,isConnectingServer:!1,isDesktopHotkeysInit:!1,isInitRemoteServerConfig:!1,isSyncActive:!1,proxySettings:{enableProxy:!1,proxyBypass:"localhost, 127.0.0.1, ::1",proxyPort:"",proxyRequireAuth:!1,proxyServer:"",proxyType:"http"}},v="electron:getRemoteServerConfig",w=(0,n.t)("electron"),x=(0,s.h)()(w((...e)=>({...m,...((e,t)=>({connectRemoteServer:async r=>{if("selfHost"!==r.storageMode||r.remoteServerUrl){e({isConnectingServer:!0});try{let o=await f.remoteServerService.getRemoteServerConfig();h()(o,r)||await f.remoteServerService.setRemoteServerConfig({...r,active:!1});let s=await f.remoteServerService.requestAuthorization(r);s.success||(console.error("请求授权失败:",s.error),e({remoteServerSyncError:{message:s.error,type:"AUTH_ERROR"}})),await t().refreshServerConfig()}catch(t){console.error("远程服务器配置出错:",t),e({remoteServerSyncError:{message:t.message,type:"CONFIG_ERROR"}})}finally{e({isConnectingServer:!1})}}},disconnectRemoteServer:async()=>{e({isConnectingServer:!1});try{await f.remoteServerService.setRemoteServerConfig({active:!1,storageMode:"local"}),e({dataSyncConfig:m.dataSyncConfig}),await t().refreshServerConfig()}catch(t){console.error("断开连接失败:",t),e({remoteServerSyncError:{message:t.message,type:"DISCONNECT_ERROR"}})}finally{e({isConnectingServer:!1})}},refreshServerConfig:async()=>{await (0,p.j)(v)},refreshUserData:async()=>{let{getSessionStoreState:e}=await Promise.all([r.e(30173),r.e(6312),r.e(75113),r.e(83663),r.e(85614),r.e(71828),r.e(59440),r.e(96987),r.e(83897),r.e(16748),r.e(72389),r.e(31871),r.e(14946),r.e(64811),r.e(69373)]).then(r.bind(r,55442)),{getChatStoreState:t}=await Promise.all([r.e(30173),r.e(6312),r.e(75113),r.e(83663),r.e(85614),r.e(71828),r.e(59440),r.e(96987),r.e(83897),r.e(16748),r.e(72389),r.e(31871),r.e(14946),r.e(64811),r.e(48501)]).then(r.bind(r,28410)),{getUserStoreState:o}=await Promise.all([r.e(6312),r.e(9467)]).then(r.bind(r,9467));await e().refreshSessions(),await t().refreshMessages(),await t().refreshTopic(),await o().refreshUserState()},useDataSyncConfig:()=>(0,y.Ay)(v,async()=>{try{return await f.remoteServerService.getRemoteServerConfig()}catch(e){throw console.error("获取远程服务器配置失败:",e),e}},{onSuccess:r=>{h()(r,t().dataSyncConfig)||t().refreshUserData(),e({dataSyncConfig:r,isInitRemoteServerConfig:!0})}})}))(...e),...((e,t)=>({updateElectronAppState:r=>{let o=t().appState;e({appState:(0,l.h)(o,r)})},useInitElectronAppState:()=>(0,a.Ju)("initElectronAppState",async()=>i.electronSystemService.getAppState(),{onSuccess:t=>{e({appState:t,isAppStateInit:!0},!1,"initElectronAppState"),c.N.updateContext({desktopPath:t.userPath.desktop,documentsPath:t.userPath.documents,downloadsPath:t.userPath.downloads,homePath:t.userPath.home,musicPath:t.userPath.music,picturesPath:t.userPath.pictures,userDataPath:t.userPath.userData,videosPath:t.userPath.videos})}})}))(...e),...((e,t)=>({refreshDesktopHotkeys:async()=>{await (0,p.j)(g)},refreshProxySettings:async()=>{await (0,p.j)(S)},setProxySettings:async e=>{try{await u.x.setSettings(e),await t().refreshProxySettings()}catch(e){console.error("代理设置更新失败:",e)}},updateDesktopHotkey:async(e,r)=>{try{let o=await u.x.updateDesktopHotkey(e,r);return o.success&&await t().refreshDesktopHotkeys(),o}catch(e){return console.error("桌面热键更新失败:",e),{errorType:"UNKNOWN",success:!1}}},useFetchDesktopHotkeys:()=>(0,y.Ay)(g,async()=>u.x.getDesktopHotkeys(),{onSuccess:r=>{h()(r,t().desktopHotkeys)||e({desktopHotkeys:r,isDesktopHotkeysInit:!0})}}),useGetProxySettings:()=>(0,y.Ay)(S,async()=>u.x.getProxySettings(),{onSuccess:r=>{h()(r,t().proxySettings)||e({proxySettings:r})}})}))(...e)})),o.x),k=()=>x.getState()},83395:(e,t,r)=>{r.d(t,{A:()=>g});var o=r(28802),s=r(67072),n=r(11577),a=r(83034),i=r(98724),c=r(99278),l=r(64861),d=r(64694),h=r(43262),p=r(38759),y=r(61520);let u=(0,n.rU)(({css:e,token:t})=>({clickable:e`
    position: relative;
    transition: all 200ms ease-out 0s;

    &::before {
      content: '';

      position: absolute;
      transform: skewX(-45deg) translateX(-400%);

      overflow: hidden;

      box-sizing: border-box;
      width: 25%;
      height: 100%;

      background: rgba(255, 255, 255, 50%);

      transition: all 200ms ease-out 0s;
    }

    &:hover {
      box-shadow: 0 0 0 2px ${t.colorPrimary};

      &::before {
        transform: skewX(-45deg) translateX(400%);
      }
    }
  `})),S=(0,a.forwardRef)(({size:e=40,background:t,clickable:r,className:n,style:S,...g},f)=>{let{styles:m,cx:v}=u(),[w,x]=(0,p.k)(e=>[y.f.userAvatar(e),y.f.username(e)]),k=(0,p.k)(y.P.isLogin),C=(0,d.p)(h.C.remoteServerUrl),P=(0,a.useMemo)(()=>k&&w?l.xl&&w.startsWith("/")&&C?C+w:w:c.CB,[k,w,C]);return(0,o.Y)(s.A,{alt:k&&x?x:i.Se,avatar:P,background:k&&w?t:"transparent",className:v(r&&m.clickable,n),ref:f,size:e,style:{flex:"none",...S},unoptimized:!0,...g})});S.displayName="UserAvatar";let g=S},90396:(e,t,r)=>{r.d(t,{x:()=>n});var o=r(14343);class s{constructor(){this.getProxySettings=async()=>(0,o.dispatch)("getProxySettings"),this.setSettings=async e=>(0,o.dispatch)("setProxySettings",e),this.getDesktopHotkeys=async()=>(0,o.dispatch)("getShortcutsConfig"),this.updateDesktopHotkey=async(e,t)=>(0,o.dispatch)("updateShortcutConfig",{accelerator:t,id:e}),this.testProxyConnection=async e=>(0,o.dispatch)("testProxyConnection",e),this.testProxyConfig=async(e,t)=>(0,o.dispatch)("testProxyConfig",{config:e,testUrl:t})}}let n=new s},98516:(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});var o=r(28802),s=r(11577),n=r(83034),a=r(80457),i=r(14872),c=r(11345),l=r(31974),d=r(27697);let h=(0,s.rU)(({css:e,token:t})=>({main:e`
    position: relative;
    overflow: hidden;
    background: ${t.colorBgLayout};
  `})),p=(0,n.memo)(()=>{let e=(0,c.e)(),{styles:t}=h();return(0,o.FD)(o.FK,{children:[(0,o.Y)(a.Flexbox,{className:t.main,height:"100%",style:e?{display:"none"}:void 0,width:"100%",children:(0,o.Y)(l.A,{mobile:!0})}),(0,o.Y)(a.Flexbox,{className:t.main,height:"100%",style:e?void 0:{display:"none"},width:"100%",children:(0,o.Y)(d.sv,{})})]})});p.displayName="MobileChatLayout";let y=(0,i.l)(p)}}]);