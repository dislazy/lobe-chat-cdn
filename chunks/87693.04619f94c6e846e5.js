"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[24308,87693],{11441:(e,o,l)=>{l.d(o,{A:()=>d});var t=l(28802),r=l(67072),a=l(11577),n=l(83034),i=l(20480),s=l(80457);let c=(0,a.rU)(({css:e,token:o})=>({container:e`
    border: 1px solid ${o.colorSplit};
    border-radius: 8px;
    color: ${o.colorText};
    background: ${o.colorBgContainer};
  `,desc:e`
    color: ${o.colorTextTertiary};
    text-align: center;
  `,form:e`
    width: 100%;
    max-width: 300px;
  `})),d=(0,n.memo)(({children:e,background:o,title:l,description:a,avatar:n,animation:d,className:u,gap:h=16,...m})=>{let{cx:p,styles:w,theme:f}=c();return(0,t.FD)(i.default,{className:p(w.form,u),gap:h,...m,children:[(0,t.Y)(r.A,{animation:d,avatar:n,background:o??f.colorFillContent,gap:12,size:80}),(0,t.FD)(s.Flexbox,{gap:8,width:"100%",children:[(0,t.Y)(s.Flexbox,{style:{fontSize:18,fontWeight:"bold",textAlign:"center"},children:l}),(0,t.Y)(s.Flexbox,{className:w.desc,children:a})]}),e]})})},24308:(e,o,l)=>{l.r(o),l.d(o,{default:()=>b});var t=l(28802),r=l(1596),a=l(69033),n=l(80122),i=l(15447),s=l(97721),c=l(11577),d=l(83034),u=l(59121),h=l(20480),m=l(80457),p=l(11441),w=l(46265),f=l(91416),g=l(9402);let b=(0,d.memo)(({model:e,onSuccessDownload:o,extraAction:l})=>{let{t:b}=(0,u.Bd)(["modelProvider","error"]),[x,y]=(0,d.useState)(e),[C,k]=(0,d.useState)(0),[S,F]=(0,d.useState)(0),{remainingTime:A,downloadSpeed:D}=((e,o)=>{let[l,t]=(0,d.useState)("0 KB/s"),[r,a]=(0,d.useState)("-"),n=(0,d.useRef)(o),i=(0,d.useRef)(Date.now());return(0,d.useEffect)(()=>{let l=Date.now(),r=(l-i.current)/1e3;if(o>0&&r>1){let s=Math.max(0,(o-n.current)/r);t((0,g.DB)(s));let c=e-o;a((0,g.fU)(c/s)),n.current=o,i.current=l}},[o]),{downloadSpeed:l,remainingTime:r}})(S,C),v=(0,d.useMemo)(()=>S?Number((C/S*100).toFixed(1)):0,[C,S]),Y=(0,c.DP)(),M=(0,d.useCallback)(e=>{e.completed&&k(e.completed),e.total&&F(e.total)},[]),{mutate:P,isValidating:_,error:T}=(0,w.Cf)([x],async([e])=>(await f.modelsService.downloadModel({model:e,provider:"ollama"},{onProgress:M}),!0),{onSuccess:o});return(0,t.FD)(h.default,{gap:16,paddingBlock:32,style:{width:"100%"},children:[(0,t.Y)(p.A,{avatar:(0,t.Y)(r.A,{color:Y.colorPrimary,size:64}),description:b(_?"ollama.download.desc":"ollama.unlock.description"),title:_?b("ollama.download.title",{model:x}):b("ollama.unlock.title"),children:!_&&(0,t.Y)(a.A,{onChange:e=>{y(e.target.value)},value:x})}),_&&(0,t.FD)(m.Flexbox,{flex:1,gap:8,style:{maxWidth:300},width:"100%",children:[(0,t.Y)(s.A,{percent:v,showInfo:!0,strokeColor:Y.colorSuccess,trailColor:Y.colorSuccessBg}),(0,t.FD)(m.Flexbox,{distribution:"space-between",horizontal:!0,style:{color:Y.colorTextDescription,fontSize:12},children:[(0,t.FD)("span",{children:[b("ollama.download.remainingTime"),": ",A]}),(0,t.FD)("span",{children:[b("ollama.download.speed"),": ",D]})]})]}),(0,t.FD)(m.Flexbox,{gap:12,style:{maxWidth:300},width:"100%",children:[T?.message&&(0,t.Y)(n.A,{closable:!0,description:T.message,message:b("ollama.download.failed"),showIcon:!1,type:"error"}),(0,t.Y)(i.A,{block:!0,loading:_,onClick:()=>{P()},style:{marginTop:8},type:"primary",children:_?S?b("ollama.unlock.downloaded",{completed:(0,g.Xq)(C,2),total:(0,g.Xq)(S,2)}):b("ollama.unlock.starting"):b("ollama.unlock.confirm")}),_?(0,t.Y)(i.A,{onClick:()=>{f.modelsService.abortPull()},children:b("ollama.unlock.cancel")}):l]})]})})},87693:(e,o,l)=>{l.r(o),l.d(o,{default:()=>d});var t=l(28802),r=l(15447),a=l(83034),n=l(59121),i=l(24308),s=l(17068),c=l(29052);let d=(0,a.memo)(({id:e,model:o})=>{let{t:l}=(0,n.Bd)("error"),[a,d]=(0,s.L)(e=>[e.delAndRegenerateMessage,e.deleteMessage]);return(0,t.Y)(c.Sf,{children:(0,t.Y)(i.default,{extraAction:(0,t.Y)(r.A,{onClick:()=>{d(e)},children:l("unlock.closeMessage")}),model:o,onSuccessDownload:()=>{a(e)}})})})},91416:(e,o,l)=>{l.d(o,{modelsService:()=>h});var t=l(79998),r=l(64752),a=l(47260),n=l(94147),i=l(32308),s=l(28557),c=l(50949);let d=e=>a.w.isProviderFetchOnClient(e)((0,n.l)());class u{constructor(){this._abortController=null,this.getModels=async e=>{let o=await (0,r.createHeaderWithAuth)({headers:{"Content-Type":"application/json"},provider:e}),l=(0,c.u4)(e);try{if(d(e))return(await (0,s.H)({provider:e,runtimeProvider:l})).models();let t=await fetch(i.Sn.models(l),{headers:o});if(!t.ok)return;return t.json()}catch{return}},this.downloadModel=async({model:e,provider:o},{onProgress:l}={})=>{try{let a;this._abortController=new AbortController;let n=this._abortController.signal,u=await (0,r.createHeaderWithAuth)({headers:{"Content-Type":"application/json"},provider:o}),h=(0,c.u4)(o),m=d(o);if(console.log("enableFetchOnClientï¼š",m),m){let l=await (0,s.H)({provider:o,runtimeProvider:h});a=await l.pullModel({model:e},{signal:n})}else a=await fetch(i.Sn.modelPull(h),{body:JSON.stringify({model:e}),headers:u,method:"POST",signal:n});if(!a.ok)throw await (0,t.EB)(a);a.body&&await this.processModelPullStream(a,{onProgress:l})}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;throw console.error("download model error:",e),e}finally{this._abortController=null}},this.abortPull=()=>{this._abortController&&(this._abortController.abort(),this._abortController=null)},this.processModelPullStream=async(e,{onProgress:o,onError:l})=>{let t=e.body?.getReader();if(t)for(;;){let{done:e,value:r}=await t.read();if(e)break;for(let e of new TextDecoder().decode(r).trim().split("\n")){let t;try{t=JSON.parse(e)}catch(o){console.error("Error parsing progress update:",o),console.error("raw data",e)}if("canceled"===t.status&&console.log("progress:",t),"error"===t.status)throw l?.({message:t.error}),Error(t.error);(void 0!==t.completed||t.status)&&o?.(t)}}}}}let h=new u}}]);