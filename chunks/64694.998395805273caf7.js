"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14343,64694],{14343:(e,t,r)=>{r.d(t,{e2:()=>i,dispatch:()=>o,$l:()=>s,A8:()=>y});let o=async(e,...t)=>{if(!window.electronAPI||!window.electronAPI.invoke)throw Error(`electronAPI.invoke not found. Please expose \`ipcRenderer.invoke\` to \`window.electronAPI.invoke\` in the preload:

import { contextBridge, ipcRenderer } from 'electron';

const invoke = async (event, ...data) =>
  ipcRenderer.invoke(event, ...data);

contextBridge.exposeInMainWorld('electronAPI', { invoke });
`);return window.electronAPI.invoke(e,...t)},n=async e=>{if(e){if("string"==typeof e||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(e instanceof Blob)return await e.arrayBuffer();throw console.warn("不支持的 IPC 代理请求体类型:",typeof e),Error("不支持的 IPC 代理请求体类型")}},s=async(e,t)=>{var r;let o,s=new URL(e.toString(),window.location.origin),a=s.pathname+s.search,i=t?.method?.toUpperCase()||"GET",c=(r=t?.headers,o={},r&&(r instanceof Headers?r.forEach((e,t)=>{o[t]=e}):Array.isArray(r)?r.forEach(([e,t])=>{o[e]=t}):Object.assign(o,r),delete o.host,delete o.connection,delete o["content-length"]),o),y={body:await n(t?.body),headers:c,method:i,urlPath:a};return new Promise((e,t)=>{let r,o=!1,n=new ReadableStream({cancel(){s?.()},start(e){r=e}}),s=window.electronAPI.onStreamInvoke(y,{onData:e=>{r&&r.enqueue(e)},onEnd:()=>{r&&r.close()},onError:e=>{console.error("[streamInvoke] Error during IPC stream proxy call:",e),o?r&&r.error(e):(o=!0,t(e))},onResponse:t=>{o||(o=!0,e(new Response(n,t)))}})})};var a,i=((a={}).Cloud="cloud",a.Local="local",a.SelfHost="selfHost",a),c=r(83034);let y=(e,t)=>{(0,c.useEffect)(()=>{if(!window.electron)return;let r=(e,r)=>{t(r)};return window.electron.ipcRenderer.on(e,r),()=>{window.electron.ipcRenderer.removeListener(e,r)}},[])}},37844:(e,t,r)=>{r.d(t,{remoteServerService:()=>s});var o=r(14343);class n{constructor(){this.getRemoteServerConfig=async()=>(0,o.dispatch)("getRemoteServerConfig"),this.setRemoteServerConfig=async e=>(0,o.dispatch)("setRemoteServerConfig",e),this.clearRemoteServerConfig=async()=>(0,o.dispatch)("clearRemoteServerConfig"),this.requestAuthorization=async e=>(0,o.dispatch)("requestAuthorization",e),this.requestMarketAuthorization=async e=>(0,o.dispatch)("requestMarketAuthorization",e)}}let s=new n},50759:(e,t,r)=>{r.d(t,{N:()=>s});let o="__LOBE_GLOBAL_AGENT_CONTEXT__";class n{get context(){return window[o]||(window[o]={}),window[o]}set context(e){window[o]=e}getContext(){return this.context}updateContext(e){this.context={...this.context,...e}}setContext(e){this.context=e}fillTemplate(e){let t=this.getContext();return e?e.replaceAll(/{{([^}]+)}}/g,(e,r)=>{let o=r.trim();return void 0!==t[o]?String(t[o]):"[N/A]"}):""}}let s=new n},64464:(e,t,r)=>{r.d(t,{electronSystemService:()=>s});var o=r(14343);class n{async getAppState(){return(0,o.dispatch)("getDesktopAppState")}async closeWindow(){return(0,o.dispatch)("closeWindow")}async maximizeWindow(){return(0,o.dispatch)("maximizeWindow")}async minimizeWindow(){return(0,o.dispatch)("minimizeWindow")}constructor(){this.showContextMenu=async(e,t)=>(0,o.dispatch)("showContextMenu",{data:t,type:e})}}let s=new n},64694:(e,t,r)=>{r.d(t,{R:()=>x,p:()=>C});var o=r(50786),n=r(23993),s=r(41734),a=r(46265),i=r(64464),c=r(50759),y=r(67095),l=r(31021),p=r.n(l),h=r(64911),d=r(85366),S=r(90396);let u="electron:getProxySettings",g="electron:getDesktopHotkeys";var f=r(37844);let w={appState:{},dataSyncConfig:{storageMode:"local"},desktopHotkeys:{},isAppStateInit:!1,isConnectingServer:!1,isDesktopHotkeysInit:!1,isInitRemoteServerConfig:!1,isSyncActive:!1,proxySettings:{enableProxy:!1,proxyBypass:"localhost, 127.0.0.1, ::1",proxyPort:"",proxyRequireAuth:!1,proxyServer:"",proxyType:"http"}},v="electron:getRemoteServerConfig",m=(0,s.t)("electron"),C=(0,n.h)()(m((...e)=>({...w,...((e,t)=>({connectRemoteServer:async r=>{if("selfHost"!==r.storageMode||r.remoteServerUrl){e({isConnectingServer:!0});try{let o=await f.remoteServerService.getRemoteServerConfig();p()(o,r)||await f.remoteServerService.setRemoteServerConfig({...r,active:!1});let n=await f.remoteServerService.requestAuthorization(r);n.success||(console.error("请求授权失败:",n.error),e({remoteServerSyncError:{message:n.error,type:"AUTH_ERROR"}})),await t().refreshServerConfig()}catch(t){console.error("远程服务器配置出错:",t),e({remoteServerSyncError:{message:t.message,type:"CONFIG_ERROR"}})}finally{e({isConnectingServer:!1})}}},disconnectRemoteServer:async()=>{e({isConnectingServer:!1});try{await f.remoteServerService.setRemoteServerConfig({active:!1,storageMode:"local"}),e({dataSyncConfig:w.dataSyncConfig}),await t().refreshServerConfig()}catch(t){console.error("断开连接失败:",t),e({remoteServerSyncError:{message:t.message,type:"DISCONNECT_ERROR"}})}finally{e({isConnectingServer:!1})}},refreshServerConfig:async()=>{await (0,h.j)(v)},refreshUserData:async()=>{let{getSessionStoreState:e}=await Promise.all([r.e(30173),r.e(6312),r.e(75113),r.e(83663),r.e(85614),r.e(71828),r.e(59440),r.e(96987),r.e(83897),r.e(16748),r.e(72389),r.e(31871),r.e(14946),r.e(64811),r.e(69373)]).then(r.bind(r,55442)),{getChatStoreState:t}=await Promise.all([r.e(30173),r.e(6312),r.e(75113),r.e(83663),r.e(85614),r.e(71828),r.e(59440),r.e(96987),r.e(83897),r.e(16748),r.e(72389),r.e(31871),r.e(14946),r.e(64811),r.e(48501)]).then(r.bind(r,28410)),{getUserStoreState:o}=await Promise.all([r.e(6312),r.e(9467)]).then(r.bind(r,9467));await e().refreshSessions(),await t().refreshMessages(),await t().refreshTopic(),await o().refreshUserState()},useDataSyncConfig:()=>(0,d.Ay)(v,async()=>{try{return await f.remoteServerService.getRemoteServerConfig()}catch(e){throw console.error("获取远程服务器配置失败:",e),e}},{onSuccess:r=>{p()(r,t().dataSyncConfig)||t().refreshUserData(),e({dataSyncConfig:r,isInitRemoteServerConfig:!0})}})}))(...e),...((e,t)=>({updateElectronAppState:r=>{let o=t().appState;e({appState:(0,y.h)(o,r)})},useInitElectronAppState:()=>(0,a.Ju)("initElectronAppState",async()=>i.electronSystemService.getAppState(),{onSuccess:t=>{e({appState:t,isAppStateInit:!0},!1,"initElectronAppState"),c.N.updateContext({desktopPath:t.userPath.desktop,documentsPath:t.userPath.documents,downloadsPath:t.userPath.downloads,homePath:t.userPath.home,musicPath:t.userPath.music,picturesPath:t.userPath.pictures,userDataPath:t.userPath.userData,videosPath:t.userPath.videos})}})}))(...e),...((e,t)=>({refreshDesktopHotkeys:async()=>{await (0,h.j)(g)},refreshProxySettings:async()=>{await (0,h.j)(u)},setProxySettings:async e=>{try{await S.x.setSettings(e),await t().refreshProxySettings()}catch(e){console.error("代理设置更新失败:",e)}},updateDesktopHotkey:async(e,r)=>{try{let o=await S.x.updateDesktopHotkey(e,r);return o.success&&await t().refreshDesktopHotkeys(),o}catch(e){return console.error("桌面热键更新失败:",e),{errorType:"UNKNOWN",success:!1}}},useFetchDesktopHotkeys:()=>(0,d.Ay)(g,async()=>S.x.getDesktopHotkeys(),{onSuccess:r=>{p()(r,t().desktopHotkeys)||e({desktopHotkeys:r,isDesktopHotkeysInit:!0})}}),useGetProxySettings:()=>(0,d.Ay)(u,async()=>S.x.getProxySettings(),{onSuccess:r=>{p()(r,t().proxySettings)||e({proxySettings:r})}})}))(...e)})),o.x),x=()=>C.getState()},90396:(e,t,r)=>{r.d(t,{x:()=>s});var o=r(14343);class n{constructor(){this.getProxySettings=async()=>(0,o.dispatch)("getProxySettings"),this.setSettings=async e=>(0,o.dispatch)("setProxySettings",e),this.getDesktopHotkeys=async()=>(0,o.dispatch)("getShortcutsConfig"),this.updateDesktopHotkey=async(e,t)=>(0,o.dispatch)("updateShortcutConfig",{accelerator:t,id:e}),this.testProxyConnection=async e=>(0,o.dispatch)("testProxyConnection",e),this.testProxyConfig=async(e,t)=>(0,o.dispatch)("testProxyConfig",{config:e,testUrl:t})}}let s=new n}}]);